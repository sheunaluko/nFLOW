{"version":3,"sources":["src/core_modules/logger.js","src/module_resources/utils.js","src/core_modules/base_node.js","src/core_modules/data_storage.js","src/core_modules/web_socket.js","src/core_modules/logger_node.js","src/module_resources/global_params.js","src/core_modules/ui.js","src/core_modules/transformer.js","src/core_modules/simulator.js","src/core_modules/state_machine.js","src/core_modules/event_detector.js","src/module_bundle.js","src/module_resources/sm_utils.js","src/dev.js","src/nflow.js","src/module_resources/state_machine_elements.js","src/wrtsm.js","src/scripts/rose_gait_workflows.js","src/module_resources/sounds.js","src/module_resources/script_loader.js","src/module_resources/bokeh.js","src/scripts/gait_detector.js","src/scripts/dev.js","src/index.js"],"names":["makeLogger","tag","stuff","console","log","join","logger","register","global_debug","set_debug","b","bug","i","debug","msg","and","ret","length","array_and","arr","apply","f","args","avg","sum","multiply","rms","Math","sqrt","variance","_avg","pow","std","take","coll","num","Array","fill","arr_mult","x","map","y","perf","num_times","results","t0","performance","now","result","t1","arr_range","max","min","range","a","len","first","d","last","zip_map","ks","vs","zip","xs","ys","dict_2_vec","k","push","number_or_self","val","Number","isNaN","d_map","dict_vals_2_num","diff","r","curr_max","curr_min","merge","Object","assign","cycle_array","v","shift","loop_fn","fn","l","slice","get_series","field","e","std_percent_diff","tmp","NaN","array_percent_diff","a1","a2","array_log_diff","cv","cv_matrix","matrix","num_els","el_array","log_diff_half_buff","buff","split","ceil","fh","sh","spd_matrix","matrix_map","matrix_mapper","m","dom","s","document","createElement","set_inner_html","thang","HTMLElement","appendChild","innerHTML","flex_row","id_base","container","style","html","make_div_array","n","id","col","el","new_id_base","row","id_from_loc","c","test_div_array","toString","app_clear","app","getElementById","firstChild","removeChild","app_render","colors","get_colors","Date","getTime","node_io_router","inputs","outputs","base_node","window","nflow","node_connections","new_input","o","new_output","ensure_input","ensure_output","dict_from","dict_to","input_port","output_port","assert","connection_name","get_connection_name","payload","packet","process_packet","source","sink","node","node_payload_router","handler_dict","io_router","port_name","handler_obj","handler_id","handler","ensure_input_output","has_handler","dlog","_payload","SKIP_PAYLOAD","send_payload_to_output","bind","opts","configured","name","node_name","node_counter","nodes","dev_logger","dev_mode","dclog","creation_time","data_counter","num_to_stream","streaming","is_source","stream_enabled","is_sink","is_through","payload_router","set_base_node","default_handler","main_opts","add_input_handler","stream_enabler","stream_disabler","main_handler","run_handlers","connect","disconnect","enable_stream","stream_num","trigger_input_packet","trigger_output_packet","data_storage","load_session","data_history","obj","configure","session_id","toISOString","part_counter","save_interval_id","loaded_session","playback_speed_multiplier","stream_index","to_save","JSON","stringify","localStorage","setItem","rate","setInterval","flush_data","clearInterval","get_session","buffer_size","zero_time_axis","diffs","util","speed","start_stream_loop","data_handler","stop_stream","trigger_input","delay","mod","setTimeout","t_1","csvContent","keys","sort","data","dev","row_content","key","encodedUri","encodeURI","link","setAttribute","click","dataStr","encodeURIComponent","downloadAnchorNode","make_json_input","get_session_part_names","filter","includes","parts_names","parse","getItem","merged","concat","file_cb","evt","target","files","fname","replace","reader","FileReader","onloadend","readyState","DONE","readAsText","type","addEventListener","web_socket","url","send_json","connection","close","conn","WebSocket","event","send","logger_node","params","global_x_len","make_y_series","make_x_series","create_static_multi_line_graph","title","Bokeh","ColumnDataSource","p","Plotting","figure","sizing_mode","glyph","multi_line","line_color","tooltips","add_tools","HoverTool","line_policy","show","plot","create_multi_line_graph","x_len","series_array","series_len","bokeh_multi_stream","ds","xss","yss","setv","silent","trigger","Graph","series_vector","parent","multi_opts","color","alpha","background_fill_color","background_fill_alpha","border_fill_color","border_fill_alpha","multi_line_graph","ui","graphs","last_series_buffer","graph","graph_array","n_cols","n_rows","app_el","index","render_into_element","get_data_source","series_buffer","series","dict_to_update","dict","get_array_series","get_dict_series","list","ind","indexOf","splice","array_to_update","ser","make_graph_for_obj","exclude","graph_ui","isArray","convert","add_graph","init","init_time","graph_object","updates","handle_sensor_buffer","get_object_grapher","grapher","process_data","t","ui_object_grapher","object_grapher","transformer","func","simulator","mode","stream_interval","send_val","sin","multiplier","random","offset","burst","getSeconds","state_machine","gui_mode","debug_mode","sensor_buffer_size","buffer","default_data_obj","sensors","transitioners","transitioner_groups","undefined","STATE","sensors_gui_buffer","ui_mapping","state","compare","l1","level","l2","sensor_order","set_sensor_order","get_sensor_last_N","transitioner","detector","applicator","group","group_status","sensor_id","run_sensor","update_buffer_with_data_object","run_sensors","transitioner_id","run_transitioner","time","random_data_obj","count","event_detector","baseline_counter","baseline_number","current_event","events","detection_params","upper","lower","init_detection_params","detection_thresh","last_linearized","history_buffer_size","init_history_buffer","in_range","detected","lp","linearize","reduce","bl","log_diff","detect","check_baseline","add_to_history","init_event","flush_event","history_buffer","power","map_f_on_dict","reduce_val","reduce_dict","test_dict","acc","gyr","foo","bar","happy","linearize_dict","flattened","mods","smu","transformers","sm","vars","resources","sample_walk","sme","dev_a","dev_b","field_diff","is_dev_b","is_dev_a","buf","test_turn_on","is_on","test_turn_off","wrtsm","flow","test_storage_persist","ws","pm","pipe_manager","start_saving","stop_saving","test_storage_replay","ra","raw_analyzer","start_stream","test_state_machine","rg","initialize","add_sensor","add_transitioner","test_state_machine_gui","init_gui","playback_gui","graph_dances","g1","line_dance","counter","acc_x","acc_y","sine_rate","sine_rate_2","sine_rate_3","sine_dance_0","sine_dance_1","gyr_z","stop","graph_sm_test","interval","start","sizes","size","test_cycle","run_debug_cycle","bar_graph","EW","sounds","ctx","AudioContext","osc","freq","gainVal","gain","createOscillator","frequency","value","createGain","destination","beep_time","beep_dic","beep","load_script","cb","script","onreadystatechange","onload","src","getElementsByTagName","load_css","rel","href","get_el","_make_bar_plot","width","top","vbar","VBar","bottom","fill_color","add_glyph","_make_line_plot","Line","Circle","set_bokeh_default_container","bokeh_default_container","get_bokeh_default_container","plot_dict","bokeh_plot","kind","plot_maker","bar_plot","line_plot","go","p1","gait_detector","verb","mi_detect","num_cycles","num_dec","states","pre_mi","new_opts","p_mi","monotonically_increasing","last_N","cycles_start_index","cycles_end_index","num_to_get","bokeh","mi_md","last_2","monotonically_decreasing_pre_0","md_mdp0","monotonically_decreasing_post_0","md_0","pre_0","mdp0_hs","hs","hs_pto","pto","pto_to","to","main","nflow_init","sm_ds_test","test_sim_tf","sim","tf","test_ED","ed","test_base","n1","n2","dev_x1","tut_1","walk_simulator","set_session","tut_2","tut_3","tut_4","_get_dev_b","_get_dy","last_val","_get_dy2","gait_dev","eugene_node","get_std","avg_abs_diff","lv","abs","get_density","get_diff","num_decs","gd","en","_dev_b","ln","load_api","ls","Event","dispatchEvent","load_time"],"mappings":"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;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","file":"src.a2b27638.map","sourceRoot":"..","sourcesContent":["\nexport function makeLogger(tag) { \n    return function(...stuff) { \n\tconsole.log(\"[\" + tag + \"]:: \" + stuff.join())\n    }\n} \n\n\nvar logger = {} \n\nlogger.register = function(tag) { \n    logger[tag] = makeLogger(tag)\n} \n\n\nexport {logger}  \n","//Tue Oct  2 18:06:09 PDT 2018\n//General JS utils file \n//would like to try creating soft?hard? links so that the utils files can be shared \n\nimport {logger} from \"../core_modules/logger.js\"\n\n\nvar global_debug = true \n\n\nexport function set_debug(b) {\n    global_debug = b \n} \n\nlogger.register(\"bug\") \n\nexport function bug(tag,...msg) { \n    if (global_debug) { \n\tconsole.log(\"<- \" + tag + \" ->\" )\n\tfor (var i = 0 ; i < msg.length ; i++) { \n\t    console.log(msg[i])\n\t}\n\tconsole.log(\"<- \" + tag + \" ->\" )\n    }\n}\n\nexport function debug(msg) { \n    if (global_debug) {\n\tlogger.bug(msg)\n    }\n}\n\nexport function and(...args) { \n    var ret = true \n    for (var i=0;i<args.length;i++) { \n\tret =  ret && args[i]\n    }\n    return ret ? true : false \n} \n\nexport function array_and(arr) { \n    var ret = true \n    for (var i=0;i<arr.length;i++) { \n\tret =  ret && arr[i]\n    }\n    return ret ? true : false\n}\n\nexport function apply(f,args) { \n    return f.apply(null,args)\n}\n\nexport function avg(arr) { \n    var sum = 0;\n    for( var i = 0; i < arr.length; i++ ){\n\tsum += arr[i]\n    }\n    return sum/arr.length \n}\n\nexport function multiply(arr) { \n    var ret = 1 ; \n    for (var i =0; i < arr.length ; i++ ) { \n\tret *= arr[i]\n    }\n    return ret \n}\n\nexport function rms(arr) { \n    var sum = 0;\n    for( var i = 0; i < arr.length; i++ ){\n    \tsum += arr[i]*arr[i]\n    }\n    return Math.sqrt(sum/arr.length)\n}\n\nexport function variance(arr) { \n    var _avg = avg(arr)\n    var sum = 0 \n    for( var i = 0; i < arr.length; i++ ){\n\tsum += Math.pow(arr[i] - _avg, 2)\n    }\n    return sum/arr.length \n} \n\nexport function std(arr) { \n    return Math.sqrt(variance(arr))\n} \n\nexport function take(coll,num) { \n    var ret = Array(num).fill(0) \n    for (var i =0;i<num; i++) { \n\tret[i] = coll[i]\n    }\n    return ret \n} \n\nexport function arr_mult(arr,x) { \n    return arr.map( y => y /x ) \n}\n\nexport function perf(f) { \n    var num_times = 20000\n    var results = Array(num_times).fill(0) \n    for (i = 0 ; i < num_times ; i++ ) { \n\tvar t0 = performance.now();\n\tvar result = f() \n\tvar t1 = performance.now();\n\tresults[i] = t1 - t0 \n    } \n    return avg(results) \n} \n\nexport function arr_range(arr) { \n    return apply(Math.max, arr) - apply(Math.min, arr)\n}\n\nexport function range(a,b) { \n    var len = b - a \n    var ret = Array(len).fill(0)  ; \n    for (var i = 0 ; i< len ; i++) {  \n\tret[i] = a + i \n    }\n    return ret \n} \n\nexport function first(d) { \n    return d[0]\n} \n\nexport function last(d) { \n    return d[d.length - 1 ] \n} \n\nexport function zip_map(ks,vs) { \n    var result = {} \n    for (var i = 0 ; i < ks.length; i ++ ) { \n\tresult[ks[i]] = vs[i]\n    }\n    return result\n}\n\nexport function zip(xs,ys) { \n    return xs.map(function(x,i) { \n\treturn [x, ys[i]]\n    }) \n}\n\nexport function dict_2_vec(d) { \n    var ret = [] ; \n    for (var k in d) { \n\tret.push([ k, d[k] ]) \n    } \n    return ret \n}\n\nexport function number_or_self(d) { \n    var val = Number(d) \n    if (isNaN(val)) {\n\treturn d \n    } else { \n\treturn val \n    } \n}\n\nexport function d_map(d,f) { \n    for (var k in d) {\n\td[k] = f(d[k])\n    }\n    return d \n}\n\nexport function dict_vals_2_num(d) { \n    return d_map(d,number_or_self) \n}\n\nexport function diff(d) { \n    var r =   Array(d.length - 1).fill(0) \n    for (var i = 1 ; i < d.length ; i ++ ) { \n\tr[i-1] = d[i] - d[i-1]\n    }\n    return r \n}\n\nexport function max(d) { \n    var curr_max = d[0] \n    \n    for (var i=1;i<d.length;i++) { \n\tif (d[i] > curr_max) { curr_max = d[i] }\n    } \n    \n    return curr_max \n} \n\nexport function min(d) { \n    var curr_min = d[0] \n    \n    for (var i=1;i<d.length;i++) { \n\tif (d[i] < curr_min) { curr_min = d[i] }\n    } \n    \n    return curr_min\n    \n} \n\nexport function merge(a,b) { \n    var result = Object.assign({},a,b)\n    return result\n}\n\nexport function cycle_array(a,v) { \n    a.push(v)\n    a.shift() \n    return a \n} \n\n\n\n\nexport function loop_fn(coll,fn,num) { \n    var l = coll.length\n    var ret = Array(l).fill(0) \n    for (var i=num ; i < l ; i ++) { \n\tret[i] = fn(coll.slice(i-num,i))\n    }\n    return ret \n} \n\n\n\n\n\nexport function get_series(coll , field) { \n    return coll.map(e=>e[field])\n}\n\n\n\n\nexport function std_percent_diff(arr) { \n    // Meant to be a magnitude normalized average derivative of an array \n    // calculates the vector of percentage differences (consecutive indeces) \n    // then gets the std of those \n    var tmp = Array(arr.length - 1 ).fill(NaN) \n    for (var i =0 ; i < tmp.length ; i ++ ) { \n\ttmp[i] =  (arr[i+1]-arr[i])/arr[i]\n    }\n    \n    return std(tmp)\n}\n\nexport function array_percent_diff(a1, a2 ) { \n    var ret = Array(a2.length).fill(0) \n    for (var i=0; i<ret.length; i++) { \n\tret[i] = (a2[i]-a1[i])/a1[i]\n    }\n    return ret \n} \n\nexport function array_log_diff(a1, a2 ) { \n    var ret = Array(a2.length).fill(0) \n    for (var i=0; i<ret.length; i++) { \n\tret[i] = Math.log(a2[i]) - Math.log(a1[i])\n    }\n    return ret \n} \n\nexport function cv(arr) { \n    return std(arr)/avg(arr)\n}\n\nexport function cv_matrix(matrix) { \n\n    let num_els = matrix[0].length \n    var result = Array(num_els).fill(null)\n    \n    for (var e =0; e < num_els ; e ++ ) { \n\tlet el_array = matrix.map( arr => arr[e]  ) \n\tresult[e] = cv(el_array)\n    }\n    \n    return result\n} \n\nexport function log_diff_half_buff(buff) { \n    //splits buffer in half, averages two halves, then calcs log diff of both halves \n    let split = Math.ceil(buff.length/2)  \n    let fh = take(buff,split) \n    let sh = buff.slice(-(buff.length - split))\n    return Math.log(avg(sh)) - Math.log(avg(fh))\n}\n\nexport function spd_matrix(matrix) { \n    // foo\n    let num_els = matrix[0].length \n    var result = Array(num_els).fill(null)\n    \n    for (var e =0; e < num_els ; e ++ ) { \n\tlet el_array = matrix.map( arr => arr[e]  ) \n\tresult[e] = std_percent_diff(el_array)\n    }\n    \n    return result\n} \n\nexport function matrix_map(matrix,f) { \n    let num_els = matrix[0].length \n    var result = Array(num_els).fill(null)\n    for (var e =0; e < num_els ; e ++ ) { \n\tlet el_array = matrix.map( arr => arr[e]  ) \n\tresult[e] = f(el_array)\n    }\n    return result\n} \n\nexport function matrix_mapper(f) { \n    return function(m) {return matrix_map(m,f)}\n} \n\n\n// define ui utilities now ------------> \n\nexport function dom(s) { \n    return document.createElement(s) \n} \n\nexport function set_inner_html(d,thang) { \n    if (thang instanceof HTMLElement) { \n\td.appendChild(thang) \n    } else { \n\td.innerHTML = thang \n    } \n    \n} \n\nexport function flex_row(num,id_base,f) { \n    var container, i \n    container = dom(\"div\")  \n    //container.className = \"flex-row\"  // see styles.css   \n    container.style = \"display : flex ; flex-wrap : nowrap ; flex-direction : row ; flex-grow : 1 \"\n        \n    for (i =0 ; i < num ; i ++ ) { \n\tvar d = dom(\"div\") \n\td.style = \"flex-grow : 1\"\n\tvar html = f(i,d) \n\tif (html) { \n\t    set_inner_html(d, html) \n\t} \n\tcontainer.appendChild(d) \n    } \n    return container  \n}\n\n\n/* \n * Create a flexbox of divs [m,n] in shape \n * @param {Function} f - accepts row, column, and HTMLelement. Can either mutate the el or return an new el (which will be appended to div at spot r,c) or return String (which will be set to innerHTML) \n */ \nexport function make_div_array(m,n,id_base,f) { \n    var container, i \n    \n    container = dom(\"div\")  \n    //container.className = \"flex-column\"  // see styles.css  \n    container.id = id_base \n    \n    container.style = \"width: 100% ; height : 100% ; display : flex ; flex-wrap : nowrap ; flex-direction : column \"\n    \n    // now we will add in the child elements \n    for (i =0 ; i < m ; i ++ ) { \n\t\n\t//f is a function which takes a row and column and element \n\t//build a function that takes just a col with row hard coded \n\t//and returns f(r,col)\n\tvar fn = function(col,el) {\n\t    return f(i,col,el) \n\t}\n\t\n\tvar new_id_base = id_base + \"_\" +  i + \",\" \n\tvar row = flex_row(n,new_id_base , fn )\n\tcontainer.appendChild(row) \n    }\n    \n    return container\n    \n\n} \n\nexport function id_from_loc(m,n,c) { \n    return c*m + n   // intersing that this function needs arg c, which is (static) number of cols \n}\n\nexport function test_div_array(m,n) { \n    var f = function(r,c,el) { \n\treturn (id_from_loc(r,c,n)).toString()\n    } \n\n    return make_div_array(m,n,\"foo\", f) \n    \n} \n\t\nexport function app_clear() { \n    var app = document.getElementById(\"app\");\n    while (app.firstChild) {\n\tapp.removeChild(app.firstChild);\n    }   \n}\n\nexport function app_render(el) { \n    app_clear() \n    var app = document.getElementById(\"app\")  \n    app.appendChild(el) \n}\n\nvar colors = [\"black\" , \"blue\" , \"red\" , \"green\" , \"yellow\" , \"orange\"]\n\nexport function get_colors(num) { \n    return take(colors, num) \n}\n\nexport function now() { \n    return (new Date()).getTime()    \n}\n///   extensions \n\n\n// Array.prototype.first = function(arr) { \n//     return arr[0] \n// }\n","// Fri Dec 21 12:12:27 EST 2018\n\nimport {makeLogger} from \"./logger.js\"\nimport * as util from \"../module_resources/utils.js\"\n\n\n/* \n[Fri Dec 21 12:12:27 EST 2018]\nI would like to make it such that ALL nflow nodes can inherit from this class \nthereby encapsulating all common functionality and providing an avenue for \nsimultaneous upgrades \n\nWould like to support: \n- stream_single \n- each node manages its connections to other nodes \n- various (named) output and input ports for nodes \n   \nTERMS=> \nPacket consists of { input_port_name , payload }\nPayload is the actual data which is communicated \n\nNodes always transmit PACKETS to each other,  which are then destructured into the \ndesired port, to which the specific PAYLOAD is delivered. \n\nA payload handler will match the payload at a specific port with a specific handler (or collection of handlers) , which each routes  processed payload to a specied OUTPUT port according to the routing defined in NODE_PAYLOAD_ROUTER \n\nOutputs are then processed via the routing in NODE_IO_ROUTER \n\nThe key thing to realize about this architecture is that there are both \nINTRA nodal routings (mapping input to output ports via handlers )  \n- these are handled by the NODE_PAYLOAD_ROUTER instance -- \nand \nINTER nodal routings (mapping output ports to input ports of other nodes via forwarding) \n-- these are handled by the NODE_IO_ROUTER ---\nBOTH of these routings can have !SEVERAL! handlers associated with a given port \n\nFor example, node_1 could have input ports (i1) and (i2) , and two output port (o1) and (o2). \nThe first INTRA nodal handler (PAYLOAD_ROUTER)  may route i1->o1 via HANDLER_1,  i.e. o1( HANDLER_1(i1) ) \nand another handler may route i1->o2 via HANDLER_2,  i.e. o2( HANDLER_2(i1) ) \n\nFinally, node_1 o2 could be routed to multiple input ports of other nodes. \nYou will notice that the base_node class has two instances in the code when a handler_obj \nIs retrieved and then all the attached handlers are called with a payload. \nThese two instances correspond to the INTRA and INTER nodal mappings discussed above\n\n--- \n\nAbout streaming. \nthis.enable_stream will make  a SOURCE node initialize its data soure, but this.streaming will still be false and the source node will IGNORE packets \nthis.streaming = true will allow ANY node to actually process its input packet \n\n\n*/\n\n\n\n\n/* \n * Object for retaining information of input and output ports of a node, \n * as well as information about global node connectivity \n */\nclass node_io_router { \n    \n    constructor() { \n\tthis.inputs = {} \n\tthis.outputs = {} \n\tthis.base_node = null \n\t/* initialize the global node connectivity map (used to inspect connections)  */ \n\tif (! window.nflow.node_connections ) { window.nflow.node_connections = {} }\n    } \n    \n    new_input(id) { \n\tthis.inputs[id] = {} \n    }\n    \n    new_output(id) { \n\tthis.outputs[id] = {} \n    }\n    \n    ensure_input(i) { \n\tif (!this.inputs[i]) { this.new_input(i) }\t\n    } \n    \n    ensure_output(o) { \n\tif (!this.outputs[o]) { this.new_output(o) }\t\n    } \n    \n    ensure_input_output(i,o) { \n\tthis.ensure_input(i) ; this.ensure_output(o)  ; \n    }\n    \n    get_connection_name({dict_from, dict_to, input_port, output_port}) { \n\treturn dict_from.base_node.id + \".\" + output_port + \"~>\" + dict_to.base_node.id + \".\" + input_port \n    }\n\t\n    /* \n     * Connect output_port of dict_from with input_port of dict_to \n     *\n     */\n    connect({output_port, dict_from, input_port, dict_to}) { \n\t/*  If the output_port or input_port is missing should ERROR  */ \n\tconsole.assert(dict_from.outputs[output_port])\n\tconsole.assert(dict_to.inputs[input_port])\n\t\n\t/* \n\t Some info briefly. The purpose of this fn is to route a payload OUT of a node \n\t and into the correct port of another node. Once it leaves the dict_from we no \n\t longer care what happens (presumably there are handlers set up for it!)  \n\t \n\t The output dictionary this.outputs is indexed by the output_port name. \n\t \n\t */ \n\t\n\t/* get connection name */\n\tlet connection_name = this.get_connection_name({dict_from, dict_to, input_port, output_port})\n\tdict_from.outputs[output_port][connection_name] = function(payload) { \n\t    // this function is the payload handler\n\t    // will create packet and route it to destination node \n\t    let packet = { input_port, payload } \n\t    dict_to.base_node.process_packet(packet)\n\t}\n\t\n\t/* and will also update the global connection struct */ \n\twindow.nflow.node_connections[connection_name] = { \n\t    source : [ dict_from.base_node.id , output_port ], \n\t    sink   : [ dict_to.base_node.id , input_port ] \n\t} \n\t\n    }\n    \n    disconnect({output_port, dict_from, input_port, dict_to}) { \n\t/*  If the output_port or input_port is missing should ERROR  */ \n\tconsole.assert(dict_from.outputs[output_port])\n\tconsole.assert(dict_to.inputs[input_port])\n\t\n\t/* get connection name */\n\tlet connection_name = this.get_connection_name({dict_from, dict_to, input_port, output_port})\n\tdict_from.outputs[output_port][connection_name] = null \n\t\n\t/* and will also update the global connection struct */ \n\twindow.nflow.node_connections[connection_name] = null \n    }\n    \n    get_global_connections() { \n\treturn window.nflow.node_connections \n    }\n    \n    set_base_node(node) { \n\tthis.base_node = node \n    }\n    \n}\n\n/* \n * Object for managing handlers and mapping between input and output ports \n */ \nclass node_payload_router { \n    \n    constructor() { \n\tthis.handler_dict = {} \n\tthis.base_node = null //reference to the node this belongs to \n\tthis.io_router = new node_io_router() ; \n    }\n    \n    has_handler(port_name) { \n\treturn this.handler_dict[port_name]\n    }\n    \n    send_payload_to_output({payload, output_port}) {\n\t/* look up the handlers and execute them */ \n\tlet handler_obj = this.io_router.outputs[output_port]\n\t/* each handler obj is a dict with multiple handlers\n\t   indexed via connection_name */ \n\tfor (var k in handler_obj ) { \n\t    handler_obj[k](payload) \n\t}\n    }\n\t\n    add_input_handler({handler_id, input_port, handler, output_port})  { \n\n\t//create the ports if they do not exist \n\tthis.io_router.ensure_input_output(input_port, output_port) \n\t\n\t//create and register the appropriate handler \n\tif (!this.has_handler(input_port) ) { \n\t    this.base_node.dlog(\"Handler unregistered\")\n\t    //handler not yet defined for this port \n\t    this.handler_dict[input_port] = {} \n\t} \n\t  \n\t//handlers have been defined  \n\tthis.base_node.dlog(\"Handler registered...\")\n\tthis.handler_dict[input_port][handler_id] = (function(_payload) { \n\t    //process the payload with the handler and send to output port \n\t    let payload = handler(_payload) \n\t    if (payload == nflow.SKIP_PAYLOAD) { \n\t\treturn \n\t    } else { \n\t\tthis.send_payload_to_output({payload, output_port})\n\t    } \n\t}).bind(this)   /* have to bind for this reference */\n    }\n    \n    remove_input_handler(opts) { \n\tvar {input_port, handler_id} = opts \n\tif (this.has_handler(input_port)) { \n\t    this.handler_dict[input_port][handler_id] = null \n\t}\n    }\n    \n    set_base_node(node) { \n\tthis.base_node = node \n    }\n    \n}\n\n\n/**\n * Base class for defining nflow nodes \n *\n */\nexport default class base_node {\n    \n    constructor(opts) { \n\topts = opts || {} \n\t\n\t/* instantiate member variables */ \n\tthis.opts = opts\n\tthis.base_node = this \n\tthis.configured = false \n\tthis.name = opts.node_name || \"base_node\" \n\t/* create global counter for node IDs */ \n\tif (!nflow.node_counter) {nflow.node_counter = 0}\n\tif (!nflow.nodes) {nflow.nodes = {}}\n\tthis.id = this.name + \"_\" + nflow.node_counter++\n\tnflow.nodes[this.id] = this\n\tthis.log = makeLogger(this.id) \n\tthis.dev_logger = makeLogger(this.id + \"_dev\")\n\tthis.dev_mode = opts.dev_mode || false \n\tthis.dlog = function(msg) { if (this.dev_mode) { this.dev_logger(msg) } } \n\tthis.dclog = function(msg) {if (this.dev_mode) { console.log(msg) } } \n\tthis.creation_time = new Date() \n\tthis.data_counter = 0 \n\t/* stream stuff */ \n\tthis.num_to_stream = null //for gating number of packets from source \n\t\n\t/* only sources are disbabled by default */ \n\tthis.streaming = opts.streaming || !opts.is_source \n\tthis.stream_enabled = opts.stream_enabled ||  !opts.is_source \n\t    \n\t/* configure the node type base on opts params  */ \n\tthis.is_source     = opts.is_source \n\tthis.is_sink       = opts.is_sink \n\tthis.is_through    = opts.is_through || true \n\t/* these have significance in terms of base functionalities of the node /* \n\n\t/* create a payload router object for managing connections  */\n\tthis.payload_router = new node_payload_router() \n\t\n\t/* assign appropriate references */\n\tthis.io_router = this.payload_router.io_router \n\tthis.payload_router.set_base_node(this) \n\tthis.io_router.set_base_node(this) \n\t\n\t/* define a default handler */\n\tthis.default_handler = (function(payload){\n\t    this.dclog(payload); return payload //must return in order to pass it on ! \n\t}).bind(this)\n\t\n\t/* By default each node maps main_input -> main_handler -> main_output */ \n\tlet main_opts = {handler_id : \"main\" , input_port : \"main_input\" , \n\t\t\t output_port : \"main_output\" , handler : this.default_handler }\n\t\n\t/* configure main route */ \n\tthis.payload_router.add_input_handler( main_opts ) \n\t\n    } \n    \n    configure({stream_enabler , stream_disabler, main_handler}) {\n\tthis.stream_enabler = stream_enabler\n\tthis.stream_disabler = stream_disabler\n\tthis.main_handler = main_handler || this.default_handler \n\t\n\t/* By default each node maps main_input -> main_handler -> main_output */ \n\tlet main_opts = {handler_id : \"main\" , input_port : \"main_input\" , \n\t\t\t output_port : \"main_output\" , handler : this.main_handler.bind(this) } \n\t\n\t/* configure main route */ \n\tthis.payload_router.add_input_handler( main_opts ) \n\tthis.configured = true \n    }\n    \n    /* \n     * Helper function for calling handlers \n     * @param {obj} opts - Contains {handler_obj , payload} \n     */\n    run_handlers({handler_obj, payload}) { \n\tfor (var k in handler_obj ) { \n\t    handler_obj[k](payload) \n\t}\n    }\n    \n    /** \n     * Generic packet processor \n     * @param {Dict} packet - contains { input_port , payload } \n     */ \n    process_packet({input_port, payload}) { \n\tconsole.assert(this.configured, \"Node not configured: \" + this.id) \n\tif (this.streaming) { \n\t    this.dlog(\"Processing data packet...\")\n\t    this.dclog({input_port, payload})\n\t    //in general when a packet comes in we \n\t    //1. find the handlers associated with the input_port requested \n\t    let handler_obj = this.payload_router.handler_dict[input_port] \n\t    //this.dclog(handler_obj)\n\t    //2. make sure it exists -- if not this is likely an error \n\t    console.assert(handler_obj) \n\t    //3. run all the handlers with the included payload \n\t    this.run_handlers({handler_obj, payload})\n\t    \n\t    if (this.num_to_stream) { \n\t\tif (--this.num_to_stream == 0 ) { this.streaming = false } \n\t    } \n\t    \n\t    this.data_counter += 1 \n\t\t\t\t\t\t\n\t} else {this.dlog(\"Not streaming!\")}\n    }\n\t    \n    \n    \n    /* pass on creation of inputs */ \n    new_input(id)  { this.io_router.new_input(id) }\n    new_output(id) { this.io_router.new_output(id) }\n    \n    /** \n     * Connect node to another node \n     * @param {base_node} sink - Node to connect to \n     * @param {obj} opts - Contains {output_port = \"main_output\",input_port = \"main_input\"}\n     */\n    connect(sink, { output_port = \"main_output\" , input_port = \"main_input\" } = {} ) { \n\tlet dict_from = this.io_router \n\tlet dict_to   = sink.io_router \n\tthis.io_router.connect({output_port, dict_from, input_port, dict_to})\n\t\n\t/* return the sink node for chaining connections :) */ \n\treturn sink \n    }\n    \n    disconnect(sink, { output_port = \"main_output\" , input_port = \"main_input\" } = {} ) { \n\tlet dict_from = this.io_router \n\tlet dict_to   = sink.io_router \n\tthis.io_router.disconnect({output_port, dict_from, input_port, dict_to})\n\t\n\t/* return the sink node for chaining connections :) */ \n\treturn sink \n    }\n    \n    /*  \n\tSat Dec 22 12:59:41 EST 2018\n\tI am unsure if I should use protocols or class functions for implementing \n\tthe start_stream , stop_stream, stream_single... etc... \n\t\n\tFROM Stack Overflow --> \"class\" defines what an object is.\n\t\"protocol\" defines a behavior the object has.\n\t\n\tOne difference which resonated with me is: Consider you have an object STREAMER \n\twhich takes \n\ta base_node and will call start_stream. As long as you are only dealing with base_nodes \n\tthis is fine, but if in the future you could have OTHER objects which ALSO implement \n\tstart_stream, then for extensibility sake it is better to implmenet STREAMER \n\tby having it accept ANY object which implements a protocol ? \n\t\n\tI think this makes a bigger difference if you are using a STATICALLY typed language, \n\tsince in a dynamically typed language functions can take arbitrary inputs without \n\tvalidating what their TYPE is or which protocols they implement (and call them \n\thowever they want -- which of course risks run time errors ) \n\t\n\tRegardless -- JS does not support protocols , so I will have child classes \n\tassign functions to instance variables which are called via a \"protocol\" \n     */\n    \n    /* the member variables used below are created at object instantiation */ \n    enable_stream()  {this.stream_enabler(this)}\n    disable_stream() {this.stream_disabler(this)}    \n    \n    /* start, stop, and num streams */\n    start_stream()  { \n\tif (!this.stream_enabled) { this.enable_stream() } \n\tthis.num_to_stream = null \n\tthis.streaming = true \n    }\n    stop_stream() { \n\tthis.streaming = false \n    }\n    stream_num(n) { \n\tif (!this.stream_enabled) { this.enable_stream() } \n\tthis.num_to_stream = n \n\tthis.streaming = true \n    } \n    stream_single() {this.stream_num(1)} \n\n    /* Dev utilities for maually triggering nodes */ \n    /* These are not originally intended for realtime node communications */\n    /* though may prove useful */ \n    /* Update : have found them useful so far for triggering source nodes */\n    trigger_input_packet({input_port = \"main_input\" , payload} ) { \n\tthis.process_packet({input_port , payload })\n    }\n    trigger_output_packet({output_port = \"main_output\" , payload} ) { \n\tthis.payload_router.send_payload_to_output({payload, output_port})\n    }\n    trigger_input(payload) { \n\tthis.trigger_input_packet({payload})\n    }\n    trigger_output(payload) { \n\tthis.trigger_output_packet({payload})\n    }\n}\n\n","//Sat Jan  5 21:00:37 EST 2019\n\nimport * as util from \"../module_resources/utils.js\"\nimport base_node from  \"./base_node.js\"\n\n/**\n * \n * \n */\n\nexport default class data_storage extends base_node {\n\n    /**\n     * Manages data persistence and replay/simulation. Uses browser based local storage. \n     * @param {String} name - Session identifier, use null for default time string\n     */ \n    constructor(name) { \n\n\tlet node_name = \"DS\"\n\tlet is_source = true \n\tlet is_sink = true\n\t\n\tsuper({node_name, is_source, is_sink})\n\t\n\tlet stream_enabler = function() { \n\t    this.load_session() \n\t} \n\t\n\tlet stream_disabler = function() { \n\t    this.log(\"No stream disabler implemented\") \n\t}\n\t\n\tlet main_handler = function(payload) { \n\t    this.data_history.push(obj) \n\t} \n\t\n\tthis.configure({stream_enabler, stream_disabler}) \n\tthis.session_id = name || (new Date()).toISOString()\n\tthis.data_history = [] \n\tthis.part_counter = 1 \n\tthis.save_interval_id = null \n\tthis.loaded_session = null \n\tthis.playback_speed_multiplier = 1\n\tthis.stream_index = 0 \n    } \n    \n    /**\n     *  Persists a chunk of data to localStorage. Uses session name + part_number as identifier\n     */ \n    flush_data() { \n\tvar to_save = JSON.stringify(this.data_history)\n\tname    = this.session_id + \"_part\" + this.part_counter.toString() \n\tthis.data_history = [] \n\tlocalStorage.setItem(name, to_save) \n\tthis.part_counter += 1 \n\tthis.log(\"Saved data chunk: \" + name ) \n    } \n    \n    /**\n     * Start saving data to localStorage. Data is saved in chunks called 'parts'. \n     * @param {Number} rate - The rate to flush data to localStorage in SECONDS \n     */ \n    start_saving(rate) { \n\tthis.save_interval_id = setInterval(  (function(){this.flush_data()}).bind(this) , rate*1000)\n\tthis.log(\"Saving started for session: \" + this.session_id) \n    } \n\n    /**\n     * Stop saving data to localStorage\n     */ \n    stop_saving() { \n\tclearInterval(this.save_interval_id) \n\tthis.log(\"Saving stopped for session: \" + this.session_id) \n    } \n\n    /** \n     * Loads a data storage session from localStorage. Returns Array. \n     */\n    load_session() { \n\tthis.log(\"Loading session...\")\n\tthis.loaded_session = get_session(this.session_id)  // see definition below \n\tthis.stream_index = 0 \n\tthis.buffer_size = this.loaded_session.length\n\tthis.streaming = false \n\tthis.zero_time_axis() \n\tthis.diffs = util.diff( this.loaded_session.map( d => d[\"time\"] )  )\n\tthis.log(\"Session loaded: \" + this.session_id) \n    } \n    \n    /**\n     * Sets the session using json object as data input  \n     * @param {Array} d - The data array to set\n     */ \n    set_session(d) { \n\tthis.log(\"Setting session...\")\n\tthis.loaded_session = d \n\tthis.stream_index = 0 \n\tthis.buffer_size = this.loaded_session.length\n\tthis.streaming = false \n\tthis.zero_time_axis() \n\tthis.diffs = util.diff( this.loaded_session.map( d => d[\"time\"] )  )\n\tthis.log(\"Session set: \" + this.session_id) \n\tthis.stream_enabled = true\n    }\n       \n\n\n    /** \n     * Start streaming the session that was previously loaded from localStorage \n     */\n    start_stream(speed) { \n\tif (! this.stream_enabled ) { this.enable_stream() } \n\tthis.stream_index =  0 \n\tthis.streaming = true \n\tthis.playback_speed_multiplier = speed || 1 \n\tthis.start_stream_loop() \n\n    } \n    \n    /** \n     * Stream single packet\n     */\n    stream_single() { \n\tif (this.stream_index < this.buffer_size  ) { \t\n\t    //get the data\n\t    var val = this.loaded_session[this.stream_index]\n\t    //send the data\n\t    this.data_handler(val) \n\t    //increment the stream index \n\t    this.stream_index += 1 \n\t    return val \n\t} else { \n\t    this.stop_stream() \n\t} \n\t\n\n    } \n    \n    \n    /** \n     * Helper function for start_stream() \n     */\n    start_stream_loop() { \n    \t//when starting, this.index is 0, this.diffs is defined \n\tif (this.streaming) { \n\t    //get the data\n\t    var val = this.loaded_session[this.stream_index]\n\t    //send the data\n\t    this.trigger_input(val) \n\t    \n\t    if (this.stream_index == this.buffer_size - 1 ) { \n\t\t//on the last data point  \n\t\t//significant b/c the diff array is finished \n\t\t//so we stop streaming \n\t\tthis.stop_stream() \n\t\t\n\t    } else { \n\t\t//not on the last data point \n\t\t//now acces the next diff \n\t\tvar delay = this.diffs[this.stream_index]\n\t\t//increment the stream_index \n\t\tthis.stream_index += 1 \n\t\t//schedule the loop again \n\t\tvar mod =  this.playback_speed_multiplier \n\t\tsetTimeout( (function() {this.start_stream_loop()}).bind(this) , delay*mod)\n\t    }\n\t    \n\t}\n\t\n    }\n\t\t\n    \n    /** \n     * Zero the time axis of the data session \n     */\n    zero_time_axis() { \n\tthis.log(\"Zeroing time axis\") \n\tif (!this.loaded_session.length) { \n\t    throw(\"Session must be loaded!\")\n\t} else { \n\t    //get first time point \n\t    var t_1  = util.first(this.loaded_session)[\"time\"] \n\t    //now we subtract t_1 from all time points \n\t    this.loaded_session.map( function(d) { \n\t\td[\"time\"] = d[\"time\"] - t_1 \n\t\treturn d \n\t    })\n\t    this.log(\"Done\")\n\t}\n\t\n    } \n\n\n\n    /** \n     * Stop streaming the session that was previously loaded from localStorage \n     */\n    stop_stream() { \n\tthis.streaming = false \n\tthis.stream_index =  0 \n\tthis.log(\"Stream finished.\") \n    } \n\n    \n    \n    /** \n     * Makes csv string from this.loaded_session \n     */\n    to_csv(name) { \n\tthis.log(\"Creating csv file for: \" + this.session_id) \n\tlet csvContent = \"data:text/csv;charset=utf-8,\";\n\t\n\t//figure out the keys in the data objects \n\tlet keys = Object.keys(this.loaded_session[0]).sort()\n\t\n\t//write csv header \n\tcsvContent += ( keys.join(\",\") + \"\\n\" ) \n\t\n\t//then loop through the structure \n\tfor (var i =0 ; i < this.loaded_session.length ; i ++) { \n\t    var data = this.loaded_session[i]\n\t    if (data.dev == \"B\" ) { \n\t\tvar row_content = []\n\t\t//loop through keys to build the row \n\t\tfor (var k = 0 ; k < keys.length ; k ++ ) { \n\t\t    var key = keys[k] \n\t\t    var val = data[key]\n\t\t    row_content.push(data[key]) \n\t\t}\n\t\tcsvContent += (row_content.join(\",\") + \"\\n\" ) \n\t    }\n\t} \n\t\n\tvar encodedUri = encodeURI(csvContent);\n\tvar link = document.createElement(\"a\");\n\tlink.setAttribute(\"href\", encodedUri);\n\tlink.setAttribute(\"download\", (name || this.session_id)   + \".csv\");\n\tlink.click();\n\t\n\t\n    } \n\n    /** \n     * Makes and downloads json string from this.loaded_session \n     */\n    to_json(name) { \n\tthis.log(\"Creating json file for: \" + this.session_id) \n\tvar dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(this.loaded_session)) \n\tvar downloadAnchorNode = document.createElement('a');\n\tdownloadAnchorNode.setAttribute(\"href\",     dataStr);\n\tdownloadAnchorNode.setAttribute(\"download\", (name || this.session_id) + \".json\");\n\tdownloadAnchorNode.click();\n    }\n    \n    \n    /** \n     * Loads json data into local storage \n     */\n    load_json() { \n\tvar i = make_json_input() \n\ti.click() \n\treturn i\n    }\n    \n    \n}\n\n\n// define some helpers \nfunction get_session_part_names(id) { \n    return Object.keys(localStorage).filter( s => s.includes(id) ).sort() \n} \n    \nfunction get_session(id) { \n    var parts_names = get_session_part_names(id) \n    // part names are sorted already \n    var tmp = parts_names.map( function(name) { \n\treturn JSON.parse(localStorage.getItem(name))\n    }) \n    \n    var merged = [].concat.apply([], tmp);\n    return merged.map( util.dict_vals_2_num ) \n}\n\n\nfunction file_cb(evt) { \n    var f = evt.target.files[0]\n    var fname = f.name.replace(\".json\",\"\")\n    var reader = new FileReader() \n    reader.onloadend = function(evt) { \n\tif (evt.target.readyState == FileReader.DONE) {\n\t    localStorage.setItem(fname, evt.target.result) \n\t    console.log(\"[DS]:: Saved item to local storage: \" + fname )\n\t} else { \n\t    console.log(\"[DS]:: error reading.. \") \n\t    console.log(evt) \n\t} \n    }\n    reader.readAsText(f) \n}\n\n\nfunction make_json_input() {\n    var i =   document.createElement(\"input\")\n    i.type = \"file\" \n    i.addEventListener(\"change\", file_cb ) \n    return i \n} \n","// Sat Dec 22 22:02:38 EST 2018\n\nimport {util} from \"../module_resources/utils.js\"\nimport base_node from  \"./base_node.js\"\n\n/**\n * Manages the websocket connection to an incoming data stream.\n *\n * @param {String} url - The websocket url to connect to, e.g. ws://localhost:1234\n */\nexport default class web_socket extends base_node {\n    \n    constructor(url) { \n\n\tlet node_name = \"WS\" \n\tlet is_source = true \n\n\tsuper({node_name, is_source})\n\n\tlet stream_enabler = function(){ \n\t    this.connect() \n\t}\n\t\n\tlet stream_disabler = function(){ \n\t    this.send_json({type : \"control\" , data : \"stop\" })\n\t    this.connection.close() \n\t}\n\t\n\tthis.configure({stream_enabler, stream_disabler}) \n\tthis.url = url ;  \n\tthis.connection = null ;  \n\n    } \n    \n    /**\n     * Connect to remote websocket server. Upon success, registers the websocket connection\n     * as \"client\" with the server, enables streaming, and this.logs to console. \n     */ \n    connect() { \n\tvar conn  = new WebSocket(this.url) ; \n\t// Connection opened\n\tconn.addEventListener('open', (function (event) {\n\t    this.log(\"Connection to \" + this.url + \" successful. Registering client with server.\")\n\t    this.send_json({type: \"register\" , data : \"client\" })\n\t    this.send_json({type: \"control\"  , data : \"start\"  }) \n\t}).bind(this)) //bind is necessary for web_socket class vs WebSocket instance! \n\n\t// Listen for messages\n\tconn.addEventListener('message', (function (event) {\n\t    let payload = util.dict_vals_2_num(JSON.parse(event.data))\n\t    this.trigger_input(payload) //defaults to main input_port \n\t}).bind(this)) //bind is necessary for web_socket class vs WebSocket instance! \n\t\n\tthis.connection = conn ; \n    } \n    \n   /** \n     * Sends JSON data through socket. \n     * @param {Object} obj - Data object to send \n     */ \n    send_json(obj) { \n\tthis.connection.send(JSON.stringify(obj))\n    }\n\n}\n\n","// Wed Dec  5 08:11:17 PST 2018\n\nimport base_node from  \"./base_node.js\"\n\n/**\n * Logs whatever it receives\n *\n */\nexport default class logger_node extends base_node {\n    \n    constructor() { \n\t\n\tlet node_name = \"LN\" \n\tlet is_sink = true \n\t\n\tsuper({node_name , is_sink})\n\n\tlet main_handler = function(payload) { \n\t    console.log(payload) \n\t    return payload \n\t} \n\t\n\tthis.configure({main_handler})\n\t\n    } \n\n    \n}\n\n","\n\n\nvar params = \n    { \n\tglobal_x_len : 200 \n\t\n\t\n\t\n    }\n\n\nexport { params } \n    \n","import {params} from \"../module_resources/global_params.js\" \nimport * as util     from \"../module_resources/utils.js\" \nimport base_node  from \"./base_node.js\"\n\n\n\nfunction make_y_series(len) { \n    return Array(len).fill(0) \n}\n\nfunction make_x_series(len) { \n    return util.range(-len, 0).map( x => x/100 ) // the /100 is hax for now for streaming\n}\n\nfunction create_static_multi_line_graph(container,opts) { \n\tvar { xs, ys , title  } = opts \n\t\n\t//will use indeces for x arrays if not provided \n\tif (! xs ) { \n\t\txs =  [] \n\t\tfor (var i =0; i< ys.length ; i ++)  { \n\t\t\txs.push(util.range(0, ys[0].length ) ) \n\t\t}\n\t}\n\n\tvar source = new Bokeh.ColumnDataSource( {\n\tdata : {xs : xs, ys : ys }\n    })\n    \n    // make the plot and add some tools\n    //var tools = \"pan,crosshair,wheel_zoom,box_zoom,reset,save\";\n\n    // WOW ! -- how lucky to find sizing_mode : stretch_both lmao \n    // https://github.com/bokeh/bokeh/issues/4958\n    \n    var p = Bokeh.Plotting.figure({ title: title,sizing_mode : 'stretch_both' })\n    \n    //add the multiline \n    var glyph = p.multi_line({ field: \"xs\" }, { field: \"ys\" }, {\n\t\tsource: source,\n\t\tline_color: util.get_colors(xs.length)\n    }) \n    \n    var tooltips = [\n\t[\"x\"    , \"$x\" ]  , \n\t[\"y\"    , \"$y\" ] \n    ]\n\n    p.add_tools(new Bokeh.HoverTool({tooltips : tooltips , line_policy : \"next\"} ) ) \n\t\n\tvar el = container\n\tif (typeof container == 'string') { \n\t\tel = document.getElementById(container)\n\t}\n\twhile  (el.firstChild) { el.removeChild(el.firstChild)}\n\tBokeh.Plotting.show(p, el)\n    return { plot : p , glyph : glyph , source : source } \n} \n\nfunction create_multi_line_graph(opts) { \n    var { x_len, series_array, title  } = opts \n    var series_len = series_array.length \n    \n    //make xs and ys vector \n    var xs = [] \n    var ys = [] \n    for (var i =0 ;i < series_len ; i++) { \n\txs.push(make_x_series(x_len))\n\tys.push(make_y_series(x_len))\n    } \n    \n    //make data source \n    var source = new Bokeh.ColumnDataSource( {\n\tdata : {xs : xs, ys : ys }\n    })\n    \n    // make the plot and add some tools\n    //var tools = \"pan,crosshair,wheel_zoom,box_zoom,reset,save\";\n\n    // WOW ! -- how lucky to find sizing_mode : stretch_both lmao \n    // https://github.com/bokeh/bokeh/issues/4958\n    \n    var p = Bokeh.Plotting.figure({ title: title,sizing_mode : 'stretch_both' })\n    \n     \n    //add the multiline \n    var glyph = p.multi_line({ field: \"xs\" }, { field: \"ys\" }, {\n\tsource: source,\n\tline_color: util.get_colors(series_len)\n    }) \n    \n    var tooltips = [\n\t[\"x\"    , \"$x\" ]  , \n\t[\"y\"    , \"$y\" ] \n    ]\n\n    p.add_tools(new Bokeh.HoverTool({tooltips : tooltips , line_policy : \"next\"} ) ) \n    \n    //NEXT STEP -- > NEXT STEP -- > NEXT STEP -- > NEXT STEP -- > NEXT STEP -- > \n    //Need to call Bokeh.Plotting.show(p , HTMLelement) \n    return { plot : p , glyph : glyph , source : source } \n\t     \n    \n} \n\n\n\n// Figured out this function by looking at bokeh source code \nvar bokeh_multi_stream = function(ds, x, ys) { \n    var data = ds.data \n    var xss = data.xs\n    var yss = data.ys \n    // make modifications \n\n    for(var i=0;i<yss.length;i++) {\n\t\n\t//NOTE* if one of the y values is false (or undefined) , then the assumption is that \n\t//the series at that index should NOT BE updated \n\t//Sensors in rosegait return false when they wish NOT to be updated \n\t\n\tif (ys[i]) {\n\t    // -  \n\t    xss[i].push(x)\n\t    xss[i].shift()\n\n\t    // -  \n\t    yss[i].push(ys[i])\n\t    yss[i].shift()\n\t    \n\t} \n    }\n    // re assign the data \n    data.xs = xss \n    data.ys = yss \n    ds.setv('data', data, {\n        silent: true\n    });\n    \n    return ds.trigger('stream');\n}\n\n// < -- START CLASS DEFINITIONS -- START CLASS DEFINITIONS -- START CLASS DEFINITIONS -- > \n\n/* \n * A bokeh real time, multi line graph \n *  \n */\nclass Graph { \n    constructor(opts) { \n\tvar {series_vector, title } = opts \n\tthis.parent = null \n\tthis.opts = opts\n\tthis.series_vector = series_vector \n\tvar x_len = opts.x_len || params.global_x_len \n\tconsole.log(\"Graph with Len : \" + x_len)\n\t\n\tvar multi_opts = { x_len : x_len,\n\t\t\t   title : title ,\n\t\t\t   series_array : series_vector } \n\t\n\tvar  {plot , glyph , source} = create_multi_line_graph(multi_opts) \n\t\n\tvar color = \"#e5efff\" // \"white\" //\"#003559\" //\"#B9D6F2\"\n\tvar alpha = 0.2 \n\tplot.background_fill_color = color\n\tplot.background_fill_alpha = alpha\n\n\tplot.border_fill_color = color\n\tplot.border_fill_alpha = alpha\n\n\tthis.multi_line_graph = plot \n\tthis.source = source \n\tthis.glyph  = glyph \n\t\n    } \n    \n    get_data_source() { \n\treturn this.source \n    } \n    \n    render_into_element(el) { \n\t//el.innerHTML = 'waiting'\n\t//this.parent = el \n\tBokeh.Plotting.show(this.multi_line_graph, el) \n    } \n    \n}\n\n\nexport default class ui { \n    \n    /* \n     * \n     * @param {HTMLElement} parent - The DOM to render the UI into \n     */ \n    constructor(parent) { \n\tthis.graphs = {} \n\tthis.parent = parent \n\tthis.last_series_buffer = {} // holds the previous update sent to graph \n    } \n\n    /* \n     * Add graph to the ui \n     * @param {Object} opts - Dict containing fields: id - graph id , series_vector - vector of Ids for series which will be graphed on this graph \n     */\n    add_graph(opts) { \n\tvar {id, series_vector, x_len} = opts\n\t//console.log(series_vector)\n\tvar graph = new Graph( {series_vector : series_vector, \n\t\t\t\tx_len : x_len , \n\t\t\t\ttitle  : id + \": \" + series_vector.join(\", \")} )   \n\t\t\t       \n\tthis.graphs[id] = graph \n    } \n    \n    /* \n     *\n     * After all graphs have been added, init is called to actually display the graphs \n     *\n     */\n    init(container) { \n\t// logic for displaying all of the added graphs \n\t// should make a panel view of sorts and initialize with empty values \n\tvar graph_array = util.dict_2_vec(this.graphs) \t\n\tthis.graph_array = graph_array  \n\t\n\t// for now will put two graphs side by side \n\tvar n_cols = 2 \n\tvar n_rows = Math.ceil(Object.keys(this.graphs).length/2) \n\t\n\t// some hax  \n\tif (graph_array.length == 1 ) { \n\t    n_cols = n_rows = 1 \n\t} \n\t\n\tutil.bug(\"n_row\" , n_rows) \n\t\n\t// make a grid of divs \n\tvar app_el = util.make_div_array(n_rows,n_cols,\"rgui\",function(r,c,el) { \n\t    //get the graph index\n\t    var index = util.id_from_loc(r,c,n_cols)\n\t    // debug - console.log( [index, graph_array] )\n\t    \n\t    if (index < graph_array.length ) { \n\t\t//get the graph info using destructuring \n\t\tvar [id , graph] = graph_array[index] \n\t\tgraph.render_into_element(el) \n\t    } else { \n\t\t\n\t\treturn \"\" \n\t\t\n\t    }\n\t    \n\t})\n\t\n\t//here we will resolve the container \n\tif ( typeof container == 'string' )  { \n\t    container = document.getElementById(container) \n\t}  // if not for now assume it is the element \n\t\n\t//render the \n\tapp_render(container,app_el)\n\n    } \n\n    /* \n     * Streams data to a particular graph defined by graph_id. \n     * @param {Number} x - The x coordinate for new data \n     * @param {Vector} ys - New y points to add. These should correspond to and be in the same order as the series_vector assoiated with the same graph id\n     */\n    stream_to_graph(id , x , ys ) { \n\tbokeh_multi_stream(this.graphs[id].get_data_source(), x , ys ) \n    }\n    \n    /* \n     * Main data handler. \n     * @param {Object} series_buffer - Dictionary with all the series values for updating\n     */\n    handle_sensor_buffer(x,series_buffer) { \n\t\n\t\n\t//1) loop through the available graphs\n\tfor (var graph in this.graphs ) { \n\t    var series, ys , i , val \n\t    //2) get the series_vector for that graph \n\t    series = this.graphs[graph].series_vector \n\t    //3) look up the values for each series in the sensor_gui_buffer\n\t    ys = Array(series.length).fill(0)\n\t    for (i = 0 ; i < series.length ; i++ ) { \n\t\t//get the value of the series \n\t\tval =  series_buffer[ series[i] ]  \n\t\t\n\t\t//if it is false we pass it anyways (graph will handle it) \n\t\tys[i] = val \n\t    }\n\t    //update the graph \n\t    \n\t    bokeh_multi_stream(this.graphs[graph].get_data_source(), x , ys )\n\t    \n\t}\n\n    }\n\t\n\t\n    static multi_line_graph(container, opts) { \n\tcreate_static_multi_line_graph(container, opts) \n    }\n    \n\n}\n\n\n\n\nvar app_el =  null \n\nvar app_clear = function() { \n    while (app_el.firstChild) {\n\tapp_el.removeChild(app_el.firstChild)  \n    }   \n}\n\nvar app_render = function(container,el) { \n    if (app_el) { \n\tapp_clear() \n    } else { \n\tcontainer.appendChild(el)\n\tapp_el = container\n    }\n}\n\n\n// FOR ARBITRARY GRAPHING -----------------------------------------------                                                   \nfunction dict_to_update(dict) { \n    return dict \n}\n\nfunction get_array_series(o) {\n    //console.log(o)\n    return util.range(0,o.length).map(v=>\"index_\" + v)\n}\n\nfunction get_dict_series(d) { \n    var ret\n    var list = Object.keys(d) \n    //return list   -- allows toggling the removal of time key from object\n    var ind = list.indexOf('time') \n    if (ind >= 0 ) { \n\tlist.splice(ind , 1 ) \n\tret = list \n    } else { ret = list } \n    return ret \n} \n\nfunction array_to_update(arr) { \n    let ser = get_array_series(arr)\n    return util.zip_map(ser, arr)\n}\n\n\nfunction make_graph_for_obj(opts) { \n    var {o, container, x_len, exclude} = opts \n    \n    //delete the fields which we want to exclude from the graph \n    //note this only occurs on the first object processed \n    if (exclude) { \n\tfor (var i of exclude) { \n\t    delete o[i]\n\t} \n    }\n    \n    var graph_ui = new ui()\n    var series   = null \n    //console.log(o)\n    if (typeof o == \"object\") { \n\tif (Array.isArray(o)) {\n\t    // its an array\n\t    console.log(\"Making array grapher\")\n\t    series = get_array_series(o) \n\t    graph_ui.convert = array_to_update\n\t} else {\n\t    // assume its a dict\n\t    console.log(\"Making dict grapher\")\n\t    series = get_dict_series(o) \n\t    graph_ui.convert = dict_to_update\n\t}\n    }\n    \n    graph_ui.add_graph({id  :\"main\", series_vector:  series, x_len : x_len || 500})\n    graph_ui.init(container) \n    graph_ui.init_time = util.now()\n    return graph_ui \n}\n\n\nfunction graph_object(x,o,graph_ui) { \n    let updates = graph_ui.convert(o) \n    //console.log(updates)\n    //apply the updates to the graph \n    graph_ui.handle_sensor_buffer((x-graph_ui.init_time)/1000,updates)  // should work???\n}\n\n\nfunction get_object_grapher(opts) { \n    var {container, x_len, exclude} = opts \n    var grapher = {}\n    grapher.init = true \n    grapher.graph_ui = null \n    \n    grapher.process_data = function(o) { \n\tif (grapher.init) { \n\t    grapher.graph_ui = make_graph_for_obj({o,container,x_len,exclude})\n\t    grapher.init = false \n\t} else { \n\t    var t = util.now()\n\t    //console.log(o)\n\t    graph_object(t,o,grapher.graph_ui)\n\t}\n    }\n    \n    return grapher\n}\n\n\nexport class ui_object_grapher extends base_node { \n    constructor(opts) { \n\tlet node_name = \"UIG\"\n\tlet is_sink = true \n\tsuper({node_name, is_sink })\n\t\n\tlet main_handler = function(payload) { \n\t    if (true) { \n\t\tthis.object_grapher.process_data(payload) \n\t    }\n\t} \n\tthis.configure({main_handler}) \n\tthis.object_grapher = get_object_grapher(opts) \t\n\n\t\n    } \n} \n\n","// Thu Nov  8 18:17:14 PST 2018\n\nimport base_node from  \"./base_node.js\"\n\n/**\n * Applies a transformation function to a data stream \n *\n * @param {Function} f - The function to use as transform \n */\nexport default class transformer extends base_node  {\n    \n    constructor(f) { \n\tlet node_name = \"TF\"\n\tsuper({node_name}) \n\t\n\tlet main_handler = function(payload) { \n\t    return this.f(payload)\n\t}\n\tthis.configure({main_handler})\n\tthis.f =  f\n\n    } \n\n    /** \n     * Set the transformer function \n     * @param {Function} func - Function which accepts ONE raw data object and transforms it.\n     */ \n    set_transformer(func) { \n\tthis.f = func \n    } \n    \n}\n\n","// Thu Nov  8 18:55:08 PST 2018\n\nimport base_node from  \"./base_node.js\"\n\n/**\n * Simulator node for testing data streams\n *\n */\nexport default class simulator extends base_node {\n    \n    constructor(opts) { \n\t\n\tlet node_name = \"SIM\" \n\tlet is_source = true \n\tlet dev_mode = false \n\tsuper({node_name, is_source, dev_mode})  \n\t\n\tlet main_handler = function(payload) { \n\t    return payload //just forwards the data it generates \n\t} \n\t\n\tthis.configure({main_handler}) \n\t\n\tthis.opts  = opts\n\tthis.mode = opts.mode \n\tthis.stream_interval = null \n\t      \n    } \n\n    /**\n     * enable streaming simulated data \n     * \n     */\n    enable_stream(r) { \n\tlet rate = r || 500 \n\tthis.stream_interval = setInterval( (this.send_val).bind(this) , rate ) \n\t\n    }\n    \n    start_stream(r) { \n\tthis.streaming = true \n\tthis.enable_stream(r) \n\t\n    }\n    \n    /** \n     * Stop streaming data \n     */ \n    disable_stream() { \n\tclearInterval(this.stream_interval) \n    }\n    \n    send_val() { \n\t\n\tvar val  ; \n\tswitch (this.opts.mode)  { \n\tcase 'sin' : \n\t    val  = { val :  Math.sin ( (new Date().getTime()) * (this.opts.rate || 0.001) )}\n\t    break  ; \n\tcase 'rand' : \n\t    val = { val : (this.opts.multiplier || 1 ) * Math.random() + (this.opts.offset || 0 ) } \n\t    break ; \n\tcase 'burst' : \n\n\t    var burst = ! ( (new Date).getSeconds() % 5  )\n\t    if (burst ) { \n\t\t//val = {x :  0.1*Math.random() + 10} \n\t\t//console.log(\"burst\")\n\t\tval = {x :  Math.random() + 5, y : Math.random() + 20}\n\t    } else { \n\t\t//val = {x :  0.1*Math.random() + 0.5 }\n\t\tval = {x :  Math.random() + 5, y : Math.random() + 10}\n\t    }\n\t    break ;\n\t} \n\t\n\tthis.trigger_input(val)  // send the val ! \n    } \n       \n}\n\n","//Wed Oct  3 09:42:59 PDT 2018\n// I remembered my development mantra - be patient. simplify. Refactor when necessary \n\nimport ui from \"./ui.js\"\nimport * as util from \"../module_resources/utils.js\"\nimport base_node from  \"./base_node.js\"\n\n/**\n * \n * \n */\n\nexport default class state_machine extends base_node {\n\n    /**\n     * \n     * \n     */ \n    constructor(opts) { \n\tvar {buffer_size, gui_mode, debug_mode, init} = opts\n\tlet node_name = \"SM\" \n\n\tsuper({node_name}) \n\t\n\tlet main_handler = function(payload) { \n\t    this.process_data(payload)  \n\t}\n\t\n\tthis.configure({main_handler}) \n\tthis.buffer_size = buffer_size  || 200 \n\tthis.sensor_buffer_size = buffer_size \n\tthis.buffer = Array(buffer_size).fill(default_data_obj)\n\tthis.sensors = {} \n\tthis.transitioners = {} \n\tthis.transitioner_groups = {} \n\tif (init == undefined ) {this.STATE={}} else {this.STATE=init}\n\tthis.gui_mode = gui_mode \n\tthis.debug_mode = debug_mode || false \n\tif (gui_mode) { \n\t    //create the sensor_gui buffer \n\t    this.sensors_gui_buffer = {}\n\t    \n\t    this.ui_mapping = null\n\t    \n\t    //also create a ui object  \n\t    this.ui = new ui(null) \n\t} \n\t\n    } \n    \n    \n    /** \n     * Initializes the state machine\n     * @param {Object} state - the initial state for the state machine \n     */\n    initialize(state) { \n\tthis.STATE = state \n    } \n\n\n    /** \n     * Updates buffer with a data object. Uses js function `.shift()` to cycle array. \n     * @param {Object} obj - Data object to consume \n     */\n    update_buffer_with_data_object(obj) { \n\tthis.buffer.push(obj) \n\tthis.buffer.shift() \n    } \n    \n    /*\n     * Computes the order that sensors will be evaluated in \n     */\n    set_sensor_order() { \n\tvar compare = function(x,y) { \n\t    var l1 = x[1].level\n\t    var l2 = y[1].level\n\t    //console.log( [l1, l2] ) \n\t    if (l1 > l2 ) {   //index 2 is the level ! \n\t\treturn 1\n\t    } else  { \n\t\treturn -1\n\t    } \n\t}\n\tthis.sensor_order = util.dict_2_vec(this.sensors).sort(compare).map(e=>e[0])\n    }\n    \n    \n    /** \n     * Adds a sensor to the state machine. \n     * @param {Object} opts - contains id, f (function) , level (level 0 is evaluated first , then 1, etc.. ) \n     */\n    add_sensor(opts) { \n\tvar id,f,l\n\tid = opts.id ; f = opts.f ; l = opts.level \n\t//register the sensor \n\tthis.sensors[id] = {} \n  \t//add the function \n\tthis.sensors[id][\"function\"] = f \n\t//and then allocate a buffer for the sensor values \n\tthis.sensors[id][\"buffer\"] = Array(this.sensor_buffer_size).fill(NaN) \n\t//and then allocate the sensor level, 0 if undefined \n\tthis.sensors[id][\"level\"] = l || 0 \n\t//and create the 'last_skipped' flag (see run sensor for more information) \n\tthis.sensors[id][\"last_skipped\"] = false \n\tif (this.debug_mode) { \n\t    this.log(\"Added sensor: \" + id) \n\t}\n\tthis.set_sensor_order() \n    } \n    \n    /** \n     * \n     * Init gui \n     * @param {String|DOM} container - id or reference for container to render into \n     * @param {Object} ui_mapping - Dictionary where keys are graph ids and vals are vectors of the sensors which could be graphed on that graph. E.g { graph-1 : [\"acc_x\", \"acc_z\" ] , etc} \n     */\n    init_gui(container, ui_mapping) { \n\tthis.ui_mapping = ui_mapping \n\t//loop through the graphs \n\tfor (var graph in this.ui_mapping )  { \n\t    var sensors = this.ui_mapping[graph] \n\t    var opts = {id : graph ,series_vector : sensors}     /// POTENTIAL BUG ON NEXT RUN  !? UNLESS FIX IS GOLDEN FIX\n\t    this.ui.add_graph(opts)  // initializes a graph \n\t} \n\t\n\t//after all the graphs have been added then we call init \n\tthis.ui.init(container) \n\t\n    } \n\n    \n    /** \n     * Runs the sensor function with the state machine buffer as input \n     * then updates the corresponding sensor's buffer.\n     * @param {String} id - Sensor id to run   \n     */\n    run_sensor(id) { \n\t//get the sensor function\n\tvar f = this.sensors[id][\"function\"]\n\t//run the sensor passing in the sm object\n\tvar val = f(this) \n\t\n\t/*\n\t  sensors \n\t  only append the value if it exists \n\t  this allows the ability for sensors to act simultaneously as data filters \n\t  by introspecting on the data_packet somehow and deciding to reject it from \n\t  their buffer. \n\t \n\t*/\n\t\n\tif (val != 0 || val != undefined || val != false || val != nflow.SKIP_PAYLOAD) { \n\t    //append the new value to the sensors buffer \n\t    this.sensors[id][\"buffer\"].push(val)\n\t    this.sensors[id][\"buffer\"].shift() \n\t    this.sensors[id][\"last_skipped\"] = false \n\t}  else {\n\t    //the sensor rejected a value. In this case, it can be helpful to set a special \n\t    //flag in case there are sensors which derive from this one and also wish to \n\t    //reject \n\t    this.sensors[id][\"last_skipped\"] = true \n\t}\n\t\n\treturn val \n    } \n\n    /** \n     * Utility function for retrieving the last N values of a sensor's buffer\n     * Used to make it easier to write Detectors \n     * @param {String} id - Sensor id \n     * @param {Number} num - The number of values to retrieve from END of buffer \n     */\n    get_sensor_last_N(id,num) { \n\tif (this.sensors[id][\"last_skipped\"]) { \n\t    //we have skipped a value, so will pass that info on \n\t    return false \n\t} else { \n\t    return this.sensors[id][\"buffer\"].slice(this.buffer_size - num) \n\t}\n    }\n\n    /** \n     * Utility function for retrieving the last value of a sensor's buffer\n     * Used to make it easier to write Detectors \n     * @param {String} id - Sensor id \n     */\n    get_sensor_last_1(id) { \n\tif (this.sensors[id][\"last_skipped\"]) { \n\t    //we have skipped a value, so will pass that info on \n\t    return false \n\t} else { \n\t    return util.first(this.get_sensor_last_N(id, 1 ) )\n\t} \n    }\n    \n    /** \n     * Adds a transitioner to the state machine. \n     * @param {String} id - Transitioner id for reference \n     * @param {Object} transitioner - Transitioner implementation (Object with keys [detector, applicator]) The detector and applicator both  accept the state_machine object in its entirety in order to allow easy access to all fields. \n     */\n    add_transitioner(id,transitioner) { \n\t//make sure it has what we want \n\tif (! (transitioner.detector && transitioner.applicator ) ) { \n\t    throw \"Transitioner object does not contain both detector and applicator!\" \n\t} \n\t\n \t//register the transitioner\n\tthis.transitioners[id] = transitioner \n\t\n\t//if it is part of a group we register that too , and by default activate it \n\tif (transitioner.group) { \n\t    this.transitioner_groups[transitioner.group] = true \n\t}\n\t\n\tif (this.debug_mode) { \n\t    this.log(\"Added transitioner: \" + id) \n\t}\n\n    }\n    \n    /** \n     * Runs the transitioner \n     * @param {String} id - Transitioner to run \n     */\n    run_transitioner(id) { \n\t//get the transitioner  \n\tvar transitioner = this.transitioners[id] \n\t\n\t//get the group and group status\n\tvar group = transitioner.group\n\tvar group_status = this.transitioner_groups[group]\n\t\n\t//only run if group is NULL or if it exists and is TRUE \n\tif ( group_status != false ) {\n\t    \n\t    //get the detector and applicator \n\t    var detector = transitioner.detector \n\t    var applicator = transitioner.applicator \n\n\t    \n\t    //the detector and applicator both  accept the state_machine object in its entirety in order to allow easy access to all fields \n\t    //apply the applicator IF the detector returns true  \n\t    if (detector(this)) { \n\t\tif (this.debug_mode) { this.log(\":match: => \" + id) }\n\t\tapplicator(this)  // the applciator will actually mutate the this.STATE object  \n\t\t// deactivate this group if it is part of one\n\t\tif (group_status) { \n\t\t    this.transitioner_groups[group] = false \n\t\t} \n\t    } else { \n\t\tif (this.debug_mode) { this.log(\":fail: => \" + id) }\n\t    }\n\t    \n\t}\n\t\n    } \n    \n    \n    \n    /** \n     * Run all sensors. Will sort them by the sensor level \n     */\n    run_sensors() { \n\tfor (var i =0 ; i < this.sensor_order.length; i++ ) { \n\n\t    var sensor_id = this.sensor_order[i]\n\t    var val = this.run_sensor(sensor_id) \n\t    \n\t    if (this.debug_mode) {\n\t\tthis.log(\"Ran sensor: \" + sensor_id + \" with result: \" )\n\t\tthis.log(val)\n\t    }\n\t    \n\t    if (this.gui_mode){ \n\t\tthis.sensors_gui_buffer[sensor_id] = val \n\t    }\n\t}\n\t\n    }\n\n\n    /** \n     * Processes a data object, running one cycle of the state machine. \n     * @param {Object} obj - Data object to process \n     */\n    process_data(obj) { \n\t\n\t//1. update the data buffer  \n\tthis.update_buffer_with_data_object(obj) \n\t\n\t//2. now we need to update all of the sensors \n\tthis.run_sensors() \n\t\n\t//3. now we run all the transitioners (which rely on most up to date Sensor values) \n\tfor (var transitioner_id in this.transitioners ) { \n\t    this.run_transitioner(transitioner_id) \n\t} \n\t\n\t//at this point, this.STATE should be updated , one cycle of the state machine has been completed \n\t//in order to reset, we should return the state of all transition groups \n\tfor (var group in this.transitioner_groups) {\n\t    this.transitioner_groups[group] = true \n\t}\n\t\n\t\n\t// after all this is done we will update the ui \n\t//the sensors_gui_buffer is now full and updated and can be passed to the ui for processing \n\t//pass all the sensor data to the UI for updating \n\tif (this.gui_mode) { \n\t    // also we need to give an X coordinate for the data  \n\t    // for now we will pass the 'time' value of the data obj \n\t    \n\t    this.ui.handle_sensor_buffer(obj.time,this.sensors_gui_buffer)\n\t}\n\n\t\n    } \n    \n    /** \n     * For debug purposes and profiling. Processes one cycle with a defualt data object\n     */\n    run_debug_cycle() { \n\tthis.process_data(random_data_obj()) \n    } \n    \n\n    \n}\n\n\nvar default_data_obj = { \n    'acc_x' : 0 , \n    'acc_y' : 0 , \n    'acc_z' : 0 , \n    'gyr_x' : 0 , \n    'gyr_y' : 0 , \n    'gyr_z' : 0 , \n    'sample': 0 , \n    'time'  : 0 , \n    'dev'   : \"B\" \n}\n\n\n//for generating random data packets \nvar m = Math.random \nvar count = 0 \nfunction random_data_obj() { \n    return {'acc_x' : m(),\n\t    'acc_y' : m(),\n\t    'acc_z' : m(), \n\t    'gyr_x' : m(), \n\t    'gyr_y' : m(), \n\t    'gyr_z' : m(),\n\t    'sample': count++ , \n\t    'dev'   : \"B\"}\n} \n","\nimport * as util from \"../module_resources/utils.js\"\nimport base_node from  \"./base_node.js\"\n\n/*\n The event detector accepts a (possibly nested) dictionary as input. It converts the dictionary \n into a linear array of values representing that data structure (see linearize) \n As a new dictionary comes in, \n it calculates the same linear array and takes a log difference @ each index rom the previous. \n \n If at least 1 of the indeces shows a log diff out of bounds of the thresholds, we can say \n a \"change\" has occurred. \n \n The event detector commences in the state \"awaiting_baseline\" \n Baseline is established when no \"change\" has been detected for \"baseline_counter\" number of times \n At this point, when a \"change\" is detected an EVENT is said to begin, and starts being recorded. \n Because of the logic, as long as \"changes\" keep occuring then the event keeps recording. \n Once no changes have occured for \"baseline_counter\" num packets, then baseline is again \n established  and the ED \"flushes\" the event to internal memory and outputs it to the events\n output port\n \n In addition Each packet received is forwarded to the main_ouput, making this a \"through node\"\n */\n\n/**\n * Detects and emits deviation \"events\" from streams of arbitraty data objects\n *\n * @param {Object} opts - configuration options\n */\nexport default class event_detector extends base_node {\n    \n    constructor(opts) { \n\t\n\tlet node_name = \"ED\" \n\tsuper({node_name}) \n\t\n\tlet main_handler = function(payload) { \n\t    this.process_data(payload) \n\t    return payload \n\t} \n\t\n\tthis.configure({main_handler})\n\t\n\t//create events output \n\tthis.new_output(\"events\") \n\t\n\tvar opts = opts || {} \n\tthis.opts =  opts\n\tthis.state =  \"awaiting_baseline\" //  established_baseline | processing_event\n\t\n\t//init counters for estabishing baseline \n\t//baseline will be established when thresholds are respected for \"baseline_counter\" number\n\t//of events \n\tthis.baseline_counter = 0 \n\tthis.baseline_number = opts.baseline_number || 60\n\t\n\t//keep log of events that have been detected \n\tthis.current_event = [] \n\tthis.events =  {} \n\t\t\t\n\t//set detection threshold \n\tthis.detection_params = { upper : null, lower : null } \n\t//detection_thresh expressed as percent difference \n\tthis.init_detection_params(opts.detection_thresh || 30) \n\t\n\t// save the last linearized packet for calculation \n\tthis.last_linearized = null \n\t\n\t// initialize history buffer \n\tthis.history_buffer_size  = opts.history_buffer_size || 50\n\tthis.init_history_buffer()  \n\n\t\n    } \n\n    init_detection_params(t) { \n\tthis.detection_params.upper = Math.log( (t+100)/100 ) \n\tthis.detection_params.lower = Math.log( (100-t)/100 )\n    }\n    \n    in_range(val) { \n\treturn (val >= this.detection_params.lower && val <= this.detection_params.upper) \n    }\n    \n    detect(arr) {\n\treturn !util.apply( util.and , arr.map(this.in_range, this)  )\n    }\n    \n    /** \n     * Statefully checks if detector is at baseline \n     * @param {Boolean} detected - result of this.detect() \n     */\n    check_baseline(detected) { \n\tif (detected) { \n\t    //detected an event, reset the counter\n\t    this.baseline_counter = 0 \n\t    return false \n\t} else { \n\t    //no event detected... increment baseline counter \n\t    this.baseline_counter += 1 \n\t    if (this.baseline_counter > this.baseline_number) { \n\t\t// reset baseline counter  (for later) \n\t\tthis.baseline_counter = 0 \n\t\treturn true \n\t    } \n\t    return false \n\t}\n    }\n    \n    /** \n     * Process a received data object\n     * @param {obj} Data object to receive \n     */ \n    process_data(obj) { \n\n\t//transform the object into linearized struct \n\tlet lp = linearize(reduce(obj))\n\t\n\t//on the first call we will set last_linearized \n\t//and return \n\tif (!this.last_linearized) { \n\t    this.last_linearized = lp\n\t    return \n\t}\n\t\n\t//on all subsequent calls we will get here.. \n\tvar result,bl ; \n\t\n\t//run the detection \n\tlet log_diff = util.array_log_diff(this.last_linearized, lp) \n\tlet detected = this.detect(log_diff) \n\n\tswitch (this.state) { \n\t    \n\tcase \"awaiting_baseline\" : \n\t    bl = this.check_baseline(detected) \n\t    if (bl) { \n\t\tthis.log(\"Baseline established\")\n\t\tthis.state = \"baseline_established\" \n\t    }\n\t    // should we add to history here? \n\t    break; \n\t    \n\tcase \"baseline_established\" :\n\t    // here we are waiting for the detection of an event \n\t    this.add_to_history(obj) //add current obj to history\n\t    if (detected) { \n\t\t//detected an event \n\t\tthis.log(\"Detected event...\") \n\t\tthis.state = \"processing_event\" \n\t\tthis.init_event() //copies contents of history buff into current event\n\t    } else {}  //do nothing\n\t    break; \n\t    \n\tcase \"processing_event\" : \n\t    //add the obj to current event \n\t    this.current_event.push(obj) \n\t    //check if we have reached baseline yet \n\t    bl = this.check_baseline(detected) \n\t    if (bl) { \n\t\tthis.log(\"Event ended\")\n\t\tthis.state = \"baseline_established\" \n\t\tthis.flush_event()\n\t    } else {  } //do nothing\n\t    break ; \n\t    \n\tdefault : \n\t    break ; \n\t} // END switch --- \n\t\n\t\n\treturn log_diff //this is the array of log diffs for each of the linearized indexes \n\n    }\n    \n    /** \n     * Initiate event \n     * \n     */ \n    init_event() { \n\t//copy contents of history buffer into current event \n\tthis.current_event = [] \n\tfor (var i=0;i<this.history_buffer.length;i++) { \n\t    this.current_event.push(this.history_buffer[i])\n\t}\n\treturn null \n    }\n    \n    /** \n     * Flush current event to the event buffer \n     * \n     */ \n    flush_event() { \n\tthis.events[ new Date().getTime() ] = this.current_event\n\t// flush output to specific output pipe \n\t// v2 \n\t\n\tthis.log(\"Flushed event\") \n\t/* will send to events output port */ \n\tlet payload = this.current_event \n\tlet output_port = \"events\" \n\tthis.trigger_output_packet({ output_port, payload}) \n\t\n\tthis.current_event = [] \n    }\n    \n    add_to_history(obj) { \n\tutil.cycle_array(this.history_buffer, obj) \n    }\n\n    \n    /**\n     * init history buffer \n     * \n     */\n    init_history_buffer() { \n\tthis.history_buffer = Array(this.history_buffer_size).fill(0)\n    }\n    \n    \n    \n}\n\n\n\n\n// if array of numbers, return the power of array\n// if its a dictionary, then return the reduced version of all its keys\n// if its a number, return the number\n// for now i wont compare strings\n\nvar  power = util.rms \n    \nfunction map_f_on_dict(d,f) {\n    for (var k in d ) {\n\td[k] = f(d[k]) \n    }\n    return d \n}\n\nfunction reduce_val(v) {\n\n    if (typeof v == \"object\") { \n\tif (Array.isArray(v)) {\n\t    // its an array\n\t    return power(v) \n\t    \n\t} else {\n\t    // assume its a dict\n\t    return map_f_on_dict(v, reduce_val) \n\t}\n    } else {\n\n\t// assume its a number\n\treturn v  \n\n    }\n\n}\n\nvar reduce = reduce_val \n\nfunction reduce_dict(obj) {\n    return map_f_on_dict(obj, reduce_val)\n}\n\nlet test_dict = { acc : [ 1,2,3,4,5] , gyr : { foo : 2 , bar : [1,2,3,4,5] } , happy : 1 } \n\n/* \n * loop through keys\n * if num, push num to ret \n * if dict, push the recursive result\n */\nfunction linearize_dict(obj) {\n    var result = []\n    for (var k in  obj) {\n\tif (typeof obj[k]  == \"object\" ) {\n\t    result.push( linearize_dict(obj[k]) ) \n\t} else {\n\t    result.push(obj[k])\n\t} \n    }\n    let flattened =  [].concat.apply([], result)\n    return flattened \n\n} \n\nfunction linearize(obj) {\n    return linearize_dict(obj) \n} \n\n\n","// bundles all the modules into one object \n// Mon Oct 22 22:16:23 PDT 2018\n\nimport base_node  from \"./core_modules/base_node.js\" \nimport data_storage from \"./core_modules/data_storage.js\" \nimport web_socket from \"./core_modules/web_socket.js\" \nimport logger_node from \"./core_modules/logger_node.js\" \nimport ui from \"./core_modules/ui.js\" \nimport {ui_object_grapher} from \"./core_modules/ui.js\"\nimport transformer from \"./core_modules/transformer.js\" \nimport simulator from \"./core_modules/simulator.js\" \nimport state_machine from \"./core_modules/state_machine.js\" \nimport event_detector from \"./core_modules/event_detector.js\" \n\nexport var mods = { web_socket, data_storage , state_machine, ui, transformer, simulator, logger_node, event_detector ,base_node, ui_object_grapher }\n\n","import {util}     from \"./utils.js\"\n\nvar smu = { sensors : {} , transformers : {}  } \n\nsmu.sensors.field = function(field) { \n    return function(sm) { \n\tlet d = sm.buffer \n\treturn util.last(d)[field] \n    }\n} \n\n\nexport { smu } \n","import {util}     from \"./module_resources/utils.js\"\n\nvar dev = { vars : {} } \n\n\ndev.msg = \"Used for shipping development objects and functions with wrtsm\" \n\nexport { dev } \n","import {mods}  from  \"./module_bundle.js\"\nimport {smu}   from  \"./module_resources/sm_utils.js\" \nimport {dev}   from  \"./dev.js\"\nimport sample_walk  from  \"./module_resources/sample_walk.json\"\n\n\n// defines object that will be attached to window \nvar nflow = {}  \n\n//give it modules\nnflow.mods = mods \nnflow.smu  = smu \nnflow.dev  = dev\n\n//load sample data \nnflow.resources = { sample_walk }\n\n//define global data params \nnflow.SKIP_PAYLOAD = \"nflow_skip_payload_0000001\"    //could alternatively use uuid\n\n//add it to window \nwindow.nflow = nflow\n\n\n//export it for use \nexport { nflow } \n\n\n\n\n\n","//Fri Oct  5 19:31:23 PDT 2018\n\n// filefor collecting definitions of Sensors and transitioners\n\nimport {logger} from \"../core_modules/logger.js\"\nimport {util}     from \"./utils.js\"\n\nlogger.register(\"sme\") \n\nvar sme = { sensors : { dev_a : {} , dev_b : {} } , \n\t    transitioners : {} }  \n\n\n//extract a specific field from the data objects \n//i.e. [{:acc_x :acc_y... } , ... ] => [ acc_x, acc_x ... ] \nsme.sensors.field = function(field) { \n    return function(sm) { \n\treturn util.last(sm.buffer)[field] \n    }\n} \n\n\n//field diff will take the  diff of a particular field in the data object \nsme.sensors.field_diff = function(field) { \n    return function(d) { \n\td = d.buffer \n\tvar l = d.length \n\treturn d[l-1][field] - d[l-2][field]\n    }\n} \n\n\n\nsme.is_dev_b = function (d) { \n    return d.dev == \"B\" \n} \n\nsme.is_dev_a = function (d) { \n    return d.dev == \"A\" \n} \n\nsme.sensors.dev_b.field = function(field) { \n    //return sme.generic_filter(sme.is_dev_b , d=>d[field] ) \n    return function(d) {\n\tvar buf = d.buffer \n\tvar d = util.last(buf) \n\tif (d.dev == \"B\") { \n\t    return d[field]\n\t} else { \n\t    util.debug(\"filter miss\")\n\t    return false }\n    }\n}\n\nsme.transitioners.test_turn_on  = { \n    \"detector\" : function(state_machine) { \n\treturn !state_machine.STATE.is_on \n\t\n    } , \n    \"applicator\" : function(state_machine) { \n\tstate_machine.STATE.is_on = true \n\tif (state_machine.debug_mode ) { logger.sme(\"TURNED ON\") }\n    },\n    \"group\" : \"switch\" \n}\n\n\nsme.transitioners.test_turn_off  = { \n    \"detector\" : function(state_machine) { \n\treturn state_machine.STATE.is_on \n    } , \n    \"applicator\" : function(state_machine) { \n\tstate_machine.STATE.is_on = false  \n\tif (state_machine.debug_mode ) { logger.sme(\"TURNED OFF\") }\n    } , \n    \"group\" : \"switch\" \n}\n\n\n\n\nexport { sme } \n","import {mods}  from  \"./module_bundle.js\"\nimport {smu}   from  \"./module_resources/sm_utils.js\" \nimport {dev}   from  \"./dev.js\"\n\n// defines object that will be attached to window \nvar wrtsm = {}  \n\n//give it modules\nwrtsm.mods = mods \nwrtsm.smu  = smu \nwrtsm.dev  = dev\n\n\n\n//add it to window \nwindow.wrtsm = wrtsm \n\n\n//export it for use \nexport { wrtsm } \n\n\n\n","1//Fri Oct  5 18:28:58 PDT 2018\n// workflows for RoseGait  \n\nimport util     from \"../module_resources/utils.js\"\nimport {sme}      from \"../module_resources/state_machine_elements.js\"\nimport {wrtsm}  from \"../wrtsm.js\"\nimport {logger} from \"../core_modules/logger.js\"\n\nlogger.register(\"rg\") \n\nvar flow = {} \n\nflow.test_storage_persist = function(name) { \n    //1. create web_socket object \n    ws = new wrtsm.mods.web_socket(\"ws://localhost:1234\") \n\n    //2. create data_storage object \n    ds = new wrtsm.mods.data_storage(name) \n\n    //3. create pipe manager object and connect 1 & 2 \n    pm = new wrtsm.mods.pipe_manager() \n    pm.connect(ws,ds) \n\n    //4. Enable saving on the data_storage object every 5s  \n    ds.start_saving(5) \n\n    //5. connect the websocket (which should automatically start receiving data) \n    ws.connect()\n    \n    //6. Stop streaming after 20s \n    setTimeout(function() { \n\tws.stop_stream() \n\tds.stop_saving() \n\tconsole.log(\"Streaming and saving stopped.\") \n    }, 21*1000)\n    \n} \n\n\nflow.test_storage_replay = function() { \n    //1. create data_storage object & load session \n    ds = new wrtsm.mods.data_storage(\"eugene_walk_rev\") \n    ds.load_session() \n    \n    //2. create raw_analyzer object \n    ra = new wrtsm.mods.raw_analyzer() \n\n    //3. create pipe manager object and connect 1 & 2 \n    pm = new wrtsm.mods.pipe_manager() \n    pm.connect(ds,ra) \n\n    //4. start the stream ! \n    ds.start_stream() \n    \n    return [ds,ra ] \n\n} \n\nflow.test_state_machine = function(n) {\n    logger.rg(\"Creating state machine with size: \" + n) \n    var sm = new wrtsm.mods.state_machine({buffer_size : n, gui_mode:  false } ) \n    sm.initialize({\"is_on\" : false }) \n    \n    logger.rg(\"Adding sensors\") \n    sm.add_sensor({id:\"acc_x\" , f:sme.sensors.field(\"acc_x\"), graph : \"g1\"})\n    sm.add_sensor({id: \"acc_x_diff\" ,f: sme.sensors.field_diff(\"acc_x\"), graph : \"g1\"})\n    \n    logger.rg(\"Adding transitioners\") \n    sm.add_transitioner(\"test_turn_on\", sme.transitioners.test_turn_on ) \n    sm.add_transitioner(\"test_turn_off\", sme.transitioners.test_turn_off ) \n    \n    // ok so at this point everything should be initialized and we should be able \n    // to start profiling and inspecing the state machine \n    logger.rg(\"Returning sm\") \n    return sm \n    \n    \n    \n} \n\n\nflow.test_state_machine_gui = function(d) {\n    var n = 200 \n    logger.rg(\"Creating state machine with size: \" + n) \n    var sm = new wrtsm.mods.state_machine({buffer_size : n, gui_mode:  true } ) \n    sm.initialize({\"is_on\" : false }) \n    \n    logger.rg(\"Adding sensors\") \n    sm.add_sensor({id:\"acc_x\" , f:sme.sensors.field(\"acc_x\"), graph : \"g1\"})\n    sm.add_sensor({id: \"acc_x_diff\" ,f: sme.sensors.field_diff(\"acc_x\"), graph : \"g1\"})\n    \n    logger.rg(\"Adding transitioners\") \n    sm.add_transitioner(\"test_turn_on\", sme.transitioners.test_turn_on ) \n    sm.add_transitioner(\"test_turn_off\", sme.transitioners.test_turn_off ) \n    \n    // ok so at this point everything should be initialized and we should be able \n    // to start profiling and inspecing the state machine \n\n    sm.init_gui(\"wrtsm\",d) \n\n    logger.rg(\"Returning sm\") \n    return sm \n    \n    \n    \n} \n\nflow.playback_gui = function(d) {\n    var n = 200 \n    logger.rg(\"Creating state machine with size: \" + n) \n    var sm = new wrtsm.mods.state_machine({buffer_size :n, gui_mode:  true, debug_mode : false }) \n    \n    logger.rg(\"Adding sensors\") \n    sm.add_sensor({id:\"dev_b_gyr_z\" , f:sme.sensors.dev_b.field(\"gyr_z\") })\n    //sm.add_sensor({id: \"acc_x_diff\" ,f: sme.sensors.field_diff(\"acc_x\")})\n    sm.add_sensor({id: \"acc_y\" ,f: sme.sensors.field(\"acc_y\")})\n    sm.add_sensor({id: \"gyr_z\" ,f: sme.sensors.field(\"gyr_z\")})\n\n    logger.rg(\"Adding transitioners\") \n    sm.add_transitioner(\"test_turn_on\", sme.transitioners.test_turn_on )\n    sm.add_transitioner(\"test_turn_off\", sme.transitioners.test_turn_off )\n\n\n    // ok so at this point state machine should be initialized \n    logger.rg(\"Calling sm.init_gui\") \n    sm.init_gui(\"wrtsm\", d) \n    \n    //will load the file from storage \n    var ds = new wrtsm.mods.data_storage(\"eugene_walk_rev\") \n    ds.load_session() \n    \n    //and then create a pipe manager to connect the stored data file to the state machine \n    var pm = new wrtsm.mods.pipe_manager() \n    pm.connect(ds,sm) \n    \n    //return them and can call ds.start_stream() for continuous simulation \n    //OR ds.stream_single_packet() to step one sample\n    return [ds, pm, sm ] \n\n} \n\n\nflow.graph_dances = function() { \n    var d = { g1 : [\"acc_x\", \"acc_y\"] } //, \"gyr_z\"] }  \n    //[sm,d] = test_state_machine_gui({ g1 : [\"acc_x\"] , g2 : [ \"acc_y\"] }) \n    var sm = flow.test_state_machine_gui(d) \n    //[sm,d] = test_state_machine_gui({ g1 : [\"acc_x\",  \"acc_y\"] , g2 : [  \"gyr_z\"] })\n    //util.app_render(test_div_array(1,2)) \n\n\n    var line_dance = function() { \n\tsm.ui.handle_sensor_buffer(200+speed*counter, {acc_x : 0.5*counter , acc_y : -0.5*counter})\n    }\n\n    var sine_rate = 2/100\n    var sine_rate_2 = 5/100\n    var sine_rate_3 = 7/100\n    var sine_dance_0 = function() { \n\tsm.ui.handle_sensor_buffer(200+speed*counter, {acc_x : Math.sin(sine_rate*counter) , acc_y : -Math.sin(sine_rate_2*counter)})\n    }\n\n    var sine_dance_1 = function() { \n\tsm.ui.handle_sensor_buffer(200+speed*counter, {acc_x : Math.sin(sine_rate*counter) , acc_y : -Math.sin(sine_rate_2*counter) , gyr_z : Math.sin(sine_rate_3*counter)})\n    }\n\n\n    var speed = 20\n    var counter = 0 \n    var a = setInterval( (function() { \n\tsine_dance_0()\n\tcounter++ \n    }), 50 ) \n    var stop = function() { \n\tclearInterval(a) \n    }\n\n    return [sm  , a,  stop ] \n\n}\n    \n\n\n// [0,1,2,3,4] \n//  [1,1,1,1] \n\nflow.graph_sm_test = function() { \n    //now we will loop and do the perf \n    var num = 200\n    var interval = 1\n    var start = 2\n    var sizes = Array(num).fill(0) \n    var results = Array(num).fill(0) \n    for (var i = 0; i < num ; i ++ ) { \n\tvar size = start + i * interval \n\tsizes[i] = size \n\t//create the sm \n\tvar sm = test_state_machine(size) \n\t\n\t//define the perf function \n\tvar test_cycle = ( function() { \n\t    sm.run_debug_cycle() \n\t}).bind(sm)\n\t\n\t//now we perf it \n\tresults[i] = util.perf(test_cycle)\n    } \n    \n    //at this point results should be full . \n    logger.rg(\"Graphing results... \") \n    bar_graph(\"Perf\" , \"size\", \"time\" , sizes, results ) \n    logger.rg(\"hmm.. ?\")\n}\n    \n    \n// want to be able to play back data \n/* \nA brief historical aside: \nat first I recorded the data withuot converting the Strings inside the objects to numbers \nTo solve, I loaded the recorded file, then mapped the conversion accross the loaded buffer \nThen I made a new wrtsm.mods.data storage object with _rev extension, and connecnted d1 to d2. \nThen I started d2.save and d1.stream \nvoila \n */ \n\nflow.EW = function() { \n    d = new wrtsm.mods.data_storage(\"eugene_walk_rev\") \n    d.load_session() \n    \n    //at this pt data is accesible in d.loaded_sesssion \n    return d \n} \n    \n\n\n\nexport {flow} \n\n","\nvar sounds = {} \nsounds.ctx = new AudioContext()\n\nsounds.osc = function(type , freq, gainVal){\n    var osc, gain \n    \n    osc = sounds.ctx.createOscillator()\n    osc.frequency.value = freq\n    gain = sounds.ctx.createGain()\n    osc.type = type\n    gain.connect(sounds.ctx.destination)\n    gain.gain.value = gainVal\n    osc.connect(gain)\n    osc.start()\n    return osc \n} \n\n\n\n\n\n\n\nvar beep_time = 150\nvar beep_dic = { 0 : 300 , 1 : 350 , 2 : 400 , 3 : 450 , 4 : 500 }\nfunction beep(n) { \n    var f = beep_dic[n]\n    var s = sounds.osc(\"sine\" , f , 1 ) \n    setTimeout( function() {s.stop() } , beep_time)\n}\n\n\nexport { beep } \n\n\n","export function load_script(url,cb){\n\n    var script = document.createElement(\"script\")\n    script.type = \"text/javascript\";\n\n    if (script.readyState){  //IE \n        script.onreadystatechange = function(){\n            if (script.readyState == \"loaded\" ||\n                    script.readyState == \"complete\"){\n                script.onreadystatechange = null;\n\t\tif (cb) { \n                    cb();\n\t\t}\n            }\n        };\n    } else {  //Others\n        script.onload = function(){\n\t    if (cb) {\n\t\tcb();\n\t    }\n        };\n    }\n\n    script.src = url;\n    document.getElementsByTagName(\"head\")[0].appendChild(script);\n}\n\n\nexport function load_css(url,cb) { \n    \n    var link = document.createElement(\"link\")\n    link.type = \"text/css\";\n    link.rel = 'stylesheet';\n\n\n    if (link.readyState){  //IE \n        link.onreadystatechange = function(){\n            if (link.readyState == \"loaded\" ||\n                    link.readyState == \"complete\"){\n                link.onreadystatechange = null;\n\t\tif (cb) { \n                    cb();\n\t\t}\n            }\n        };\n    } else {  //Others\n        link.onload = function(){\n\t    if (cb) {\n\t\tcb();\n\t    }\n        };\n    }\n\n    link.href = url;\n    document.getElementsByTagName(\"head\")[0].appendChild(link);\n}\n    \n","import * as util from \"./utils.js\" \n\n\n/* my JS interface to Bokeh */ \n\n\n/* \n   \n Render plot into element: Bokeh.Plotting.show(plot, el)  \n Create data source: new Bokeh.ColumnDataSource( {data : {xs : _ , ys : }} ) \n Make Figure : Bokeh.Plotting.figure({title: _ , sizing_mode : 'stretch_both'})\n Using data source:  \n    var glyph = p.multi_line({ field: \"xs\" }, { field: \"ys\" }, {\n\tsource: source,\n\tline_color: util.get_colors(series_len)\n    }) \n \n Changing data source: \n function addPoint() {\n    // The data can be added, but generally all fields must be the\n    // same length.\n    source.data.x.push(Math.random());\n    source.data.y.push(Math.random());\n    // Also, the DataSource object must be notified when it has changed.\n    source.change.emit();\n }\n \n   \n */ \n\nexport function get_el(id) { \n    return document.getElementById(id) \n}\n\nexport function _make_bar_plot(opts) { \n    var {x , y, width, title } = opts \n    var source = new Bokeh.ColumnDataSource({\n\tdata: {x:x,top:y} \n    })\n    \n    //make plot \n    let p = Bokeh.Plotting.figure({title : title||\"bokeh plot\"})\n    \n    // add a Vbar glyph\n    var vbar = new Bokeh.VBar({\n\tx: { field: \"x\" },\n\ttop: { field: \"top\" },\n\tbottom : 0 , \n\tfill_color : \"#f46d43\" , \n\twidth : width || 0.5  \n    });\n    \n    p.add_glyph(vbar,source) \n    return {plot: p , source : source } \n}\n\nexport function _make_line_plot(opts) { \n    var {x , y, title } = opts \n    var source = new Bokeh.ColumnDataSource({\n\tdata: {x:x,y:y} \n    })\n    \n    //make plot \n    let p = Bokeh.Plotting.figure({title : title||\"bokeh plot\"})\n    \n    // add a Vbar glyph\n    var l = new Bokeh.Line({\n\tx: { field: \"x\" },\n\ty: { field: \"y\" },\n\tline_color : \"#f46d43\" , \n    });\n\n    var c = new Bokeh.Circle({\n\tx: { field: \"x\" },\n\ty: { field: \"y\" },\n\tfill_color : \"#f46d43\",\n\tsize : 2 , \n    });\n\n    p.add_glyph(l,source) \n    p.add_glyph(c,source) \n    \n    return {plot: p , source : source } \n}\n\n\n\nexport function set_bokeh_default_container(el) { \n    if (typeof el == \"string\") { \n\tel = document.getElementById(el)\n    }\n    window.bokeh_default_container = el \n}\n\nexport function get_bokeh_default_container(){ \n    return window.bokeh_default_container || document.getElementById(\"nflow\") \n}\n\n\nvar  plot_dict  = { \"bar\"  : _make_bar_plot , \n\t\t    \"line\" : _make_line_plot} \n\n\nexport function bokeh_plot(plot,container) { \n    while (container.firstChild) { container.removeChild(container.firstChild) } \n    Bokeh.Plotting.show(plot,container) \n}\n    \nfunction plot(opts, kind) { \n    if (opts.x == undefined) { \n\topts.x = util.range(0,opts.y.length)\n    } \n    \n    let plot_maker  = plot_dict[kind]\n    var {plot, source} = plot_maker(opts)\n    let container = opts.container || get_bokeh_default_container() \n    bokeh_plot(plot,container) \n    return  {plot, source } \n}\n\nexport function bar_plot(opts) { \n    return plot(opts, \"bar\")\n} \n\nexport function line_plot(opts) { \n    return plot(opts, \"line\")\n} \n\n\n\nexport function go() { \n    let p1  = bar_plot() \n    Bokeh.Plotting.show(p1,get_el(\"nflow\"))\n}\n\n\n/* \n   TODO : build legit javascript interface for graphing ! :) \n   consider incorporating into util somehow/making it a global file ! \n   */ \n","import {sme}      from \"../module_resources/state_machine_elements.js\"\nimport {logger} from \"../core_modules/logger.js\"\nimport * as util from \"../module_resources/utils.js\"\nimport * as bokeh from \"../module_resources/bokeh.js\"\n\n\nlet mods = nflow.mods \nlet ui   = nflow.mods.ui \n\nexport function gait_detector(opts) { \n    var verb = true \n    var mi_detect = 10\n    var num_cycles = 3\n    var num_dec  = 15 \n    // will use state machine api \n    \n    //will define states  \n    var states = {'pre_mi' : 0 , \n\t\t  'monotonically_increasing' : 1 , \n\t\t  'monotonically_decreasing_pre_0' : 2, \n\t\t  'monotonically_decreasing_post_0' : 3 , \n\t\t  'hs' : 4, \n\t\t  'pre_to' : 5 , \n\t\t  'to'  : 6 } \n    \n    //define init state \n    var init = states.pre_mi\n    \n    var new_opts = util.merge(opts,{init : init})\n    \n    //make state machine \n    var sm = new nflow.mods.state_machine(new_opts)\n\n    //initialize params \n    sm.num_cycles = 0\n    \n    // will only use gyr_z \n    sm.add_sensor({id : \"gyr_z\", f : function(sm) {\n\tvar d = util.last(sm.buffer)\n\treturn d['gyr_z']\n    }})\n\n    // will define the state machine transitioners \n    var p_mi = { \n\t\"detector\" : function(sm) { \n\t    if (sm.STATE != states.monotonically_increasing) { \n\t\tvar last_N = sm.get_sensor_last_N(\"gyr_z\", mi_detect) \n\t\t//console.log(last_N)\n\t\treturn util.array_and(util.diff(last_N).map(x=>x>0)) && (util.last(last_N) > 0)\n\t    } else {return false } \n\t}, \n\t\"applicator\" : function(sm) { \n\t    sm.STATE = states.monotonically_increasing \n\t    sm.num_cycles += 1 \n\t    \n\t    if (sm.num_cycles == 1 ) { \n\t\tsm.cycles_start_index = sm.data_counter \n\t    }\n\t    \n\t    if (verb) { console.log(\"MI\") \n\t\t\tconsole.log(\"Cycle: \" + sm.num_cycles) } \n\t    \n\t    if (false ) {\n\t    //if (sm.num_cycles == num_cycles) { \n\t\tsm.cycles_end_index = sm.data_counter \n\t\tconsole.log(\"WALKING!!!\") \n\t\tconsole.log(\"Analysis period: \")\n\t\tconsole.log([sm.cycles_start_index,sm.cycles_end_index].toString())\n\t\t//extract from buffer\n\t\tlet num_to_get = sm.cycles_end_index - sm.cycles_start_index\n\t\twindow.data = sm.buffer.slice(-num_to_get) \n\t\tnflow.bokeh.line_plot({ y : window.data.map(e=>e.gyr_z) } ) \n\t\t\n\t    }\n\n\t    \n\t},\n\t\"group\" : \"gait\" \n    } \n    // - \n    var mi_md = { \n\t\"detector\" : function(sm) { \n\t    if (sm.STATE == states.monotonically_increasing) { \n\t\tvar last_2 = sm.get_sensor_last_N(\"gyr_z\", 2) \n\t\treturn ( (last_2[1] - last_2[0]) < 0 ) \n\t    }\n\t    else { return false }\n\t},\n\t\"applicator\" : function(sm) { \n\t    sm.STATE = states.monotonically_decreasing_pre_0\n\t    if (verb) { console.log(\"MD\") } \n\t},\n\t\"group\" : \"gait\"\n    }\n    // -\n    var md_mdp0 = { \n\t\"detector\" : function(sm) { \n\t    if (sm.STATE == states.monotonically_decreasing_pre_0) { \n\t\tvar last_2 = sm.get_sensor_last_N(\"gyr_z\", 2) \n\t\treturn ( (last_2[1] - last_2[0]) < 0 ) && ( last_2[1] < 0 ) \n\t    } else { return false } \n\t}, \n\t\"applicator\" : function(sm) { \n\t    sm.STATE = states.monotonically_decreasing_post_0\n\t    if (verb) { console.log(\"MDp0\") } \n\t}, \n\t\"group\" : \"gait\" \n    }\n    var md_0 = { \n\t\"detector\" : function(sm) { \n\t    if (sm.STATE == states.monotonically_decreasing_pre_0) { \n\t\tvar last_2 = sm.get_sensor_last_N(\"gyr_z\", 2) \n\t\treturn ( (last_2[1] - last_2[0]) > 0 ) && ( last_2[1] > 0 ) \n\t    } else { return false } \n\t}, \n\t\"applicator\" : function(sm) { \n\t    sm.STATE = states.pre_0\n\t    if (verb) { console.log(\"md_0!\") } \n\t    \n\t    sm.num_cycles = 0\n\t    \n\t}, \n\t\"group\" : \"gait\" \n    }\n    \n    \n    var mdp0_hs = { \n\t\"detector\" : function(sm) { \n\t    if (sm.STATE == states.monotonically_decreasing_post_0) { \n\t\tvar last_2 = sm.get_sensor_last_N(\"gyr_z\", 2) \n\t\treturn ( (last_2[1] - last_2[0]) > 0 ) \n\t    } else { return false } \n\t}, \n\t\"applicator\" : function(sm) { \n\t    sm.STATE = states.hs\n\t    sm.num_dec = 0 \n\t    nflow.beep(1)\n\t    if (verb) { console.log(\"HS\") } \n\t}, \n\t\"group\" : \"gait\" \n    }\n    \n     var hs_pto = { \n\t\"detector\" : function(sm) { \n\t    if (sm.STATE == states.hs) { \n\t\tvar last_2 = sm.get_sensor_last_N(\"gyr_z\", 2) \n\t\tif  (last_2[1] - last_2[0] < 0  )  { \n\t\t    sm.num_dec += 1 \n\t\t}\n\t\treturn (sm.num_dec >= num_dec )\n\t    } else { return false } \n\t}, \n\t\"applicator\" : function(sm) { \n\t    sm.STATE = states.pto\n\t    if (verb) { console.log(\"pto\") } \n\t}, \n\t\"group\" : \"gait\" \n    }\n    \n    var pto_to = { \n\t\"detector\" : function(sm) { \n\t    if (sm.STATE == states.pto) { \n\t\tvar last_2 = sm.get_sensor_last_N(\"gyr_z\", 2) \n\t\treturn ( (last_2[1] - last_2[0]) > 0 ) \t\t\n\t    } else { return false } \n\t}, \n\t\"applicator\" : function(sm) { \n\t    sm.STATE = states.to\n\t    nflow.beep(3) \n\t    if (verb) { console.log(\"to\") } \n\t}, \n\t\"group\" : \"gait\" \n    }\n    //now we add the transitioners \n    sm.add_transitioner(\"p_mi\", p_mi)\n    sm.add_transitioner(\"mi_md\", mi_md)\n    sm.add_transitioner(\"md_mdp0\", md_mdp0)\n    sm.add_transitioner(\"md_0\", md_0)\n    sm.add_transitioner(\"mdp0_hs\", mdp0_hs)\n    sm.add_transitioner(\"hs_pto\", hs_pto)\n    sm.add_transitioner(\"pto_to\", pto_to)\n    \n    var d = { main : [\"gyr_z\" ] } \n    if (opts.gui_mode ) { \n\tsm.init_gui(\"nflow\", d) \n    }\n\n    return sm \n} \n","import {sme}      from \"../module_resources/state_machine_elements.js\"\nimport {logger} from \"../core_modules/logger.js\"\nimport * as util from \"../module_resources/utils.js\"\nimport {gait_detector} from \"./gait_detector.js\"\nimport * as bokeh from \"../module_resources/bokeh.js\"\n\nlogger.register(\"dev\") \nwindow.addEventListener(\"nflow_ready\" , nflow_init) \n\nlet mods = nflow.mods \nlet ui   = nflow.mods.ui \n\n// look at dev_old.js for workflows from previous versions \n\n\n\nexport function sm_ds_test() { \n    var n = 200 \n    logger.dev(\"Creating state machine with size: \" + n) \n    var sm = new nflow.mods.state_machine({buffer_size :n, gui_mode:  true, debug_mode : false }) \n    \n    logger.dev(\"Adding sensors\") \n    sm.add_sensor({id: \"gyr_z\" ,f: sme.sensors.dev_b.field(\"gyr_z\")})\n\n    logger.dev(\"Calling sm.init_gui\") \n    sm.init_gui(\"nflow\", { main : [\"gyr_z\" ] } ) \n    \n    //will load the file from storage \n    var ds = new nflow.mods.data_storage(\"eugene_walk_rev\") \n    ds.enable_stream() \n        \n    //and then connect\n    ds.connect(sm) \n    \n    //and start stream \n    ds.start_stream() \n    \n    window.ds = ds ; window.sm = sm ;\n} \n\nexport function test_sim_tf() { \n    let sim = new mods.simulator({mode : \"sin\" , rate : 0.005 } ) \n    let tf = new mods.transformer(function(d) { return {y : d['val'] + 10 } }  ) \n    let ui = new mods.ui_object_grapher({container: \"nflow\"  , x_len : 200} ) \n    let l  = new mods.logger_node() \n    //sim.connect(tf).connect(l).connect(ui)\n    sim.connect(tf).connect(ui)\n    sim.start_stream(50) \n    window.sim = sim \n    window.tf  = tf \n    window.ui  = ui \n} \n\nexport function test_ED() { \n    let sim = new mods.simulator({mode : \"burst\" })\n    let l   = new mods.logger_node() \n    let ed  = new mods.event_detector() \n    //let ui  = new mods.ui_object_grapher({container: \"nflow\" , x_len : 100 }) \n    \n    //sim.connect(l).connect(ed)\n    sim.connect(ed).connect(l, {output_port : \"events\"})\n    sim.start_stream(30)\n    window.sim = sim \n\n} \n\nexport function test_base() { \n    let n1 = new mods.base_node() \n    let n2 = new mods.base_node() \n    n1.connect(n2) \n    return {n1, n2 } \n}\n\nexport function dev_x1() { \n    let d = new nflow.mods.data_storage(\"eugene_walk_rev\")\n    let l = new nflow.mods.logger_node()\n    d.connect(l) \n    d.start_stream()\n    window.d = d \n    window.l = l \n}\n\n\n\n\nexport function tut_1() { \n   //1. Get the sample data from nflow lib\n   let sample_walk = nflow.resources.sample_walk \n\n   //2. Create a data_storage node with session_id 'sample_walk' which will hold the data\n   let walk_simulator = new nflow.mods.data_storage(\"sample_walk\")\n   walk_simulator.set_session(sample_walk)   \n    \n    //3. Create logger node \n   let logger_node = new nflow.mods.logger_node() \n   \n   //4. Connect the data_storage node to the logger node \n   walk_simulator.connect(logger_node) \n   \n   //5. Start streaming data and stop after 1 s \n   walk_simulator.start_stream() \n   setTimeout( function() { walk_simulator.stop_stream() } , 1000) \n} \n\nexport function tut_2() { \n  //1. Get the sample data from nflow lib\n   let sample_walk = nflow.resources.sample_walk \n\n   //2. Create a data_storage node with session_id 'sample_walk' which will hold the data\n   let walk_simulator = new nflow.mods.data_storage(\"sample_walk\")\n   walk_simulator.set_session(sample_walk) \n   \n   //3. Create logger node \n   let logger_node = new nflow.mods.logger_node() \n   \n   //4. Create our transformer \n   let transformer = new nflow.mods.transformer(function(payload) { \n   if (payload.dev == 'B') { \n   return {gyr_z : payload.gyr_z , dev : payload.dev }\n   } else { \n   return nflow.SKIP_PAYLOAD\n   } \n   })\n   \n   //5. Connect the nodes together! \n   walk_simulator.connect(transformer).connect(logger_node) \n   \n   //6. Start streaming data and stop after 1 second\n   walk_simulator.start_stream() \n   setTimeout( function() { walk_simulator.stop_stream() } , 1000) \n    \n} \n\n\nexport function tut_3() { \n    //1. Get the sample data from nflow lib\n    let sample_walk = nflow.resources.sample_walk \n\n    //2. Create a data_storage node with session_id 'sample_walk' which will hold the data\n    let walk_simulator = new nflow.mods.data_storage(\"sample_walk\")\n    walk_simulator.set_session(sample_walk) \n    \n    //3. Create grapher \n    let grapher =  new nflow.mods.ui_object_grapher( {container : \"nflow\" , exclude : [\"dev\"]} ) \n    \n    //4. Create our transformer \n    let transformer = new nflow.mods.transformer(function(payload) { \n\tif (payload.dev == 'B') { \n            return {gyr_z : payload.gyr_z , dev : payload.dev }\n\t} else { \n            return nflow.SKIP_PAYLOAD\n\t} \n    })\n    \n    //5. Connect the nodes together! \n    walk_simulator.connect(transformer).connect(grapher) \n    \n    //6. Start streaming data and stop after 10 second\n    walk_simulator.start_stream() \n    setTimeout( function() { walk_simulator.stop_stream() } , 10000) \n    \n    \n} \n\nexport function tut_4() { \n    //1. Get the sample data from nflow lib\n    let sample_walk = nflow.resources.sample_walk \n\n    //2. Create a data_storage node with session_id 'sample_walk' which will hold the data\n    let walk_simulator = new nflow.mods.data_storage(\"sample_walk\")\n    walk_simulator.set_session(sample_walk) \n    \n    //3. Create grapher \n    let grapher =  new nflow.mods.ui_object_grapher( {container : \"nflow\" } ) \n    \n    //4. Create our transformer \n    let _get_dev_b = new nflow.mods.transformer(function(payload) { \n\tif (payload.dev == 'B') { \n            return {val : payload.gyr_z , dev : payload.dev }\n\t} else { \n            return nflow.SKIP_PAYLOAD\n\t} \n    })\n\n    // create another transformer that gets the diff \n    let _get_dy = new nflow.mods.transformer(function(payload) { \n\tif (!this.last_val) { \n\t    this.last_val = 0\n\t} \n\tlet result = payload.val - this.last_val\n\tthis.last_val = payload.val\n\treturn {val : result}\n    })\n    \n    let _get_dy2 = new nflow.mods.transformer(function(payload) { \n\tif (!this.last_val) { \n\t    this.last_val = 0\n\t} \n\tlet result = payload.val - this.last_val\n\tthis.last_val = payload.val\n\treturn {val : result}\n    })\n\n    let logger_node = new nflow.mods.logger_node() \n    \n    //5. Connect the nodes together! \n    walk_simulator.connect(_get_dev_b).connect(grapher) \n    //walk_simulator.connect(_get_dev_b).connect(_get_dy).connect(logger_node) \n    //walk_simulator.connect(_get_dev_b).connect(_get_dy)\n\t//.connect(new nflow.mods.transformer(e=>e)).connect(grapher)\n    \n    //6. Start streaming data and stop after 10 second\n    walk_simulator.start_stream() \n    //setTimeout( function() { walk_simulator.stop_stream() } , 1000)\n    setTimeout( function() { walk_simulator.stop_stream() } , 10000) \n    \n} \n\n\n/* \n   Notes -- for real time GENERALIZED (i.e. no param) gait detection... \n   0. pre-allocate buffer to hold data \n   1. wait until gyr_z = 0 \n   2. detect monotonic increase to MAX\n   3. detect monotonic decrease until 0\n   4. detect monotonic decrease until MIN  ~> record t stamp ~> start appending to buffer\n   5. Repeat 1-4 until N=3? t stamps are recorded ~> check for periodicity \n   --  if periodic: \n   ------ walking = TRUE \n   ------ params = get_params_from_buffer(buffer)  [find std_dev minimum]\n   6. If NOT periodic OR any steps fail to happen or fail to happen in order: \n   ------ go back to 0. \n   \n*/ \n\nfunction nflow_init() { \n    gait_dev()\n} \n\nexport function eugene_node() { \n    var ds = new nflow.mods.data_storage(\"eugene_walk_rev\") \n     return ds \n}\n\nexport function get_std(d,n) { \n    let x = util.get_series(d,'time') \n    let gyr = util.get_series(d,'gyr_z') \n    let y =  util.loop_fn(gyr,util.std,n)\n    bokeh.line_plot( { x , y } ) \n} \n\nexport function avg_abs_diff(coll) { \n    let lv = util.last(coll) \n    let tmp = coll.slice(0,-1).map(e=>Math.abs(e-lv))\n    return util.multiply(tmp)\n}\n\nexport function get_density(d,n) { \n    let x = util.get_series(d,'time') \n    let gyr = util.get_series(d,'gyr_z') \n    let y =  util.loop_fn(gyr,util.arr_range,n)\n    bokeh.line_plot( { x , y } ) \n}\n\nexport function get_diff(d,n) { \n    let x = util.get_series(d,'time') \n    let gyr = util.get_series(d,'gyr_z') \n    let y =  util.loop_fn(gyr,(arr) => { return util.first(util.diff(arr.slice(-2)))} ,n)\n    bokeh.line_plot( { x, y } ) \n}\n\nexport function num_decs(d,n) { \n    let x = util.get_series(d,'time') \n    let gyr = util.get_series(d,'gyr_z') \n    let f = function(arr) { \n\tlet d = util.diff(arr) \n\tlet num  = d.filter(x =>  x <=0 ).length\n\treturn num \n    } \n    let y =  util.loop_fn(gyr,f ,n)\n    bokeh.line_plot( { x, y } ) \n}\n\n\n\nexport function gait_dev() { \n    var gd = gait_detector({buffer_size : 300, debug_mode : false, gui_mode : true})\n    var en = eugene_node() \n    \n    let _dev_b = new nflow.mods.transformer(function(payload) { \n\tif (payload.dev == 'B') { \n            return payload\n\t} else { \n            return nflow.SKIP_PAYLOAD\n\t} \n    })\n\n    var ln = new nflow.mods.logger_node() \n    en.connect(_dev_b).connect(gd)\n    \n    window.gd = gd \n    window.en = en \n}\n","//The main program 1\n\n/* - - - - - - - */ \nconsole.log(\":: nflow initializing ::\")\n\n\nimport {nflow}  from  \"./nflow.js\"  //import global nflow object \nimport {flow}   from  \"./scripts/rose_gait_workflows.js\" \nimport * as util from  \"./module_resources/utils.js\"\nimport {beep}   from  \"./module_resources/sounds.js\"\nimport {logger} from  \"./core_modules/logger.js\"\nimport {load_script, load_css} from  \"./module_resources/script_loader.js\"\nimport * as dev from  \"./scripts/dev.js\"\nimport * as bokeh from  \"./module_resources/bokeh.js\"\n\n// set debug \nutil.set_debug(false)\n\n//make logger \nlogger.register(\"nflow\")\n\n/* additions to global context */ \nnflow.flow = flow \nnflow.util = util \nnflow.beep = beep \nnflow.dev  = dev\nnflow.bokeh  = bokeh \n\n/* additions to window */ \nwindow.util = util \nwindow.mods = nflow.mod\nwindow.dev = dev\n\n// HANDLE BOKEH LOADING (load the content from cdn if Bokeh is not defined in the window) ======================================== > \nif (window.Bokeh) { \n    logger.nflow(\"Bokeh was detected already. If you experience any errors, please make sure that the following resources are included in your html for proper functionality:\")\n    console.log(\"<link rel=\\\"stylesheet\\\" href=\\\"https://cdn.pydata.org/bokeh/release/bokeh-0.12.5.min.css\\\" type=\\\"text/css\\\" />\")\n    console.log(\"<script type=\\\"text/javascript\\\" src=\\\"https://cdn.pydata.org/bokeh/release/bokeh-0.12.5.js\\\"></script>\")\n    console.log(\"<script type=\\\"text/javascript\\\" src=\\\"https://cdn.pydata.org/bokeh/release/bokeh-api-0.12.5.min.js\\\"></script>\")\n} else { \n    //will dynamically load the above resources: \n    //define callback \n    function load_api() { \n\tlogger.nflow(\"bokeh-0.12.5.js loaded\")\n\twindow.ls = load_script \n\tload_script(\"https://cdn.pydata.org/bokeh/release/bokeh-api-0.12.5.min.js\" , function () { \n\t    console.log(\"[nflow]:: bokeh-api-0.12.5.min.js loaded\" )\n\t    //we will bubble an event that says nflow is ready ! \n\t    var event = new Event('nflow_ready');\n\t    window.dispatchEvent(event);\n\t} ) \n    } \n    logger.nflow(\"Loading Bokeh functionality:\") \n    load_script(\"https://cdn.pydata.org/bokeh/release/bokeh-0.12.5.js\" , load_api ) \n    load_css(\"https://cdn.pydata.org/bokeh/release/bokeh-0.12.5.min.css\" , function () { console.log(\"[nflow]:: bokeh-0.12.5.min.css loaded\" ) } ) \n} \n// HANDLE BOKEH LOADING (load the content from cdn if Bokeh is not defined in the window) ======================================== > \n\nnflow.load_time  = (new Date()).getTime() \n\n\n\n\n//var d = {\"misc\" : [\"dev_b_gyr_z\"] } \n\n//setTimeout( function() { window.d = flow.playback_gui(d) ; window.d[0].start_stream()  } , 1000)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"]}