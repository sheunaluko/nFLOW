{"version":3,"sources":["core_modules/logger.js","src/module_resources/utils.js","core_modules/web_socket.js","src/core_modules/data_storage.js","core_modules/pipe_manager.js","core_modules/raw_analyzer.js","module_resources/global_params.js","src/core_modules/ui.js","src/core_modules/state_machine.js","core_modules/transformer.js","core_modules/logger_node.js","src/core_modules/simulator.js","src/core_modules/event_detector.js","src/core_modules/base_node.js","src/core_modules/web_socket_tmp.js","src/module_bundle.js","module_resources/sm_utils.js","dev.js","wrtsm.js","module_resources/state_machine_elements.js","src/scripts/rose_gait_workflows.js","module_resources/sounds.js","module_resources/script_loader.js","src/scripts/dev.js","src/index.js"],"names":["makeLogger","tag","stuff","console","log","join","logger","register","global_debug","util","set_debug","b","bug","i","debug","msg","and","ret","length","apply","f","args","avg","arr","sum","rms","Math","sqrt","variance","pow","std","take","coll","num","Array","fill","arr_mult","x","map","y","perf","num_times","results","t0","performance","now","result","t1","range","a","len","first","d","last","zip_map","ks","vs","zip","xs","ys","dict_2_vec","k","push","number_or_self","val","Number","isNaN","d_map","dict_vals_2_num","diff","r","max","curr_max","min","curr_min","cycle_array","v","shift","std_percent_diff","tmp","NaN","array_percent_diff","a1","a2","array_log_diff","cv","cv_matrix","matrix","num_els","e","el_array","log_diff_half_buff","buff","split","ceil","fh","sh","slice","spd_matrix","matrix_map","matrix_mapper","m","dom","s","document","createElement","set_inner_html","thang","HTMLElement","appendChild","innerHTML","flex_row","id_base","container","style","html","make_div_array","n","id","fn","col","el","new_id_base","row","id_from_loc","c","test_div_array","toString","app_clear","app","getElementById","firstChild","removeChild","app_render","colors","get_colors","Date","getTime","web_socket","url","connection","default_handler","data","data_handler","conn","WebSocket","addEventListener","event","send_json","type","bind","JSON","parse","func","obj","send","stringify","data_storage","name","session_id","toISOString","data_history","part_counter","save_interval_id","loaded_session","playback_speed_multiplier","stream_index","to_save","localStorage","setItem","rate","setInterval","flush_data","clearInterval","get_session","buffer_size","streaming","zero_time_axis","diffs","speed","start_stream_loop","stop_stream","delay","mod","setTimeout","t_1","csvContent","keys","Object","sort","dev","row_content","key","encodedUri","encodeURI","link","setAttribute","click","dataStr","encodeURIComponent","downloadAnchorNode","make_json_input","get_session_part_names","filter","includes","parts_names","getItem","merged","concat","file_cb","evt","target","files","fname","replace","reader","FileReader","onloadend","readyState","DONE","readAsText","pipe_manager","from","to","set_data_handler","process_data","p","_to","connect","raw_analyzer","data_buffer","report","get_report","g_hist","g_line","get_field_average","obj_array","utils","params","global_x_len","make_y_series","make_x_series","create_static_multi_line_graph","opts","title","source","Bokeh","ColumnDataSource","Plotting","figure","sizing_mode","glyph","multi_line","field","line_color","tooltips","add_tools","HoverTool","line_policy","show","plot","create_multi_line_graph","x_len","series_array","series_len","bokeh_multi_stream","ds","xss","yss","setv","silent","trigger","Graph","series_vector","parent","multi_opts","color","alpha","background_fill_color","background_fill_alpha","border_fill_color","border_fill_alpha","multi_line_graph","ui","graphs","last_series_buffer","graph","graph_array","n_cols","n_rows","app_el","index","render_into_element","get_data_source","series_buffer","series","state_machine","gui_mode","debug_mode","init","sensor_buffer_size","buffer","default_data_obj","sensors","transitioners","transitioner_groups","STATE","sensors_gui_buffer","ui_mapping","state","compare","l1","level","l2","sensor_order","l","set_sensor_order","add_graph","get_sensor_last_N","transitioner","detector","applicator","group","group_status","sensor_id","run_sensor","update_buffer_with_data_object","run_sensors","transitioner_id","run_transitioner","handle_sensor_buffer","time","random_data_obj","random","count","transformer","logger_node","simulator","mode","stream_interval","send_val","sin","multiplier","offset","burst","getSeconds","power","map_f_on_dict","reduce_val","isArray","reduce","reduce_dict","test_dict","acc","gyr","foo","bar","happy","linearize_dict","flattened","linearize","event_detector","baseline_counter","baseline_number","current_event","events","detection_params","upper","lower","init_detection_params","detection_thresh","last_linearized","history_buffer_size","init_history_buffer","t","in_range","detected","lp","bl","log_diff","detect","check_baseline","add_to_history","init_event","flush_event","history_buffer","node_io_router","inputs","outputs","base_node","window","wrtsm","node_connections","new_input","o","new_output","ensure_input","ensure_output","dict_from","dict_to","input_port","output_port","assert","connection_name","get_connection_name","payload","packet","process_packet","sink","node","node_payload_router","handler_dict","io_router","port_name","handler_obj","handler_id","handler","ensure_input_output","has_handler","dlog","_payload","send_payload_to_output","node_name","node_counter","dev_logger","dev_mode","dclog","creation_time","num_to_stream","stream_enabler","stream_disabler","is_source","stream_enabled","is_sink","is_through","payload_router","set_base_node","main_opts","add_input_handler","run_handlers","disconnect","enable_stream","stream_num","trigger_input_packet","trigger_output_packet","_this","close","trigger_input","mods","web_socket_tmp","smu","transformers","sm","vars","sme","dev_a","dev_b","field_diff","is_dev_b","is_dev_a","buf","test_turn_on","is_on","test_turn_off","flow","test_storage_persist","ws","pm","start_saving","stop_saving","test_storage_replay","load_session","ra","start_stream","test_state_machine","rg","initialize","add_sensor","add_transitioner","test_state_machine_gui","init_gui","playback_gui","graph_dances","g1","line_dance","counter","acc_x","acc_y","sine_rate","sine_rate_2","sine_rate_3","sine_dance_0","sine_dance_1","gyr_z","stop","graph_sm_test","interval","start","sizes","size","test_cycle","run_debug_cycle","bar_graph","EW","sounds","ctx","AudioContext","osc","freq","gainVal","gain","createOscillator","frequency","value","createGain","destination","beep_time","beep_dic","beep","load_script","cb","script","onreadystatechange","onload","src","getElementsByTagName","load_css","rel","href","tf","wrtsm_init","bin","add_time","sim","rose_gait_test_connection","ln","rose_gait_init","test_matrix","dict_to_update","dict","get_array_series","get_dict_series","list","ind","indexOf","splice","array_to_update","ser","make_graph_for_obj","graph_ui","convert","init_time","graph_object","updates","get_object_grapher","grapher","get_sim_node","wrap_sim","dev_0","w","dev_1","ED","dev_2","baseline_buffer_size","test_base","n1","n2","load_api","ls","Event","dispatchEvent","load_time"],"mappings":"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","file":"src.a2b27638.map","sourceRoot":"..","sourcesContent":["\nexport function makeLogger(tag) { \n    return function(...stuff) { \n\tconsole.log(\"[\" + tag + \"]:: \" + stuff.join())\n    }\n} \n\n\nvar logger = {} \n\nlogger.register = function(tag) { \n    logger[tag] = makeLogger(tag)\n} \n\n\nexport {logger}  \n","//Tue Oct  2 18:06:09 PDT 2018\n//General JS utils file \n//would like to try creating soft?hard? links so that the utils files can be shared \n\nimport {logger} from \"../core_modules/logger.js\"\n\n\nvar global_debug = true \n\nvar util = {} \n\n\nutil.set_debug = function(b) { \n    global_debug = b \n} \n\nutil.bug = function(tag,...msg) { \n    if (global_debug) { \n\tconsole.log(\"<- \" + tag + \" ->\" )\n\tfor (var i = 0 ; i < msg.length ; i++) { \n\t    console.log(msg[i])\n\t}\n\tconsole.log(\"<- \" + tag + \" ->\" )\n    }\n}\n\nlogger.register(\"bug\") \n\nutil.debug = function(msg) { \n    if (global_debug) {\n\tlogger.bug(msg)\n    }\n}\n\n\nutil.and = function(...args) { \n    var ret = true \n    for (var i=0;i<args.length;i++) { \n\tret =  ret && args[i]\n    }\n    return ret ? true : false \n} \n\nutil.apply = function(f,args) { \n    return f.apply(null,args)\n}\n\nutil.avg = function(arr) { \n    var sum = 0;\n    for( var i = 0; i < arr.length; i++ ){\n\tsum += arr[i]\n    }\n    return sum/arr.length \n}\n\nutil.rms = function(arr) { \n    var sum = 0;\n    for( var i = 0; i < arr.length; i++ ){\n    \tsum += arr[i]*arr[i]\n    }\n    return Math.sqrt(sum/arr.length)\n}\n\n\n\nutil.variance = function(arr) { \n    var avg = util.avg(arr)\n    var sum = 0 \n    for( var i = 0; i < arr.length; i++ ){\n\tsum += Math.pow(arr[i] - avg, 2)\n    }\n    return sum/arr.length \n} \n\n\nutil.std = function(arr) { \n    return Math.sqrt(util.variance(arr))\n} \n\nutil.take = function(coll,num) { \n    var ret = Array(num).fill(0) \n    for (var i =0;i<num; i++) { \n\tret[i] = coll[i]\n    }\n    return ret \n} \n\nutil.arr_mult = function(arr,x) { \n    return arr.map( y => y /x ) \n}\n\nutil.perf = function(f) { \n    var num_times = 20000\n    var results = Array(num_times).fill(0) \n    for (i = 0 ; i < num_times ; i++ ) { \n\tvar t0 = performance.now();\n\tvar result = f() \n\tvar t1 = performance.now();\n\tresults[i] = t1 - t0 \n    } \n    return avg(results) \n} \n\nutil.range = function(a,b) { \n    var len = b - a \n    var ret = Array(len).fill(0)  ; \n    for (var i = 0 ; i< len ; i++) {  \n\tret[i] = a + i \n    }\n    return ret \n    \n} \n\nutil.first = function(d) { \n    return d[0]\n} \n\n\nutil.last = function(d) { \n    return d[d.length - 1 ] \n} \n\nutil.zip_map = function(ks,vs) { \n    var result = {} \n    for (var i = 0 ; i < ks.length; i ++ ) { \n\tresult[ks[i]] = vs[i]\n    }\n    return result\n}\n\nutil.zip = function(xs,ys) { \n        return xs.map(function(x,i) { \n\t    return [x, ys[i]]\n\t}) \n}\n\nutil.dict_2_vec = function(d) { \n    var ret = [] ; \n    for (var k in d) { \n\tret.push([ k, d[k] ]) \n    } \n    return ret \n}\n\nutil.number_or_self = function(d) { \n    var val = Number(d) \n    if (isNaN(val)) {\n\treturn d \n    } else { \n\treturn val \n    } \n}\n\n\n\nutil.d_map = function(d,f) { \n    for (var k in d) {\n\td[k] = f(d[k])\n    }\n    return d \n}\n\nutil.dict_vals_2_num = function(d) { \n    return util.d_map(d,util.number_or_self) \n}\n    \n\nutil.diff = function(d) { \n    var r =   Array(d.length - 1).fill(0) \n    for (var i = 1 ; i < d.length ; i ++ ) { \n\tr[i-1] = d[i] - d[i-1]\n    }\n    return r \n}\n\n\nutil.max = function(d) { \n    var curr_max = d[0] \n    \n    for (var i=1;i<d.length;i++) { \n\tif (d[i] > curr_max) { curr_max = d[i] }\n    } \n    \n    return curr_max \n} \n\n\nutil.min = function(d) { \n    var curr_min = d[0] \n    \n    for (var i=1;i<d.length;i++) { \n\tif (d[i] < curr_min) { curr_min = d[i] }\n    } \n    \n    return curr_min\n    \n} \n\n\nutil.cycle_array = function(a,v) { \n    a.push(v)\n    a.shift() \n    return a \n} \n\nutil.std_percent_diff = function(arr) { \n    // Meant to be a magnitude normalized average derivative of an array \n    // calculates the vector of percentage differences (consecutive indeces) \n    // then gets the std of those \n    var tmp = Array(arr.length - 1 ).fill(NaN) \n    for (var i =0 ; i < tmp.length ; i ++ ) { \n\ttmp[i] =  (arr[i+1]-arr[i])/arr[i]\n    }\n    \n    return util.std(tmp)\n}\n\n\nutil.array_percent_diff = function(a1, a2 ) { \n    var ret = Array(a2.length).fill(0) \n    for (var i=0; i<ret.length; i++) { \n\tret[i] = (a2[i]-a1[i])/a1[i]\n    }\n    return ret \n} \n\nutil.array_log_diff = function(a1, a2 ) { \n    var ret = Array(a2.length).fill(0) \n    for (var i=0; i<ret.length; i++) { \n\tret[i] = Math.log(a2[i]) - Math.log(a1[i])\n    }\n    return ret \n} \n\nfunction cv(arr) { \n    return util.std(arr)/util.avg(arr)\n}\n\nfunction cv_matrix(matrix) { \n\n    let num_els = matrix[0].length \n    var result = Array(num_els).fill(null)\n    \n    for (var e =0; e < num_els ; e ++ ) { \n\tlet el_array = matrix.map( arr => arr[e]  ) \n\tresult[e] = cv(el_array)\n    }\n    \n    return result\n} \n\nutil.log_diff_half_buff = function(buff) { \n    //splits buffer in half, averages two halves, then calcs log diff of both halves \n    let split = Math.ceil(buff.length/2)  \n    let fh = util.take(buff,split) \n    let sh = buff.slice(-(buff.length - split))\n    return Math.log(util.avg(sh)) - Math.log(util.avg(fh))\n}\n\n\nutil.spd_matrix = function(matrix) { \n    // foo\n\n    let num_els = matrix[0].length \n    var result = Array(num_els).fill(null)\n    \n    for (var e =0; e < num_els ; e ++ ) { \n\tlet el_array = matrix.map( arr => arr[e]  ) \n\tresult[e] = util.std_percent_diff(el_array)\n    }\n    \n    return result\n} \n\n\nutil.matrix_map = function(matrix,f) { \n    let num_els = matrix[0].length \n    var result = Array(num_els).fill(null)\n    for (var e =0; e < num_els ; e ++ ) { \n\tlet el_array = matrix.map( arr => arr[e]  ) \n\tresult[e] = f(el_array)\n    }\n    return result\n} \n\nutil.matrix_mapper = function(f) { \n    return function(m) {return util.matrix_map(m,f)}\n} \n\nutil.cv = cv\nutil.cv_matrix = cv_matrix \n\n\n\n\n\n\n\n// define ui utilities now ------------> \n\n\n\n\nutil.dom = function(s) { \n    return document.createElement(s) \n} \n\nutil.set_inner_html = function(d,thang) { \n    if (thang instanceof HTMLElement) { \n\td.appendChild(thang) \n    } else { \n\td.innerHTML = thang \n    } \n    \n} \n\nutil.flex_row = function(num,id_base,f) { \n    var container, i \n\n    container = util.dom(\"div\")  \n    //container.className = \"flex-row\"  // see styles.css   \n    \n    container.style = \"display : flex ; flex-wrap : nowrap ; flex-direction : row ; flex-grow : 1 \"\n        \n    for (i =0 ; i < num ; i ++ ) { \n\tvar d = util.dom(\"div\") \n\td.style = \"flex-grow : 1\"\n\tvar html = f(i,d) \n\tif (html) { \n\t    util.set_inner_html(d, html) \n\t} \n\tcontainer.appendChild(d) \n    } \n\t\n    return container  \n     \n}\n\n\n/* \n * Create a flexbox of divs [m,n] in shape \n * @param {Function} f - accepts row, column, and HTMLelement. Can either mutate the el or return an new el (which will be appended to div at spot r,c) or return String (which will be set to innerHTML) \n */ \nutil.make_div_array = function(m,n,id_base,f) { \n    var container, i \n    \n    container = util.dom(\"div\")  \n    //container.className = \"flex-column\"  // see styles.css  \n    container.id = id_base \n    \n    container.style = \"width: 100% ; height : 100% ; display : flex ; flex-wrap : nowrap ; flex-direction : column \"\n    \n    // now we will add in the child elements \n    for (i =0 ; i < m ; i ++ ) { \n\t\n\t//f is a function which takes a row and column and element \n\t//build a function that takes just a col with row hard coded \n\t//and returns f(r,col)\n\tvar fn = function(col,el) {\n\t    return f(i,col,el) \n\t}\n\t\n\tvar new_id_base = id_base + \"_\" +  i + \",\" \n\tvar row = util.flex_row(n,new_id_base , fn )\n\tcontainer.appendChild(row) \n    }\n    \n    return container\n    \n\n} \n\nutil.id_from_loc = function(m,n,c) { \n    return c*m + n   // intersing that this function needs arg c, which is (static) number of cols \n}\n\nutil.test_div_array = function(m,n) { \n    var f = function(r,c,el) { \n\treturn (util.id_from_loc(r,c,n)).toString()\n    } \n\n    return util.make_div_array(m,n,\"foo\", f) \n    \n} \n\t\n\nutil.app_clear = function() { \n    var app = document.getElementById(\"app\");\n    while (app.firstChild) {\n\tapp.removeChild(app.firstChild);\n    }   \n}\n\nutil.app_render = function(el) { \n    util.app_clear() \n    var app = document.getElementById(\"app\")  \n    app.appendChild(el) \n}\n\n\nvar colors = [\"black\" , \"blue\" , \"red\" , \"green\" , \"yellow\" , \"orange\"]\n\nutil.get_colors = function(num) { \n    return util.take(colors, num) \n}\n\n\nutil.now = function() { \n    return (new Date()).getTime()    \n}\n///   extensions \n\n\n// Array.prototype.first = function(arr) { \n//     return arr[0] \n// }\n\n\nexport {util} \n","// Sat Sep 29 18:31:15 PDT 2018\n\nimport {makeLogger} from \"./logger.js\"\nimport {util} from \"../module_resources/utils.js\"\n\n/**\n * Manages the websocket connection to an incoming data stream.\n *\n * @param {String} url - The websocket url to connect to, e.g. ws://localhost:1234\n */\nexport default class web_socket {\n    \n    constructor(url) { \n\tthis.url = url ;  \n\tthis.connection = null ;  \n\tthis.log = makeLogger(\"WS\")\n\tthis.default_handler = function(data) { \n\t    this.log(\"No data handler has been defined!\") \n\t} \n\tthis.data_handler = this.default_handler \n    } \n    \n    /**\n     * Connect to remote websocket server. Upon success, registers the websocket connection\n     * as \"client\" with the server, enables streaming, and this.logs to console. \n     */ \n    connect() { \n\tvar conn  = new WebSocket(this.url) ; \n\t// Connection opened\n\tconn.addEventListener('open', (function (event) {\n\t    this.log(\"Connection to \" + this.url + \" successful. Registering client with server.\")\n\t    this.send_json({type: \"register\" , data : \"client\" })\n\t    this.send_json({type: \"control\"  , data : \"start\"  }) \n\t}).bind(this)) //bind is necessary for web_socket class vs WebSocket instance! \n\n\t\n\t// Listen for messages\n\tconn.addEventListener('message', (function (event) {\n\t    //this.log(\"Received msg: \" + event.data) \n\t    this.data_handler(util.dict_vals_2_num(JSON.parse(event.data))) //parse json and convert nums\n\t}).bind(this)) //bind is necessary for web_socket class vs WebSocket instance! \n\t\n\tthis.connection = conn ; \n    } \n    \n    /** \n     * Start accepting incoming raw data objects.\n     */ \n    start_stream() { \n\tthis.send_json({type : \"control\" , data : \"start\" } ) \n    }\n\n    /** \n     * Stop accepting incoming raw data objects.\n     */ \n    stop_stream() { \n\tthis.send_json({type : \"control\" , data : \"stop\" } ) \n    }\n\n    /** \n     * Sets the data_handler attribute, which determines what the socket does to incomin data.\n     * @param {Function} func - Function which accepts ONE raw data object {..} and processes it.\n     */ \n    set_data_handler(func) { \n\tthis.data_handler = func ; \n    }\n\n    /** \n     * Sends JSON data through socket. \n     * @param {Object} obj - Data object to send \n     */ \n    send_json(obj) { \n\tthis.connection.send(JSON.stringify(obj))\n    }\n\n    \n    \n}\n\n","//Tue Oct  2 10:12:11 PDT 2018\n\nimport {makeLogger} from \"./logger.js\"\nimport {util} from \"../module_resources/utils.js\"\n\n/**\n * \n * \n */\n\nexport default class data_storage {\n\n    /**\n     * Manages data persistence and replay/simulation. Uses browser based local storage. \n     * @param {String} name - Session identifier, use null for default time string\n     */ \n    constructor(name) { \n\tthis.session_id = name || (new Date()).toISOString()\n\tthis.data_history = [] \n\tthis.part_counter = 1 \n\tthis.save_interval_id = null \n\tthis.loaded_session = null \n\tthis.playback_speed_multiplier = 1\n\t\n\tthis.log = makeLogger(\"DS\")\n\tthis.default_handler = function(data) { \n\t    this.log(\"No data handler has been defined!\") \n\t} \n\tthis.data_handler = this.default_handler \n\tthis.stream_index = 0 \n    } \n    \n    /**\n     *  Persists a chunk of data to localStorage. Uses session name + part_number as identifier\n     */ \n    flush_data() { \n\tvar to_save = JSON.stringify(this.data_history)\n\tname    = this.session_id + \"_part\" + this.part_counter.toString() \n\tthis.data_history = [] \n\tlocalStorage.setItem(name, to_save) \n\tthis.part_counter += 1 \n\tthis.log(\"Saved data chunk: \" + name ) \n    } \n    \n    /**\n     * Start saving data to localStorage. Data is saved in chunks called 'parts'. \n     * @param {Number} rate - The rate to flush data to localStorage in SECONDS \n     */ \n    start_saving(rate) { \n\tthis.save_interval_id = setInterval(  (function(){this.flush_data()}).bind(this) , rate*1000)\n\tthis.log(\"Saving started for session: \" + this.session_id) \n    } \n\n    /**\n     * Stop saving data to localStorage\n     */ \n    stop_saving() { \n\tclearInterval(this.save_interval_id) \n\tthis.log(\"Saving stopped for session: \" + this.session_id) \n    } \n    \n    /** \n     * Main data handler. Will append the incoming data to the data_history array \n     * @param {Object} obj - The data obj to add \n     */\n    process_data(obj) { \n\tthis.data_history.push(obj) \n    } \n\n    /** \n     * Loads a data storage session from localStorage. Returns Array. \n     */\n    load_session() { \n\tthis.log(\"Loading session...\")\n\tthis.loaded_session = get_session(this.session_id)  // see definition below \n\tthis.stream_index = 0 \n\tthis.buffer_size = this.loaded_session.length\n\tthis.streaming = false \n\tthis.zero_time_axis() \n\tthis.diffs = util.diff( this.loaded_session.map( d => d[\"time\"] )  )\n\tthis.log(\"Session loaded: \" + this.session_id) \n    } \n\n\n    /** \n     * Set the data_handler for data replay/simulation \n     * @param {Function} f - The data handler function  \n     */\n    set_data_handler(f) { \n\tthis.data_handler = f \n    } \n    \n    /** \n     * Start streaming the session that was previously loaded from localStorage \n     */\n    start_stream(speed) { \n\tthis.stream_index =  0 \n\tthis.streaming = true \n\tthis.playback_speed_multiplier = speed || 1 \n\tthis.start_stream_loop() \n\n    } \n    \n    /** \n     * Stream single packet\n     */\n    stream_single_packet() { \n\tif (this.stream_index < this.buffer_size  ) { \t\n\t    //get the data\n\t    var val = this.loaded_session[this.stream_index]\n\t    //send the data\n\t    this.data_handler(val) \n\t    //increment the stream index \n\t    this.stream_index += 1 \n\t    return val \n\t} else { \n\t    this.stop_stream() \n\t} \n\t\n\n    } \n    \n    \n    /** \n     * Helper function for start_stream() \n     */\n    start_stream_loop() { \n    \t//when starting, this.index is 0, this.diffs is defined \n\tif (this.streaming) { \n\t    //get the data\n\t    var val = this.loaded_session[this.stream_index]\n\t    //send the data\n\t    this.data_handler(val) \n\t    \n\t    if (this.stream_index == this.buffer_size - 1 ) { \n\t\t//on the last data point  \n\t\t//significant b/c the diff array is finished \n\t\t//so we stop streaming \n\t\tthis.stop_stream() \n\t\t\n\t    } else { \n\t\t//not on the last data point \n\t\t//now acces the next diff \n\t\tvar delay = this.diffs[this.stream_index]\n\t\t//increment the stream_index \n\t\tthis.stream_index += 1 \n\t\t//schedule the loop again \n\t\tvar mod =  this.playback_speed_multiplier \n\t\tsetTimeout( (function() {this.start_stream_loop()}).bind(this) , delay*mod)\n\t    }\n\t    \n\t}\n\t\n    }\n\t\t\n    \n    /** \n     * Zero the time axis of the data session \n     */\n    zero_time_axis() { \n\tthis.log(\"Zeroing time axis\") \n\tif (!this.loaded_session.length) { \n\t    throw(\"Session must be loaded!\")\n\t} else { \n\t    //get first time point \n\t    var t_1  = util.first(this.loaded_session)[\"time\"] \n\t    //now we subtract t_1 from all time points \n\t    this.loaded_session.map( function(d) { \n\t\td[\"time\"] = d[\"time\"] - t_1 \n\t\treturn d \n\t    })\n\t    this.log(\"Done\")\n\t}\n\t\n    } \n\n\n\n    /** \n     * Stop streaming the session that was previously loaded from localStorage \n     */\n    stop_stream() { \n\tthis.streaming = false \n\tthis.stream_index =  0 \n\tthis.log(\"Stream finished.\") \n    } \n\n    \n    \n    /** \n     * Makes csv string from this.loaded_session \n     */\n    to_csv(name) { \n\tthis.log(\"Creating csv file for: \" + this.session_id) \n\tlet csvContent = \"data:text/csv;charset=utf-8,\";\n\t\n\t//figure out the keys in the data objects \n\tlet keys = Object.keys(this.loaded_session[0]).sort()\n\t\n\t//write csv header \n\tcsvContent += ( keys.join(\",\") + \"\\n\" ) \n\t\n\t//then loop through the structure \n\tfor (var i =0 ; i < this.loaded_session.length ; i ++) { \n\t    var data = this.loaded_session[i]\n\t    if (data.dev == \"B\" ) { \n\t\tvar row_content = []\n\t\t//loop through keys to build the row \n\t\tfor (var k = 0 ; k < keys.length ; k ++ ) { \n\t\t    var key = keys[k] \n\t\t    var val = data[key]\n\t\t    row_content.push(data[key]) \n\t\t}\n\t\tcsvContent += (row_content.join(\",\") + \"\\n\" ) \n\t    }\n\t} \n\t\n\tvar encodedUri = encodeURI(csvContent);\n\tvar link = document.createElement(\"a\");\n\tlink.setAttribute(\"href\", encodedUri);\n\tlink.setAttribute(\"download\", (name || this.session_id)   + \".csv\");\n\tlink.click();\n\t\n\t\n    } \n\n    /** \n     * Makes and downloads json string from this.loaded_session \n     */\n    to_json(name) { \n\tthis.log(\"Creating json file for: \" + this.session_id) \n\tvar dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(this.loaded_session)) \n\tvar downloadAnchorNode = document.createElement('a');\n\tdownloadAnchorNode.setAttribute(\"href\",     dataStr);\n\tdownloadAnchorNode.setAttribute(\"download\", (name || this.session_id) + \".json\");\n\tdownloadAnchorNode.click();\n    }\n    \n    \n    /** \n     * Loads json data into local storage \n     */\n    load_json() { \n\tvar i = make_json_input() \n\ti.click() \n\treturn i\n    }\n    \n    \n}\n\n\n// define some helpers \nfunction get_session_part_names(id) { \n    return Object.keys(localStorage).filter( s => s.includes(id) ).sort() \n} \n    \nfunction get_session(id) { \n    var parts_names = get_session_part_names(id) \n    // part names are sorted already \n    var tmp = parts_names.map( function(name) { \n\treturn JSON.parse(localStorage.getItem(name))\n    }) \n    \n    var merged = [].concat.apply([], tmp);\n    return merged.map( util.dict_vals_2_num ) \n}\n\n\nfunction file_cb(evt) { \n    var f = evt.target.files[0]\n    var fname = f.name.replace(\".json\",\"\")\n    var reader = new FileReader() \n    reader.onloadend = function(evt) { \n\tif (evt.target.readyState == FileReader.DONE) {\n\t    localStorage.setItem(fname, evt.target.result) \n\t    console.log(\"[DS]:: Saved item to local storage: \" + fname )\n\t} else { \n\t    console.log(\"[DS]:: error reading.. \") \n\t    console.log(evt) \n\t} \n    }\n    reader.readAsText(f) \n}\n\n\nfunction make_json_input() {\n    var i =   document.createElement(\"input\")\n    i.type = \"file\" \n    i.addEventListener(\"change\", file_cb ) \n    return i \n} \n","//Tue Oct  2 10:12:11 PDT 2018\n\nimport {makeLogger} from \"./logger.js\"\n\n/**\n * Manages the flow of streaming data between various modules of RoseGait\n * e.g. pipe_manager.connect(web_socket, data_storage) \n */\nexport default class pipe_manager {\n    \n    constructor() { \n\tthis.log = makeLogger(\"PM\")\n    } \n    \n    \n    /**\n     * Connects a streaming output data source to a streaming input source. \n     * @param {Object} from - data source (emits data). Must implement method `set_data_handler` \n     * and have member default_handler\n     * @param {Object} to -   data sink   (consumes data). Must implement method `process_data` \n     */ \n    connect(from, to) { \n\tfrom.set_data_handler(  (function(d) {to.process_data(d)}).bind(to) ) \n\tlet p = new pipe_manager() \n\tlet f = {'connect' : function(_to) { return p.connect(to,_to) }}\n\treturn f // for recursive connects... p.connect(1,2).connect(3).connect(4)...\n    } \n\n    /**\n     * Disconnects a streaming output data source from a streaming input source. \n     * @param {Object} from - data source (emits data). Must implement method `set_data_handler` \n     * and have member default_handler\n     * @param {Object} to -   data sink   (consumes data). Must implement method `process_data` \n     */ \n    disconnect(from, to) { \n\tfrom.set_data_handler(from.default_handler)\n    } \n\n    \n}\n\n\n\n\n","//Tue Oct  2 10:12:11 PDT 2018\n\nimport {makeLogger} from \"./logger.js\"\nimport util from \"../module_resources/utils.js\"\n\n/**\n * \n * \n */\n\nexport default class raw_analyzer {\n\n    /**\n     * Provides insights and attributes about raw data stream. \n     * e.g. checks for dropped samples \n     */ \n    constructor() { \n\tthis.data_history  =  [] \n\tthis.log = makeLogger(\"RA\")\n    } \n    \n    /**\n     * Processes a data packet \n     * @param {Object} obj - Data object to process \n     */ \n    process_data(obj) { \n\tthis.data_history.push(obj) \n\tthis.log(\"Received data!\") \n    } \n    \n    /**\n     * Produce report (logged to console for now) \n     */ \n    produce_report() { \n\tvar data_buffer = this.data_history \n\tvar report = get_report(data_buffer) \n\tthis.log(\"Printing report: \" ) \n\tthis.log(JSON.stringify(report) ) \n\treturn report \n    } \n    \n    /**\n     * (UNSTABLE ) Show ditribution for field  \n     */ \n    dist_field(f) { \n\t//clear_plot_div() \n\t\n\tvar data = this.data_history.map( e => e[f] ) \n\t\n\tg_hist(data,\"Distribution for: \" + f)     \n\t\n    }\n\n    /**\n     * (UNSTABLE) Show time series for field \n     */ \n    line_field(f) { \n\tvar data = this.data_history.map( e => e[f] ) \n\tg_line(data,\"Time series for: \" + f)     \n\t\n    }\n\n    \n} \n\n\n\nfunction get_field_average(obj_array,f) { \n    return  utils.avg(obj_array.map( obj => obj[f] )) \n} \n\n\n\n\nfunction get_report(data_buffer) { \n    return { \n\t    'len'       : data_buffer.length  , \n\t    'acc_x_avg' : get_field_average(data_buffer, \"acc_x\"), \n\t    'acc_y_avg' : get_field_average(data_buffer, \"acc_y\"), \n\t    'acc_z_avg' : get_field_average(data_buffer, \"acc_z\"), \n\t    'gyr_x_avg' : get_field_average(data_buffer, \"gyr_x\"), \n\t    'gyr_y_avg' : get_field_average(data_buffer, \"gyr_y\"),\n\t    'gyr_z_avg' : get_field_average(data_buffer, \"gyr_z\") \t    \n    }\n} \n\n","\n\n\nvar params = \n    { \n\tglobal_x_len : 200 \n\t\n\t\n\t\n    }\n\n\nexport { params } \n    \n","import {params} from \"../module_resources/global_params.js\" \nimport {util}     from \"../module_resources/utils.js\" \n\n\n\nfunction make_y_series(len) { \n    return Array(len).fill(0) \n}\n\nfunction make_x_series(len) { \n    return util.range(-len, 0).map( x => x/100 ) // the /100 is hax for now for streaming\n}\n\nfunction create_static_multi_line_graph(container,opts) { \n\tvar { xs, ys , title  } = opts \n\t\n\t//will use indeces for x arrays if not provided \n\tif (! xs ) { \n\t\txs =  [] \n\t\tfor (var i =0; i< ys.length ; i ++)  { \n\t\t\txs.push(util.range(0, ys[0].length ) ) \n\t\t}\n\t}\n\n\tvar source = new Bokeh.ColumnDataSource( {\n\tdata : {xs : xs, ys : ys }\n    })\n    \n    // make the plot and add some tools\n    //var tools = \"pan,crosshair,wheel_zoom,box_zoom,reset,save\";\n\n    // WOW ! -- how lucky to find sizing_mode : stretch_both lmao \n    // https://github.com/bokeh/bokeh/issues/4958\n    \n    var p = Bokeh.Plotting.figure({ title: title,sizing_mode : 'stretch_both' })\n    \n    //add the multiline \n    var glyph = p.multi_line({ field: \"xs\" }, { field: \"ys\" }, {\n\t\tsource: source,\n\t\tline_color: util.get_colors(xs.length)\n    }) \n    \n    var tooltips = [\n\t[\"x\"    , \"$x\" ]  , \n\t[\"y\"    , \"$y\" ] \n    ]\n\n    p.add_tools(new Bokeh.HoverTool({tooltips : tooltips , line_policy : \"next\"} ) ) \n\t\n\tvar el = container\n\tif (typeof container == 'string') { \n\t\tel = document.getElementById(container)\n\t}\n\twhile  (el.firstChild) { el.removeChild(el.firstChild)}\n\tBokeh.Plotting.show(p, el)\n    return { plot : p , glyph : glyph , source : source } \n} \n\nfunction create_multi_line_graph(opts) { \n    var { x_len, series_array, title  } = opts \n    var series_len = series_array.length \n    \n    //make xs and ys vector \n    var xs = [] \n    var ys = [] \n    for (var i =0 ;i < series_len ; i++) { \n\txs.push(make_x_series(x_len))\n\tys.push(make_y_series(x_len))\n    } \n    \n    //make data source \n    var source = new Bokeh.ColumnDataSource( {\n\tdata : {xs : xs, ys : ys }\n    })\n    \n    // make the plot and add some tools\n    //var tools = \"pan,crosshair,wheel_zoom,box_zoom,reset,save\";\n\n    // WOW ! -- how lucky to find sizing_mode : stretch_both lmao \n    // https://github.com/bokeh/bokeh/issues/4958\n    \n    var p = Bokeh.Plotting.figure({ title: title,sizing_mode : 'stretch_both' })\n    \n     \n    //add the multiline \n    var glyph = p.multi_line({ field: \"xs\" }, { field: \"ys\" }, {\n\tsource: source,\n\tline_color: util.get_colors(series_len)\n    }) \n    \n    var tooltips = [\n\t[\"x\"    , \"$x\" ]  , \n\t[\"y\"    , \"$y\" ] \n    ]\n\n    p.add_tools(new Bokeh.HoverTool({tooltips : tooltips , line_policy : \"next\"} ) ) \n    \n    //NEXT STEP -- > NEXT STEP -- > NEXT STEP -- > NEXT STEP -- > NEXT STEP -- > \n    //Need to call Bokeh.Plotting.show(p , HTMLelement) \n    return { plot : p , glyph : glyph , source : source } \n\t     \n    \n} \n\n\n\n// Figured out this function by looking at bokeh source code \nvar bokeh_multi_stream = function(ds, x, ys) { \n    var data = ds.data \n    var xss = data.xs\n    var yss = data.ys \n    // make modifications \n\n    for(var i=0;i<yss.length;i++) {\n\t\n\t//NOTE* if one of the y values is false (or undefined) , then the assumption is that \n\t//the series at that index should NOT BE updated \n\t//Sensors in rosegait return false when they wish NOT to be updated \n\t\n\tif (ys[i]) {\n\t    // -  \n\t    xss[i].push(x)\n\t    xss[i].shift()\n\n\t    // -  \n\t    yss[i].push(ys[i])\n\t    yss[i].shift()\n\t    \n\t} \n    }\n    // re assign the data \n    data.xs = xss \n    data.ys = yss \n    ds.setv('data', data, {\n        silent: true\n    });\n    \n    return ds.trigger('stream');\n}\n\n// < -- START CLASS DEFINITIONS -- START CLASS DEFINITIONS -- START CLASS DEFINITIONS -- > \n\n/* \n * A bokeh real time, multi line graph \n *  \n */\nclass Graph { \n    constructor(opts) { \n\tvar {series_vector, title } = opts \n\tthis.parent = null \n\tthis.opts = opts\n\tthis.series_vector = series_vector \n\tconsole.log(\"Graph with Len : \" + opts.x_len)\n\t\n\tvar multi_opts = { x_len : opts.x_len || params.global_x_len , \n\t\t\t   title : title ,\n\t\t\t   series_array : series_vector } \n\t\n\tvar  {plot , glyph , source} = create_multi_line_graph(multi_opts) \n\t\n\tvar color = \"#e5efff\" // \"white\" //\"#003559\" //\"#B9D6F2\"\n\tvar alpha = 0.2 \n\tplot.background_fill_color = color\n\tplot.background_fill_alpha = alpha\n\n\tplot.border_fill_color = color\n\tplot.border_fill_alpha = alpha\n\n\tthis.multi_line_graph = plot \n\tthis.source = source \n\tthis.glyph  = glyph \n\t\n    } \n    \n    get_data_source() { \n\treturn this.source \n    } \n    \n    render_into_element(el) { \n\t//el.innerHTML = 'waiting'\n\t//this.parent = el \n\tBokeh.Plotting.show(this.multi_line_graph, el) \n    } \n    \n}\n\n\nexport default class ui { \n    \n    /* \n     * \n     * @param {HTMLElement} parent - The DOM to render the UI into \n     */ \n    constructor(parent) { \n\tthis.graphs = {} \n\tthis.parent = parent \n\tthis.last_series_buffer = {} // holds the previous update sent to graph \n    } \n\n    /* \n     * Add graph to the ui \n     * @param {Object} opts - Dict containing fields: id - graph id , series_vector - vector of Ids for series which will be graphed on this graph \n     */\n    add_graph(opts) { \n\tvar {id, series_vector, x_len} = opts\n\t//console.log(series_vector)\n\tvar graph = new Graph( {series_vector : series_vector, \n\t\t\t\tx_len : x_len , \n\t\t\t\ttitle  : id + \": \" + series_vector.join(\", \")} )   \n\t\t\t       \n\tthis.graphs[id] = graph \n    } \n    \n    /* \n     *\n     * After all graphs have been added, init is called to actually display the graphs \n     *\n     */\n    init(container) { \n\t// logic for displaying all of the added graphs \n\t// should make a panel view of sorts and initialize with empty values \n\tvar graph_array = util.dict_2_vec(this.graphs) \t\n\tthis.graph_array = graph_array  \n\t\n\t// for now will put two graphs side by side \n\tvar n_cols = 2 \n\tvar n_rows = Math.ceil(Object.keys(this.graphs).length/2) \n\t\n\t// some hax  \n\tif (graph_array.length == 1 ) { \n\t    n_cols = n_rows = 1 \n\t} \n\t\n\tutil.bug(\"n_row\" , n_rows) \n\t\n\t// make a grid of divs \n\tvar app_el = util.make_div_array(n_rows,n_cols,\"rgui\",function(r,c,el) { \n\t    //get the graph index\n\t    var index = util.id_from_loc(r,c,n_cols)\n\t    // debug - console.log( [index, graph_array] )\n\t    \n\t    if (index < graph_array.length ) { \n\t\t//get the graph info using destructuring \n\t\tvar [id , graph] = graph_array[index] \n\t\tgraph.render_into_element(el) \n\t    } else { \n\t\t\n\t\treturn \"\" \n\t\t\n\t    }\n\t    \n\t})\n\t\n\t//here we will resolve the container \n\tif ( typeof container == 'string' )  { \n\t    container = document.getElementById(container) \n\t}  // if not for now assume it is the element \n\t\n\t//render the \n\tapp_render(container,app_el)\n\n    } \n\n    /* \n     * Streams data to a particular graph defined by graph_id. \n     * @param {Number} x - The x coordinate for new data \n     * @param {Vector} ys - New y points to add. These should correspond to and be in the same order as the series_vector assoiated with the same graph id\n     */\n    stream_to_graph(id , x , ys ) { \n\tbokeh_multi_stream(this.graphs[id].get_data_source(), x , ys ) \n    }\n    \n    /* \n     * Main data handler. \n     * @param {Object} series_buffer - Dictionary with all the series values for updating\n     */\n    handle_sensor_buffer(x,series_buffer) { \n\t\n\t\n\t//1) loop through the available graphs\n\tfor (var graph in this.graphs ) { \n\t    var series, ys , i , val \n\t    //2) get the series_vector for that graph \n\t    series = this.graphs[graph].series_vector \n\t    //3) look up the values for each series in the sensor_gui_buffer\n\t    ys = Array(series.length).fill(0)\n\t    for (i = 0 ; i < series.length ; i++ ) { \n\t\t//get the value of the series \n\t\tval =  series_buffer[ series[i] ]  \n\t\t\n\t\t//if it is false we pass it anyways (graph will handle it) \n\t\tys[i] = val \n\t    }\n\t    //update the graph \n\t    \n\t    bokeh_multi_stream(this.graphs[graph].get_data_source(), x , ys )\n\n\t    \n\t}\n\n    }\n\t\n\t\n    static multi_line_graph(container, opts) { \n\tcreate_static_multi_line_graph(container, opts) \n    }\n    \n    \n    \n}\n\n\n\n\nvar app_el =  null \n\nvar app_clear = function() { \n    while (app_el.firstChild) {\n\tapp_el.removeChild(app_el.firstChild)  \n    }   \n}\n\nvar app_render = function(container,el) { \n    if (app_el) { \n\tapp_clear() \n    } else { \n\tcontainer.appendChild(el)\n\tapp_el = container\n    }\n}\n","//Wed Oct  3 09:42:59 PDT 2018\n// I remembered my development mantra - be patient. simplify. Refactor when necessary \n\nimport {makeLogger} from \"./logger.js\"\nimport ui from \"./ui.js\"\nimport {util} from \"../module_resources/utils.js\"\n\n/**\n * \n * \n */\n\nexport default class state_machine {\n\n    /**\n     * \n     * \n     */ \n    constructor(opts) { \n\tvar {buffer_size, gui_mode, debug_mode, init} = opts\n\tthis.log = makeLogger(\"SM\") \n\tthis.buffer_size = buffer_size  || 200 \n\tthis.sensor_buffer_size = buffer_size \n\tthis.buffer = Array(buffer_size).fill(default_data_obj)\n\tthis.sensors = {} \n\tthis.transitioners = {} \n\tthis.transitioner_groups = {} \n\tthis.STATE  = init || {} \n\tthis.gui_mode = gui_mode \n\tthis.debug_mode = debug_mode || false \n\tif (gui_mode) { \n\t    //create the sensor_gui buffer \n\t    this.sensors_gui_buffer = {}\n\t    \n\t    this.ui_mapping = null\n\t    \n\t    //also create a ui object  \n\t    this.ui = new ui(null) \n\t} \n    } \n    \n    \n    /** \n     * Initializes the state machine\n     * @param {Object} state - the initial state for the state machine \n     */\n    initialize(state) { \n\tthis.STATE = state \n    } \n\n\n    /** \n     * Updates buffer with a data object. Uses js function `.shift()` to cycle array. \n     * @param {Object} obj - Data object to consume \n     */\n    update_buffer_with_data_object(obj) { \n\tthis.buffer.push(obj) \n\tthis.buffer.shift() \n    } \n    \n    /*\n     * Computes the order that sensors will be evaluated in \n     */\n    set_sensor_order() { \n\tvar compare = function(x,y) { \n\t    var l1 = x[1].level\n\t    var l2 = y[1].level\n\t    //console.log( [l1, l2] ) \n\t    if (l1 > l2 ) {   //index 2 is the level ! \n\t\treturn 1\n\t    } else  { \n\t\treturn -1\n\t    } \n\t}\n\tthis.sensor_order = util.dict_2_vec(this.sensors).sort(compare).map(e=>e[0])\n    }\n    \n    \n    /** \n     * Adds a sensor to the state machine. \n     * @param {Object} opts - contains id, f (function) , level (level 0 is evaluated first , then 1, etc.. ) \n     */\n    add_sensor(opts) { \n\tvar id,f,l\n\tid = opts.id ; f = opts.f ; l = opts.level \n\t//register the sensor \n\tthis.sensors[id] = {} \n  \t//add the function \n\tthis.sensors[id][\"function\"] = f \n\t//and then allocate a buffer for the sensor values \n\tthis.sensors[id][\"buffer\"] = Array(this.sensor_buffer_size).fill(NaN) \n\t//and then allocate the sensor level, 0 if undefined \n\tthis.sensors[id][\"level\"] = l || 0 \n\t//and create the 'last_skipped' flag (see run sensor for more information) \n\tthis.sensors[id][\"last_skipped\"] = false \n\tif (this.debug_mode) { \n\t    this.log(\"Added sensor: \" + id) \n\t}\n\tthis.set_sensor_order() \n    } \n    \n    /** \n     * \n     * Init gui \n     * @param {String|DOM} container - id or reference for container to render into \n     * @param {Object} ui_mapping - Dictionary where keys are graph ids and vals are vectors of the sensors which could be graphed on that graph. E.g { graph-1 : [\"acc_x\", \"acc_z\" ] , etc} \n     */\n    init_gui(container, ui_mapping) { \n\tthis.ui_mapping = ui_mapping \n\t//loop through the graphs \n\tfor (var graph in this.ui_mapping )  { \n\t    var sensors = this.ui_mapping[graph] \n\t    var opts = {id : graph ,series_vector : sensors}     /// POTENTIAL BUG ON NEXT RUN  !? UNLESS FIX IS GOLDEN FIX\n\t    this.ui.add_graph(opts)  // initializes a graph \n\t} \n\t\n\t//after all the graphs have been added then we call init \n\tthis.ui.init(container) \n\t\n    } \n\n    \n    /** \n     * Runs the sensor function with the state machine buffer as input \n     * then updates the corresponding sensor's buffer.\n     * @param {String} id - Sensor id to run   \n     */\n    run_sensor(id) { \n\t//get the sensor function\n\tvar f = this.sensors[id][\"function\"]\n\t//run the sensor passing in the sm object\n\tvar val = f(this) \n\t\n\t/*\n\t  sensors \n\t  only append the value if it exists \n\t  this allows the ability for sensors to act simultaneously as data filters \n\t  by introspecting on the data_packet somehow and deciding to reject it from \n\t  their buffer. \n\t \n\t*/\n\t\n\tif (val) { \n\t    //append the new value to the sensors buffer \n\t    this.sensors[id][\"buffer\"].push(val)\n\t    this.sensors[id][\"buffer\"].shift() \n\t    this.sensors[id][\"last_skipped\"] = false \n\t}  else {\n\t    //the sensor rejected a value. In this case, it can be helpful to set a special \n\t    //flag in case there are sensors which derive from this one and also wish to \n\t    //reject \n\t    this.sensors[id][\"last_skipped\"] = true \n\t}\n\t\n\treturn val \n    } \n\n    /** \n     * Utility function for retrieving the last N values of a sensor's buffer\n     * Used to make it easier to write Detectors \n     * @param {String} id - Sensor id \n     * @param {Number} num - The number of values to retrieve from END of buffer \n     */\n    get_sensor_last_N(id,num) { \n\tif (this.sensors[id][\"last_skipped\"]) { \n\t    //we have skipped a value, so will pass that info on \n\t    return false \n\t} else { \n\t    return this.sensors[id][\"buffer\"].slice(this.buffer_size - num) \n\t}\n    }\n\n    /** \n     * Utility function for retrieving the last value of a sensor's buffer\n     * Used to make it easier to write Detectors \n     * @param {String} id - Sensor id \n     */\n    get_sensor_last_1(id) { \n\tif (this.sensors[id][\"last_skipped\"]) { \n\t    //we have skipped a value, so will pass that info on \n\t    return false \n\t} else { \n\t    return util.first(this.get_sensor_last_N(id, 1 ) )\n\t} \n    }\n    \n    /** \n     * Adds a transitioner to the state machine. \n     * @param {String} id - Transitioner id for reference \n     * @param {Object} transitioner - Transitioner implementation (Object with keys [detector, applicator]) The detector and applicator both  accept the state_machine object in its entirety in order to allow easy access to all fields. \n     */\n    add_transitioner(id,transitioner) { \n\t//make sure it has what we want \n\tif (! (transitioner.detector && transitioner.applicator ) ) { \n\t    throw \"Transitioner object does not contain both detector and applicator!\" \n\t} \n\t\n \t//register the transitioner\n\tthis.transitioners[id] = transitioner \n\t\n\t//if it is part of a group we register that too , and by default activate it \n\tif (transitioner.group) { \n\t    this.transitioner_groups[transitioner.group] = true \n\t}\n\t\n\tif (this.debug_mode) { \n\t    this.log(\"Added transitioner: \" + id) \n\t}\n\n    }\n    \n    /** \n     * Runs the transitioner \n     * @param {String} id - Transitioner to run \n     */\n    run_transitioner(id) { \n\t//get the transitioner  \n\tvar transitioner = this.transitioners[id] \n\t\n\t//get the group and group status\n\tvar group = transitioner.group\n\tvar group_status = this.transitioner_groups[group]\n\t\n\t//only run if group is NULL or if it exists and is TRUE \n\tif ( group_status != false ) {\n\t    \n\t    //get the detector and applicator \n\t    var detector = transitioner.detector \n\t    var applicator = transitioner.applicator \n\n\t    \n\t    //the detector and applicator both  accept the state_machine object in its entirety in order to allow easy access to all fields \n\t    //apply the applicator IF the detector returns true  \n\t    if (detector(this)) { \n\t\tif (this.debug_mode) { this.log(\":match: => \" + id) }\n\t\tapplicator(this)  // the applciator will actually mutate the this.STATE object  \n\t\t// deactivate this group if it is part of one\n\t\tif (group_status) { \n\t\t    this.transitioner_groups[group] = false \n\t\t} \n\t    } else { \n\t\tif (this.debug_mode) { this.log(\":fail: => \" + id) }\n\t    }\n\t    \n\t}\n\t\n    } \n    \n    \n    \n    /** \n     * Run all sensors. Will sort them by the sensor level \n     */\n    run_sensors() { \n\tfor (var i =0 ; i < this.sensor_order.length; i++ ) { \n\n\t    var sensor_id = this.sensor_order[i]\n\t    var val = this.run_sensor(sensor_id) \n\t    \n\t    if (this.debug_mode) {\n\t\tthis.log(\"Ran sensor: \" + sensor_id + \" with result: \" )\n\t\tthis.log(val)\n\t    }\n\t    \n\t    if (this.gui_mode){ \n\t\tthis.sensors_gui_buffer[sensor_id] = val \n\t    }\n\t}\n\t\n    }\n\n\n    /** \n     * Processes a data object, running one cycle of the state machine. \n     * @param {Object} obj - Data object to process \n     */\n    process_data(obj) { \n\t\n\t//1. update the data buffer  \n\tthis.update_buffer_with_data_object(obj) \n\t\n\t//2. now we need to update all of the sensors \n\tthis.run_sensors() \n\t\n\t//3. now we run all the transitioners (which rely on most up to date Sensor values) \n\tfor (var transitioner_id in this.transitioners ) { \n\t    this.run_transitioner(transitioner_id) \n\t} \n\t\n\t//at this point, this.STATE should be updated , one cycle of the state machine has been completed \n\t//in order to reset, we should return the state of all transition groups \n\tfor (var group in this.transitioner_groups) {\n\t    this.transitioner_groups[group] = true \n\t}\n\t\n\t\n\t// after all this is done we will update the ui \n\t//the sensors_gui_buffer is now full and updated and can be passed to the ui for processing \n\t//pass all the sensor data to the UI for updating \n\tif (this.gui_mode) { \n\t    // also we need to give an X coordinate for the data  \n\t    // for now we will pass the 'time' value of the data obj \n\t    this.ui.handle_sensor_buffer(obj.time,this.sensors_gui_buffer)\n\t}\n\n\t\n    } \n    \n    /** \n     * For debug purposes and profiling. Processes one cycle with a defualt data object\n     */\n    run_debug_cycle() { \n\tthis.process_data(random_data_obj()) \n    } \n    \n\n    \n}\n\n\nvar default_data_obj = { \n    'acc_x' : 0 , \n    'acc_y' : 0 , \n    'acc_z' : 0 , \n    'gyr_x' : 0 , \n    'gyr_y' : 0 , \n    'gyr_z' : 0 , \n    'sample': 0 , \n    'time'  : 0 , \n    'dev'   : \"B\" \n}\n\n\n//for generating random data packets \nvar m = Math.random \nvar count = 0 \nfunction random_data_obj() { \n    return {'acc_x' : m(),\n\t    'acc_y' : m(),\n\t    'acc_z' : m(), \n\t    'gyr_x' : m(), \n\t    'gyr_y' : m(), \n\t    'gyr_z' : m(),\n\t    'sample': count++ , \n\t    'dev'   : \"B\"}\n} \n","// Thu Nov  8 18:17:14 PST 2018\n\nimport {makeLogger} from \"./logger.js\"\nimport {util} from \"../module_resources/utils.js\"\n\n/**\n * Applies a transformation function to a data stream \n *\n * @param {Function} f - The function to use as transform \n */\nexport default class transformer {\n    \n    constructor(f) { \n\tthis.f =  f\n\tthis.log = makeLogger(\"TF\")\n\tthis.default_handler = function(data) { \n\t    this.log(\"No data handler has been defined!\") \n\t} \n\tthis.data_handler = this.default_handler \n    } \n\n    /** \n     * Set the transformer function \n     * @param {Function} func - Function which accepts ONE raw data object and transforms it.\n     */ \n    set_transformer(func) { \n\tthis.f = func \n    } \n    \n    \n    /** \n     * Sets the data_handler attribute\n     * @param {Function} func - Function which accepts ONE raw data object and processes it.\n     */ \n    set_data_handler(func) { \n\tthis.data_handler = func \n    }\n\n    \n    \n    /** \n     * Process a received data object (simply pass it to the data handler) \n     * @param {obj} Data object to receive and transform \n     */ \n    process_data(obj) { \n\tthis.data_handler( this.f(obj) ) \n    }\n\n    \n    \n}\n\n","// Wed Dec  5 08:11:17 PST 2018\n\nimport {makeLogger} from \"./logger.js\"\nimport util from \"../module_resources/utils.js\"\n\n/**\n * Logs whatever it receives\n *\n * @param {Function} f - The function to use as transform \n */\nexport default class logger_node {\n    \n    constructor() { \n\tthis.log = makeLogger(\"LN\")\n\tthis.default_handler = function(data) { \n\t    //do nothing  \n\t    return null \n\t} \n\tthis.data_handler = this.default_handler \n    } \n\n    /** \n     * Sets the data_handler attribute\n     * @param {Function} func - Function which accepts ONE raw data object and processes it.\n     */ \n    set_data_handler(func) { \n\tthis.data_handler = func \n    }\n\n    \n    /** \n     * Process a received data object (simply pass it to the data handler) \n     * @param {obj} Data object to receive and transform \n     */ \n    process_data(obj) { \n\tthis.data_handler( obj ) \n\tconsole.log(obj)\n    }\n\n    \n}\n\n","// Thu Nov  8 18:55:08 PST 2018\n\nimport {makeLogger} from \"./logger.js\"\nimport util from \"../module_resources/utils.js\"\n\n/**\n * Simulator node for testing data streams\n *\n */\nexport default class simulator {\n    \n    constructor(opts) { \n\t\n\tthis.opts  = opts\n\t\n\tthis.log = makeLogger(\"SIM\")\n\tthis.mode = opts.mode \n\tthis.default_handler = function(data) { \n\t    return null \n\t} \n\tthis.data_handler = this.default_handler \n\tthis.stream_interval = null \n\t//this.load_time = (new Date()).getTime() \n    } \n\n    /** \n     * Sets the data_handler attribute\n     * @param {Function} func - Function which accepts ONE raw data object and processes it.\n     */ \n    set_data_handler(func) { \n\tthis.data_handler = func \n    }\n\n    /**\n     * Start streaming simulated data \n     * \n     */\n    start_stream(r) { \n\tthis.stream_interval = setInterval( (this.send_val).bind(this) , r ) \n\t\n    }\n    \n    /** \n     * Stop streaming data \n     */ \n    stop_stream() { \n\tclearInterval(this.stream_interval) \n    }\n    \n    send_val() { \n\tvar val  ; \n\tswitch (this.opts.mode)  { \n\tcase 'sin' : \n\t    val  = Math.sin ( (new Date().getTime()) * this.opts.rate )\n\t    break  ; \n\tcase 'rand' : \n\t    val = (this.opts.multiplier || 1 ) * Math.random() + (this.opts.offset || 0 ) \n\t    break ; \n\tcase 'burst' : \n\n\t    var burst = ! ( (new Date).getSeconds() % 5  )\n\t    if (burst ) { \n\t\t//val = {x :  0.1*Math.random() + 10} \n\t\t//console.log(\"burst\")\n\t\tval = {x :  Math.random() + 5, y : Math.random() + 20}\n\t    } else { \n\t\t//val = {x :  0.1*Math.random() + 0.5 }\n\t\tval = {x :  Math.random() + 5, y : Math.random() + 10}\n\t    }\n\t    break ;\n\t} \n\t\n\tthis.data_handler(val) \n    } \n       \n}\n\n","import {makeLogger} from \"./logger.js\"\nimport {util} from \"../module_resources/utils.js\"\n\n\n//scroll DOWN for class definition ! \n// will need to tidy up this file @ some point \n\n// if array of numbers, return the power of array\n// if its a dictionary, then return the reduced version of all its keys\n// if its a number, return the number\n// for now i wont compare strings\n\nvar  power = util.rms \n    \nfunction map_f_on_dict(d,f) {\n    for (var k in d ) {\n\td[k] = f(d[k]) \n    }\n    return d \n}\n\nfunction reduce_val(v) {\n\n    if (typeof v == \"object\") { \n\tif (Array.isArray(v)) {\n\t    // its an array\n\t    return power(v) \n\t    \n\t} else {\n\t    // assume its a dict\n\t    return map_f_on_dict(v, reduce_val) \n\t}\n    } else {\n\n\t// assume its a number\n\treturn v  \n\n    }\n\n}\n\nvar reduce = reduce_val \n\nfunction reduce_dict(obj) {\n    return map_f_on_dict(obj, reduce_val)\n}\n\nlet test_dict = { acc : [ 1,2,3,4,5] , gyr : { foo : 2 , bar : [1,2,3,4,5] } , happy : 1 } \n\n// then, I will need to  Linearize the data object (will assume it is a dict) \n///  loop through keys\n///  if num, push num to ret \n///  if dict, push the recursive result\n\nfunction linearize_dict(obj) {\n    var result = []\n    for (var k in  obj) {\nif (typeof obj[k]  == \"object\" ) {\n   result.push( linearize_dict(obj[k]) ) \n} else {\n   result.push(obj[k])\n} \n    }\n    let flattened =  [].concat.apply([], result)\n    return flattened \n\n} \n\nfunction linearize(obj) {\n    return linearize_dict(obj) \n} \n\n\n\n/**\n * Detects and emits deviation \"events\" from streams of arbitraty data objects\n *\n * @param {Object} opts - configuration options\n */\nexport default class event_detector {\n    \n    constructor(opts) { \n\tvar opts = opts || {} \n\tthis.opts =  opts\n\tthis.log = makeLogger(\"ED\")\n\n\tthis.state =  \"awaiting_baseline\" //  established_baseline | processing_event\n\t\n\t//init counters for estabishing baseline \n\tthis.baseline_counter = 0 \n\tthis.baseline_number = opts.baseline_number || 60\n\t\n\t//keep log of events that have been detected \n\tthis.current_event = [] \n\tthis.events =  {} \n\t\t\t\n\t//set detection threshold \n\tthis.detection_params = { upper : null, lower : null } \n\t//detection_thresh expressed as percent difference \n\tthis.init_detection_params(opts.detection_thresh || 30) \n\t\n\t// save the last linearized packet for calculation \n\tthis.last_linearized = null \n\t\n\t// initialize history buffer \n\tthis.history_buffer_size  = opts.history_buffer_size || 50\n\tthis.init_history_buffer()  \n\t\n\tthis.default_handler = function(data) { \n\t    this.log(\"No data handler has been defined!\") \n\t} \n\tthis.data_handler = this.default_handler \n\t\n    } \n\n    init_detection_params(t) { \n\tthis.detection_params.upper = Math.log( (t+100)/100 ) \n\tthis.detection_params.lower = Math.log( (100-t)/100 )\n    }\n    \n    in_range(val) { \n\treturn (val >= this.detection_params.lower && val <= this.detection_params.upper) \n    }\n    \n    detect(arr) {\n\treturn !util.apply( util.and , arr.map(this.in_range, this)  )\n    }\n    \n    /** \n     * Statefully checks if detector is at baseline \n     * @param {Boolean} detected - result of this.detect() \n     */\n    check_baseline(detected) { \n\tif (detected) { \n\t    //detected an event, reset the counter\n\t    this.baseline_counter = 0 \n\t    return false \n\t} else { \n\t    //no event detected... increment baseline counter \n\t    this.baseline_counter += 1 \n\t    if (this.baseline_counter > this.baseline_number) { \n\t\t// reset baseline counter  (for later) \n\t\tthis.baseline_counter = 0 \n\t\treturn true \n\t    } \n\t    return false \n\t}\n    }\n    \n    /** \n     * Process a received data object\n     * @param {obj} Data object to receive \n     */ \n    process_data(obj) { \n\n\t//transform the object into linearized struct \n\tlet lp = linearize(reduce(obj))\n\t\n\t//on the first call we will set last_linearized \n\t//and return \n\tif (!this.last_linearized) { \n\t    this.last_linearized = lp\n\t    return \n\t}\n\t\n\t//on all subsequent calls we will get here.. \n\tvar result,bl ; \n\t\n\t//run the detection \n\tlet log_diff = util.array_log_diff(this.last_linearized, lp) \n\tlet detected = this.detect(log_diff) \n\n\tswitch (this.state) { \n\t    \n\tcase \"awaiting_baseline\" : \n\t    bl = this.check_baseline(detected) \n\t    if (bl) { \n\t\tthis.log(\"Baseline established\")\n\t\tthis.state = \"baseline_established\" \n\t    }\n\t    // should we add to history here? \n\t    break; \n\t    \n\tcase \"baseline_established\" :\n\t    // here we are waiting for the detection of an event \n\t    this.add_to_history(obj) //add current obj to history\n\t    if (detected) { \n\t\t//detected an event \n\t\tthis.log(\"Detected event...\") \n\t\tthis.state = \"processing_event\" \n\t\tthis.init_event() //copies contents of history buff into current event\n\t    } else {}  //do nothing\n\t    break; \n\t    \n\tcase \"processing_event\" : \n\t    //add the obj to current event \n\t    this.current_event.push(obj) \n\t    //check if we have reached baseline yet \n\t    bl = this.check_baseline(detected) \n\t    if (bl) { \n\t\tthis.log(\"Event ended\")\n\t\tthis.state = \"baseline_established\" \n\t\tthis.flush_event()\n\t    } else {  } //do nothing\n\t    break ; \n\t    \n\tdefault : \n\t    break ; \n\t} // END switch --- \n\t\n\tif (true) { \n\t    //this.data_handler(obj)\n\t    this.data_handler(log_diff)\n\t}\n    }\n    \n    /** \n     * Initiate event \n     * \n     */ \n    init_event() { \n\t//copy contents of history buffer into current event \n\tthis.current_event = [] \n\tfor (var i=0;i<this.history_buffer.length;i++) { \n\t    this.current_event.push(this.history_buffer[i])\n\t}\n\treturn null \n    }\n    \n    /** \n     * Flush current event to the event buffer \n     * \n     */ \n    flush_event() { \n\tthis.events[ new Date().getTime() ] = this.current_event\n\t// flush output to specific output pipe \n\t// v2 \n\t\n\tthis.log(\"Flushed event\") \n\tthis.current_event = [] \n    }\n    \n    add_to_history(obj) { \n\tutil.cycle_array(this.history_buffer, obj) \n    }\n\n    \n    /**\n     * init history buffer \n     * \n     */\n    init_history_buffer() { \n\tthis.history_buffer = Array(this.history_buffer_size).fill(0)\n    }\n    \n    \n    \n    \n    /** \n     * Sets the data_handler attribute\n     * @param {Function} func - Function which accepts ONE raw data object and processes it.\n     */ \n    set_data_handler(func) { \n\tthis.data_handler = func \n    }\n\n \n    static foo() { return 10 } \n    \n    \n}\n","// Fri Dec 21 12:12:27 EST 2018\n\nimport {makeLogger} from \"./logger.js\"\nimport {util} from \"../module_resources/utils.js\"\n\n\n/* \n[Fri Dec 21 12:12:27 EST 2018]\nI would like to make it such that ALL wrtsm nodes can inherit from this class \nthereby encapsulating all common functionality and providing an avenue for \nsimultaneous upgrades \n\nWould like to support: \n- stream_single \n- each node manages its connections to other nodes \n- various (named) output and input ports for nodes \n   \nTERMS=> \nPacket consists of { input_port_name , payload }\nPayload is the actual data which is communicated \n\nNodes always transmit PACKETS to each other,  which are then destructured into the \ndesired port, to which the specific PAYLOAD is delivered. \n\nA payload handler will match the payload at a specific port with a specific handler (or collection of handlers) , which each routes  processed payload to a specied OUTPUT port according to the routing defined in NODE_PAYLOAD_ROUTER \n\nOutputs are then processed via the routing in NODE_IO_ROUTER \n\nThe key thing to realize about this architecture is that there are both \nINTRA nodal routings (mapping input to output ports via handlers )  \n- these are handled by the NODE_PAYLOAD_ROUTER instance -- \nand \nINTER nodal routings (mapping output ports to input ports of other nodes via forwarding) \n-- these are handled by the NODE_IO_ROUTER ---\nBOTH of these routings can have !SEVERAL! handlers associated with a given port \n\nFor example, node_1 could have input ports (i1) and (i2) , and two output port (o1) and (o2). \nThe first INTRA nodal handler (PAYLOAD_ROUTER)  may route i1->o1 via HANDLER_1,  i.e. o1( HANDLER_1(i1) ) \nand another handler may route i1->o2 via HANDLER_2,  i.e. o2( HANDLER_2(i1) ) \n\nFinally, node_1 o2 could be routed to multiple input ports of other nodes. \nYou will notice that the base_node class has two instances in the code when a handler_obj \nIs retrieved and then all the attached handlers are called with a payload. \nThese two instances correspond to the INTRA and INTER nodal mappings discussed above\n\n--- \n\nAbout streaming. \nthis.enable_stream will make  a SOURCE node initialize its data soure, but this.streaming will still be false and the source node will IGNORE packets \nthis.streaming = true will allow ANY node to actually process its input packet \n\n\n*/\n\n\n\n\n/* \n * Object for retaining information of input and output ports of a node, \n * as well as information about global node connectivity \n */\nclass node_io_router { \n    \n    constructor() { \n\tthis.inputs = {} \n\tthis.outputs = {} \n\tthis.base_node = null \n\t/* initialize the global node connectivity map (used to inspect connections)  */ \n\tif (! window.wrtsm.node_connections ) { window.wrtsm.node_connections = {} }\n    } \n    \n    new_input(id) { \n\tthis.inputs[id] = {} \n    }\n    \n    new_output(id) { \n\tthis.outputs[id] = {} \n    }\n    \n    ensure_input(i) { \n\tif (!this.inputs[i]) { this.new_input(i) }\t\n    } \n    \n    ensure_output(o) { \n\tif (!this.outputs[o]) { this.new_output(o) }\t\n    } \n    \n    ensure_input_output(i,o) { \n\tthis.ensure_input(i) ; this.ensure_output(o)  ; \n    }\n    \n    get_connection_name({dict_from, dict_to, input_port, output_port}) { \n\treturn dict_from.base_node.id + \".\" + output_port + \"~>\" + dict_to.base_node.id + \".\" + input_port \n    }\n\t\n    /* \n     * Connect output_port of dict_from with input_port of dict_to \n     *\n     */\n    connect({output_port, dict_from, input_port, dict_to}) { \n\t/*  If the output_port or input_port is missing should ERROR  */ \n\tconsole.assert(dict_from.outputs[output_port])\n\tconsole.assert(dict_to.inputs[input_port])\n\t\n\t/* \n\t Some info briefly. The purpose of this fn is to route a payload OUT of a node \n\t and into the correct port of another node. Once it leaves the dict_from we no \n\t longer care what happens (presumably there are handlers set up for it!)  \n\t \n\t The output dictionary this.outputs is indexed by the output_port name. \n\t \n\t */ \n\t\n\t/* get connection name */\n\tlet connection_name = this.get_connection_name({dict_from, dict_to, input_port, output_port})\n\tdict_from.outputs[output_port][connection_name] = function(payload) { \n\t    // this function is the payload handler\n\t    // will create packet and route it to destination node \n\t    let packet = { input_port, payload } \n\t    dict_to.base_node.process_packet(packet)\n\t}\n\t\n\t/* and will also update the global connection struct */ \n\twindow.wrtsm.node_connections[connection_name] = { \n\t    source : [ dict_from.base_node.id , output_port ], \n\t    sink   : [ dict_to.base_node.id , input_port ] \n\t} \n\t\n    }\n    \n    disconnect({output_port, dict_from, input_port, dict_to}) { \n\t/*  If the output_port or input_port is missing should ERROR  */ \n\tconsole.assert(dict_from.outputs[output_port])\n\tconsole.assert(dict_to.inputs[input_port])\n\t\n\t/* get connection name */\n\tlet connection_name = this.get_connection_name({dict_from, dict_to, input_port, output_port})\n\tdict_from.outputs[output_port][connection_name] = null \n\t\n\t/* and will also update the global connection struct */ \n\twindow.wrtsm.node_connections[connection_name] = null \n    }\n    \n    get_global_connections() { \n\treturn window.wrtsm.node_connections \n    }\n    \n    set_base_node(node) { \n\tthis.base_node = node \n    }\n    \n}\n\n/* \n * Object for managing handlers and mapping between input and output ports \n */ \nclass node_payload_router { \n    \n    constructor() { \n\tthis.handler_dict = {} \n\tthis.base_node = null //reference to the node this belongs to \n\tthis.io_router = new node_io_router() ; \n    }\n    \n    has_handler(port_name) { \n\treturn this.handler_dict[port_name]\n    }\n    \n    send_payload_to_output({payload, output_port}) {\n\t/* look up the handlers and execute them */ \n\tlet handler_obj = this.io_router.outputs[output_port]\n\t/* each handler obj is a dict with multiple handlers\n\t   indexed via connection_name */ \n\tfor (var k in handler_obj ) { \n\t    handler_obj[k](payload) \n\t}\n    }\n\t\n    add_input_handler({handler_id, input_port, handler, output_port})  { \n\n\t//create the ports if they do not exist \n\tthis.io_router.ensure_input_output(input_port, output_port) \n\t\n\t//create and register the appropriate handler \n\tif (!this.has_handler(input_port) ) { \n\t    this.base_node.dlog(\"Handler unregistered\")\n\t    //handler not yet defined for this port \n\t    this.handler_dict[input_port] = {} \n\t} \n\t  \n\t//handlers have been defined  \n\tthis.base_node.dlog(\"Handler registered...\")\n\tthis.handler_dict[input_port][handler_id] = (function(_payload) { \n\t    //process the payload with the handler and send to output port \n\t    let payload = handler(_payload) \n\t    this.send_payload_to_output({payload, output_port})\n\t}).bind(this)   /* have to bind for this reference */\n    }\n    \n    remove_input_handler(opts) { \n\tvar {input_port, handler_id} = opts \n\tif (this.has_handler(input_port)) { \n\t    this.handler_dict[input_port][handler_id] = null \n\t}\n    }\n    \n    set_base_node(node) { \n\tthis.base_node = node \n    }\n    \n}\n\n\n/**\n * Base class for defining wrtsm nodes \n *\n */\nexport default class base_node {\n    \n    constructor(opts) { \n\topts = opts || {} \n\t\n\t/* instantiate member variables */ \n\tthis.opts = opts\n\tthis.name = opts.node_name || \"base_node\" \n\t/* create global counter for node IDs */ \n\tif (!wrtsm.node_counter) {wrtsm.node_counter = 0}\n\tthis.id = this.name + \"_\" + wrtsm.node_counter++\n\tthis.log = makeLogger(this.id) \n\tthis.dev_logger = makeLogger(this.id + \"_dev\")\n\tthis.dev_mode = true \n\tthis.dlog = function(msg) { if (this.dev_mode) { this.dev_logger(msg) } } \n\tthis.dclog = function(msg) {if (this.dev_mode) { console.log(msg) } } \n\tthis.creation_time = new Date() \n\t/* stream stuff */ \n\tthis.num_to_stream = null //for gating number of packets from source \n\tthis.stream_enabler = opts.stream_enabler\n\tthis.stream_disabler = opts.stream_disabler\n\t/* by default only sources must be enabled and started */ \n\tthis.streaming = opts.streaming || !opts.is_source \n\tthis.stream_enabled = opts.stream_enabled ||  !opts.is_source \n\t    \n\t/* configure the node type base on opts params  */ \n\tthis.is_source     = opts.is_source \n\tthis.is_sink       = opts.is_sink \n\tthis.is_through    = opts.is_through || true \n\t/* these have significance in terms of base functionalities of the node /* \n\n\t\n\t/* create a payload router object for managing connections  */\n\tthis.payload_router = new node_payload_router() \n\t\n\t/* assign appropriate references */\n\tthis.io_router = this.payload_router.io_router \n\tthis.payload_router.set_base_node(this) \n\tthis.io_router.set_base_node(this) \n\t\n\t/* define a default handler */\n\tthis.default_handler = (function(payload){\n\t    this.log(payload); return payload //must return in order to pass it on ! \n\t}).bind(this)\n\t\n\t/* By default each node maps main_input -> main_handler -> main_output */ \n\tlet main_opts = {handler_id : \"main\" , input_port : \"main_input\" , \n\t\t\t output_port : \"main_output\" , handler : this.default_handler }\n\t\n\t/* configure main route */ \n\tthis.payload_router.add_input_handler( main_opts ) \n    } \n    \n    /* \n     * Helper function for calling handlers \n     * @param {obj} opts - Contains {handler_obj , payload} \n     */\n    run_handlers({handler_obj, payload}) { \n\tfor (var k in handler_obj ) { \n\t    handler_obj[k](payload) \n\t}\n    }\n    \n    /** \n     * Generic packet processor \n     * @param {Dict} packet - contains { input_port , payload } \n     */ \n    process_packet({input_port, payload}) { \n\tif (this.streaming) { \n\t    this.dlog(\"Processing data packet...\")\n\t    //in general when a packet comes in we \n\t    //1. find the handlers associated with the input_port requested \n\t    let handler_obj = this.payload_router.handler_dict[input_port] \n\t    this.dclog(handler_obj)\n\t    //2. make sure it exists -- if not this is likely an error \n\t    console.assert(handler_obj) \n\t    //3. run all the handlers with the included payload \n\t    this.run_handlers({handler_obj, payload})\n\t    \n\t    if (this.num_to_stream) { \n\t\tif (--this.num_to_stream == 0 ) { this.streaming = false } \n\t    } \n\t\t\t\t\t\t\n\t} else {this.dlog(\"Not streaming!\")}\n    }\n\t    \n    \n    \n    /* pass on creation of inputs */ \n    new_input(id)  { this.io_router.new_input(id) }\n    new_output(id) { this.io_router.new_output(id) }\n    \n    /** \n     * Connect node to another node \n     * @param {base_node} sink - Node to connect to \n     * @param {obj} opts - Contains {output_port = \"main_output\",input_port = \"main_input\"}\n     */\n    connect(sink, { output_port = \"main_output\" , input_port = \"main_input\" } = {} ) { \n\tlet dict_from = this.io_router \n\tlet dict_to   = sink.io_router \n\tthis.io_router.connect({output_port, dict_from, input_port, dict_to})\n\t\n\t/* return the sink node for chaining connections :) */ \n\treturn sink \n    }\n    \n    disconnect(sink, { output_port = \"main_output\" , input_port = \"main_input\" } = {} ) { \n\tlet dict_from = this.io_router \n\tlet dict_to   = sink.io_router \n\tthis.io_router.disconnect({output_port, dict_from, input_port, dict_to})\n\t\n\t/* return the sink node for chaining connections :) */ \n\treturn sink \n    }\n    \n    /*  \n\tSat Dec 22 12:59:41 EST 2018\n\tI am unsure if I should use protocols or class functions for implementing \n\tthe start_stream , stop_stream, stream_single... etc... \n\t\n\tFROM Stack Overflow --> \"class\" defines what an object is.\n\t\"protocol\" defines a behavior the object has.\n\t\n\tOne difference which resonated with me is: Consider you have an object STREAMER \n\twhich takes \n\ta base_node and will call start_stream. As long as you are only dealing with base_nodes \n\tthis is fine, but if in the future you could have OTHER objects which ALSO implement \n\tstart_stream, then for extensibility sake it is better to implmenet STREAMER \n\tby having it accept ANY object which implements a protocol ? \n\t\n\tI think this makes a bigger difference if you are using a STATICALLY typed language, \n\tsince in a dynamically typed language functions can take arbitrary inputs without \n\tvalidating what their TYPE is or which protocols they implement (and call them \n\thowever they want -- which of course risks run time errors ) \n\t\n\tRegardless -- JS does not support protocols , so I will have child classes \n\tassign functions to instance variables which are called via a \"protocol\" \n     */\n    \n    /* the member variables used below are created an object instantiation */ \n    enable_stream()  {this.stream_enabler(this)}\n    disable_stream() {this.stream_disabler(this)}    \n    \n    /* start, stop, and num streams */\n    start_stream()  { \n\tif (!this.stream_enabled) { this.enable_stream() } \n\tthis.num_to_stream = null \n\tthis.streaming = true \n    }\n    stop_stream() { \n\tthis.streaming = false \n    }\n    stream_num(n) { \n\tif (!this.stream_enabled) { this.enable_stream() } \n\tthis.num_to_stream = n \n\tthis.streaming = true \n    } \n    stream_single() {this.stream_num(1)} \n\n    /* Dev utilities for maually triggering nodes */ \n    /* These are not originally intended for realtime node communications */\n    /* though may prove useful */ \n    trigger_input_packet({input_port = \"main_input\" , payload} ) { \n\tthis.process_packet({input_port , payload })\n    }\n    trigger_output_packet({output_port = \"main_output\" , payload} ) { \n\tthis.payload_router.send_payload_to_output({payload, output_port})\n    }\n    trigger_input(payload) { \n\tthis.trigger_input_packet({payload})\n    }\n    trigger_output(payload) { \n\tthis.trigger_output_packet({payload})\n    }\n}\n\n","// Sat Dec 22 22:02:38 EST 2018\n\nimport {util} from \"../module_resources/utils.js\"\nimport base_node from  \"./base_node.js\"\n\n/**\n * Manages the websocket connection to an incoming data stream.\n *\n * @param {String} url - The websocket url to connect to, e.g. ws://localhost:1234\n */\nexport default class web_socket extends base_node {\n    \n    constructor(url) { \n\t\n\tlet stream_enabler = function(_this){ \n\t    _this.connect() \n\t}\n\t\n\tlet stream_disabler = function(_this){ \n\t    _this.send_json({type : \"control\" , data : \"stop\" })\n\t    _this.connection.close() \n\t}\n\t\n\tlet node_name = \"WS\" \n\n\tlet is_source = true \n\t\n\tsuper({stream_enabler, stream_disabler, node_name, is_source})\n\t\n\tthis.url = url ;  \n\tthis.connection = null ;  \n\n    } \n    \n    /**\n     * Connect to remote websocket server. Upon success, registers the websocket connection\n     * as \"client\" with the server, enables streaming, and this.logs to console. \n     */ \n    connect() { \n\tvar conn  = new WebSocket(this.url) ; \n\t// Connection opened\n\tconn.addEventListener('open', (function (event) {\n\t    this.log(\"Connection to \" + this.url + \" successful. Registering client with server.\")\n\t    this.send_json({type: \"register\" , data : \"client\" })\n\t    this.send_json({type: \"control\"  , data : \"start\"  }) \n\t}).bind(this)) //bind is necessary for web_socket class vs WebSocket instance! \n\n\t// Listen for messages\n\tconn.addEventListener('message', (function (event) {\n\t    let payload = util.dict_vals_2_num(JSON.parse(event.data))\n\t    this.trigger_input(payload) //defaults to main input_port \n\t}).bind(this)) //bind is necessary for web_socket class vs WebSocket instance! \n\t\n\tthis.connection = conn ; \n    } \n    \n   /** \n     * Sends JSON data through socket. \n     * @param {Object} obj - Data object to send \n     */ \n    send_json(obj) { \n\tthis.connection.send(JSON.stringify(obj))\n    }\n\n}\n\n","// bundles all the modules into one object for easy access \n// Mon Oct 22 22:16:23 PDT 2018\n\nimport web_socket from \"./core_modules/web_socket.js\" \nimport data_storage from \"./core_modules/data_storage.js\" \nimport pipe_manager from \"./core_modules/pipe_manager.js\" \nimport raw_analyzer from \"./core_modules/raw_analyzer.js\" \nimport state_machine from \"./core_modules/state_machine.js\" \nimport transformer from \"./core_modules/transformer.js\" \nimport logger_node from \"./core_modules/logger_node.js\" \nimport simulator from \"./core_modules/simulator.js\" \nimport ui from \"./core_modules/ui.js\" \nimport event_detector from \"./core_modules/event_detector.js\" \nimport base_node  from \"./core_modules/base_node.js\" \nimport web_socket_tmp  from \"./core_modules/web_socket_tmp.js\" \n\n\n\nexport var mods = { web_socket, data_storage , pipe_manager , raw_analyzer, state_machine, ui, transformer, simulator, logger_node, event_detector ,base_node , web_socket_tmp } \n\n","import {util}     from \"./utils.js\"\n\nvar smu = { sensors : {} , transformers : {}  } \n\nsmu.sensors.field = function(field) { \n    return function(sm) { \n\tlet d = sm.buffer \n\treturn util.last(d)[field] \n    }\n} \n\n\nexport { smu } \n","import {util}     from \"./module_resources/utils.js\"\n\nvar dev = { vars : {} } \n\n\ndev.msg = \"Used for shipping development objects and functions with wrtsm\" \n\nexport { dev } \n","import {mods}  from  \"./module_bundle.js\"\nimport {smu}   from  \"./module_resources/sm_utils.js\" \nimport {dev}   from  \"./dev.js\"\n\n// defines object that will be attached to window \nvar wrtsm = {}  \n\n//give it modules\nwrtsm.mods = mods \nwrtsm.smu  = smu \nwrtsm.dev  = dev\n\n\n\n//add it to window \nwindow.wrtsm = wrtsm \n\n\n//export it for use \nexport { wrtsm } \n\n\n\n","//Fri Oct  5 19:31:23 PDT 2018\n\n// filefor collecting definitions of Sensors and transitioners\n\nimport {logger} from \"../core_modules/logger.js\"\nimport {util}     from \"./utils.js\"\n\nlogger.register(\"sme\") \n\nvar sme = { sensors : { dev_a : {} , dev_b : {} } , \n\t    transitioners : {} }  \n\n\n//extract a specific field from the data objects \n//i.e. [{:acc_x :acc_y... } , ... ] => [ acc_x, acc_x ... ] \nsme.sensors.field = function(field) { \n    return function(d) { \n\td = d.buffer \n\treturn util.last(buffer)[field] \n    }\n} \n\n\n//field diff will take the  diff of a particular field in the data object \nsme.sensors.field_diff = function(field) { \n    return function(d) { \n\td = d.buffer \n\tvar l = d.length \n\treturn d[l-1][field] - d[l-2][field]\n    }\n} \n\n\n\nsme.is_dev_b = function (d) { \n    return d.dev == \"B\" \n} \n\nsme.is_dev_a = function (d) { \n    return d.dev == \"A\" \n} \n\nsme.sensors.dev_b.field = function(field) { \n    //return sme.generic_filter(sme.is_dev_b , d=>d[field] ) \n    return function(d) {\n\tvar buf = d.buffer \n\tvar d = util.last(buf) \n\tif (d.dev == \"B\") { \n\t    return d[field]\n\t} else { \n\t    util.debug(\"filter miss\")\n\t    return false }\n    }\n}\n\nsme.transitioners.test_turn_on  = { \n    \"detector\" : function(state_machine) { \n\treturn !state_machine.STATE.is_on \n\t\n    } , \n    \"applicator\" : function(state_machine) { \n\tstate_machine.STATE.is_on = true \n\tif (state_machine.debug_mode ) { logger.sme(\"TURNED ON\") }\n    },\n    \"group\" : \"switch\" \n}\n\n\nsme.transitioners.test_turn_off  = { \n    \"detector\" : function(state_machine) { \n\treturn state_machine.STATE.is_on \n    } , \n    \"applicator\" : function(state_machine) { \n\tstate_machine.STATE.is_on = false  \n\tif (state_machine.debug_mode ) { logger.sme(\"TURNED OFF\") }\n    } , \n    \"group\" : \"switch\" \n}\n\n\n\n\nexport { sme } \n","1//Fri Oct  5 18:28:58 PDT 2018\n// workflows for RoseGait  \n\nimport util     from \"../module_resources/utils.js\"\nimport {sme}      from \"../module_resources/state_machine_elements.js\"\nimport {wrtsm}  from \"../wrtsm.js\"\nimport {logger} from \"../core_modules/logger.js\"\n\nlogger.register(\"rg\") \n\nvar flow = {} \n\nflow.test_storage_persist = function(name) { \n    //1. create web_socket object \n    ws = new wrtsm.mods.web_socket(\"ws://localhost:1234\") \n\n    //2. create data_storage object \n    ds = new wrtsm.mods.data_storage(name) \n\n    //3. create pipe manager object and connect 1 & 2 \n    pm = new wrtsm.mods.pipe_manager() \n    pm.connect(ws,ds) \n\n    //4. Enable saving on the data_storage object every 5s  \n    ds.start_saving(5) \n\n    //5. connect the websocket (which should automatically start receiving data) \n    ws.connect()\n    \n    //6. Stop streaming after 20s \n    setTimeout(function() { \n\tws.stop_stream() \n\tds.stop_saving() \n\tconsole.log(\"Streaming and saving stopped.\") \n    }, 21*1000)\n    \n} \n\n\nflow.test_storage_replay = function() { \n    //1. create data_storage object & load session \n    ds = new wrtsm.mods.data_storage(\"eugene_walk_rev\") \n    ds.load_session() \n    \n    //2. create raw_analyzer object \n    ra = new wrtsm.mods.raw_analyzer() \n\n    //3. create pipe manager object and connect 1 & 2 \n    pm = new wrtsm.mods.pipe_manager() \n    pm.connect(ds,ra) \n\n    //4. start the stream ! \n    ds.start_stream() \n    \n    return [ds,ra ] \n\n} \n\nflow.test_state_machine = function(n) {\n    logger.rg(\"Creating state machine with size: \" + n) \n    var sm = new wrtsm.mods.state_machine({buffer_size : n, gui_mode:  false } ) \n    sm.initialize({\"is_on\" : false }) \n    \n    logger.rg(\"Adding sensors\") \n    sm.add_sensor({id:\"acc_x\" , f:sme.sensors.field(\"acc_x\"), graph : \"g1\"})\n    sm.add_sensor({id: \"acc_x_diff\" ,f: sme.sensors.field_diff(\"acc_x\"), graph : \"g1\"})\n    \n    logger.rg(\"Adding transitioners\") \n    sm.add_transitioner(\"test_turn_on\", sme.transitioners.test_turn_on ) \n    sm.add_transitioner(\"test_turn_off\", sme.transitioners.test_turn_off ) \n    \n    // ok so at this point everything should be initialized and we should be able \n    // to start profiling and inspecing the state machine \n    logger.rg(\"Returning sm\") \n    return sm \n    \n    \n    \n} \n\n\nflow.test_state_machine_gui = function(d) {\n    var n = 200 \n    logger.rg(\"Creating state machine with size: \" + n) \n    var sm = new wrtsm.mods.state_machine({buffer_size : n, gui_mode:  true } ) \n    sm.initialize({\"is_on\" : false }) \n    \n    logger.rg(\"Adding sensors\") \n    sm.add_sensor({id:\"acc_x\" , f:sme.sensors.field(\"acc_x\"), graph : \"g1\"})\n    sm.add_sensor({id: \"acc_x_diff\" ,f: sme.sensors.field_diff(\"acc_x\"), graph : \"g1\"})\n    \n    logger.rg(\"Adding transitioners\") \n    sm.add_transitioner(\"test_turn_on\", sme.transitioners.test_turn_on ) \n    sm.add_transitioner(\"test_turn_off\", sme.transitioners.test_turn_off ) \n    \n    // ok so at this point everything should be initialized and we should be able \n    // to start profiling and inspecing the state machine \n\n    sm.init_gui(\"wrtsm\",d) \n\n    logger.rg(\"Returning sm\") \n    return sm \n    \n    \n    \n} \n\nflow.playback_gui = function(d) {\n    var n = 200 \n    logger.rg(\"Creating state machine with size: \" + n) \n    var sm = new wrtsm.mods.state_machine({buffer_size :n, gui_mode:  true, debug_mode : false }) \n    \n    logger.rg(\"Adding sensors\") \n    sm.add_sensor({id:\"dev_b_gyr_z\" , f:sme.sensors.dev_b.field(\"gyr_z\") })\n    //sm.add_sensor({id: \"acc_x_diff\" ,f: sme.sensors.field_diff(\"acc_x\")})\n    sm.add_sensor({id: \"acc_y\" ,f: sme.sensors.field(\"acc_y\")})\n    sm.add_sensor({id: \"gyr_z\" ,f: sme.sensors.field(\"gyr_z\")})\n\n    logger.rg(\"Adding transitioners\") \n    sm.add_transitioner(\"test_turn_on\", sme.transitioners.test_turn_on )\n    sm.add_transitioner(\"test_turn_off\", sme.transitioners.test_turn_off )\n\n\n    // ok so at this point state machine should be initialized \n    logger.rg(\"Calling sm.init_gui\") \n    sm.init_gui(\"wrtsm\", d) \n    \n    //will load the file from storage \n    var ds = new wrtsm.mods.data_storage(\"eugene_walk_rev\") \n    ds.load_session() \n    \n    //and then create a pipe manager to connect the stored data file to the state machine \n    var pm = new wrtsm.mods.pipe_manager() \n    pm.connect(ds,sm) \n    \n    //return them and can call ds.start_stream() for continuous simulation \n    //OR ds.stream_single_packet() to step one sample\n    return [ds, pm, sm ] \n\n} \n\n\nflow.graph_dances = function() { \n    var d = { g1 : [\"acc_x\", \"acc_y\"] } //, \"gyr_z\"] }  \n    //[sm,d] = test_state_machine_gui({ g1 : [\"acc_x\"] , g2 : [ \"acc_y\"] }) \n    var sm = flow.test_state_machine_gui(d) \n    //[sm,d] = test_state_machine_gui({ g1 : [\"acc_x\",  \"acc_y\"] , g2 : [  \"gyr_z\"] })\n    //util.app_render(test_div_array(1,2)) \n\n\n    var line_dance = function() { \n\tsm.ui.handle_sensor_buffer(200+speed*counter, {acc_x : 0.5*counter , acc_y : -0.5*counter})\n    }\n\n    var sine_rate = 2/100\n    var sine_rate_2 = 5/100\n    var sine_rate_3 = 7/100\n    var sine_dance_0 = function() { \n\tsm.ui.handle_sensor_buffer(200+speed*counter, {acc_x : Math.sin(sine_rate*counter) , acc_y : -Math.sin(sine_rate_2*counter)})\n    }\n\n    var sine_dance_1 = function() { \n\tsm.ui.handle_sensor_buffer(200+speed*counter, {acc_x : Math.sin(sine_rate*counter) , acc_y : -Math.sin(sine_rate_2*counter) , gyr_z : Math.sin(sine_rate_3*counter)})\n    }\n\n\n    var speed = 20\n    var counter = 0 \n    var a = setInterval( (function() { \n\tsine_dance_0()\n\tcounter++ \n    }), 50 ) \n    var stop = function() { \n\tclearInterval(a) \n    }\n\n    return [sm  , a,  stop ] \n\n}\n    \n\n\n// [0,1,2,3,4] \n//  [1,1,1,1] \n\nflow.graph_sm_test = function() { \n    //now we will loop and do the perf \n    var num = 200\n    var interval = 1\n    var start = 2\n    var sizes = Array(num).fill(0) \n    var results = Array(num).fill(0) \n    for (var i = 0; i < num ; i ++ ) { \n\tvar size = start + i * interval \n\tsizes[i] = size \n\t//create the sm \n\tvar sm = test_state_machine(size) \n\t\n\t//define the perf function \n\tvar test_cycle = ( function() { \n\t    sm.run_debug_cycle() \n\t}).bind(sm)\n\t\n\t//now we perf it \n\tresults[i] = util.perf(test_cycle)\n    } \n    \n    //at this point results should be full . \n    logger.rg(\"Graphing results... \") \n    bar_graph(\"Perf\" , \"size\", \"time\" , sizes, results ) \n    logger.rg(\"hmm.. ?\")\n}\n    \n    \n// want to be able to play back data \n/* \nA brief historical aside: \nat first I recorded the data withuot converting the Strings inside the objects to numbers \nTo solve, I loaded the recorded file, then mapped the conversion accross the loaded buffer \nThen I made a new wrtsm.mods.data storage object with _rev extension, and connecnted d1 to d2. \nThen I started d2.save and d1.stream \nvoila \n */ \n\nflow.EW = function() { \n    d = new wrtsm.mods.data_storage(\"eugene_walk_rev\") \n    d.load_session() \n    \n    //at this pt data is accesible in d.loaded_sesssion \n    return d \n} \n    \n\n\n\nexport {flow} \n\n","\nvar sounds = {} \nsounds.ctx = new AudioContext()\n\nsounds.osc = function(type , freq, gainVal){\n    var osc, gain \n    \n    osc = sounds.ctx.createOscillator()\n    osc.frequency.value = freq\n    gain = sounds.ctx.createGain()\n    osc.type = type\n    gain.connect(sounds.ctx.destination)\n    gain.gain.value = gainVal\n    osc.connect(gain)\n    osc.start()\n    return osc \n} \n\n\n\n\n\n\n\nvar beep_time = 150\nvar beep_dic = { 0 : 300 , 1 : 350 , 2 : 400 , 3 : 450 , 4 : 500 }\nfunction beep(n) { \n    var f = beep_dic[n]\n    var s = sounds.osc(\"sine\" , f , 1 ) \n    setTimeout( function() {s.stop() } , beep_time)\n}\n\n\nexport { beep } \n\n\n","export function load_script(url,cb){\n\n    var script = document.createElement(\"script\")\n    script.type = \"text/javascript\";\n\n    if (script.readyState){  //IE \n        script.onreadystatechange = function(){\n            if (script.readyState == \"loaded\" ||\n                    script.readyState == \"complete\"){\n                script.onreadystatechange = null;\n\t\tif (cb) { \n                    cb();\n\t\t}\n            }\n        };\n    } else {  //Others\n        script.onload = function(){\n\t    if (cb) {\n\t\tcb();\n\t    }\n        };\n    }\n\n    script.src = url;\n    document.getElementsByTagName(\"head\")[0].appendChild(script);\n}\n\n\nexport function load_css(url,cb) { \n    \n    var link = document.createElement(\"link\")\n    link.type = \"text/css\";\n    link.rel = 'stylesheet';\n\n\n    if (link.readyState){  //IE \n        link.onreadystatechange = function(){\n            if (link.readyState == \"loaded\" ||\n                    link.readyState == \"complete\"){\n                link.onreadystatechange = null;\n\t\tif (cb) { \n                    cb();\n\t\t}\n            }\n        };\n    } else {  //Others\n        link.onload = function(){\n\t    if (cb) {\n\t\tcb();\n\t    }\n        };\n    }\n\n    link.href = url;\n    document.getElementsByTagName(\"head\")[0].appendChild(link);\n}\n    \n","\n\n\n//window.addEventListener(\"wrtsm_ready\" , wrtsm_init) \n\nlet util = wrtsm.util \nlet tf   = wrtsm.mods.transformer \nlet state_machine = wrtsm.mods.state_machine \nlet mods = wrtsm.mods \nlet pm = new mods.pipe_manager() \n\n\n\nfunction wrtsm_init() { \n    \n    // - \n    let t0 = util.now() \n\n    //define transformers \n    let bin = new tf( function(d) { if ( d > 0 )  { return 1 } else { return -1 } }) \n    let add_time = new tf (function(d) { return {val : d , time :  util.now() - t0 } })\n    \n    // create objects\n    let sim = new wrtsm.mods.simulator({mode : \"sin\"})\n    let sm  = new wrtsm.mods.state_machine({gui_mode : true } ) \n    let pm  = new wrtsm.mods.pipe_manager() \n\n    //configure the state machine \n    sm.add_sensor({id: \"val\" , f : wrtsm.smu.sensors.field(\"val\") })\n\n    // wire stuff up \n    pm.connect(sim,bin).connect(add_time).connect(sm)\n    \n    // init gui \n    sm.init_gui(\"wrtsm\" , { g1 : [\"val\" ]  } ) \n\n    //start the stream at rate of 20ms\n    sim.start_stream(400)\n} \n\n\n\n// for rosegait init, we have to accomplish a coup of things \n// 1. create a websocket object and connect to the websocket_server (on localhost:1234  by default) \n// 2. Create the desired pipeline for analysis and vizualization of the desired data \n// 3. Wrap the two above things into a function that is run AFTER the following two things \n//  - a) The websocket_server is started via node websocket_server.js \n//  - b) The ios app has connected to websocket_server by entering its url ( IP:1234 ) \n\nfunction rose_gait_test_connection() { \n    \n    //1. create web socket object\n    ws = new mods.web_socket(\"ws://localhost:1234\") \n    \n    //2. create a logger node  \n    ln = new mods.logger_node() \n    \n    //3. connect them with pipe manager \n    pm = new mods.pipe_manager() \n    pm.connect(ws,ln) \n    \n    //4. launch the web socket connection and we should get streaming data provided \n    //that 3a and 3b have been satisfied \n    ws.connect() \n    \n    //5. return objects for manipulation \n    return { ws, ln, pm } \n    \n} \n\nfunction rose_gait_init() { \n    \n    // TODO --> creation of satte machine and definition of relevant parameters, etc.. \n    // also TODO -> modify index.js to make use of menuX ! \n\n    //2. create state machine and define sensors \n    //let sm_buffer = 200 \n    //let sm        = state_machine({buffer_size : sm_buffer , gui_mode: true}) \n   \n}\n\n\nlet test_matrix = [ [1,2,3]  , [2,3,4] , [ 3,4,5 ] ] \n\n\n\n// FOR ARBITRARY GRAPHING -----------------------------------------------                                                   \nfunction dict_to_update(dict) { \n    return dict \n}\n\nfunction get_array_series(o) {\n    //console.log(o)\n    return util.range(0,o.length).map(v=>\"index_\" + v)\n}\n\nfunction get_dict_series(d) { \n    var ret\n    var list = Object.keys(d) \n    //return list   -- allows toggling the removal of time key from object\n    var ind = list.indexOf('time') \n    if (ind >= 0 ) { \n\tlist.splice(ind , 1 ) \n\tret = list \n    } else { ret = list } \n    return ret \n} \n\nfunction array_to_update(arr) { \n    let ser = get_array_series(arr)\n    return util.zip_map(ser, arr)\n}\n\n\nfunction make_graph_for_obj(opts) { \n    var {o, container, x_len} = opts \n    var graph_ui = new mods.ui()\n    var series   = null \n    //console.log(o)\n    if (typeof o == \"object\") { \n\tif (Array.isArray(o)) {\n\t    // its an array\n\t    console.log(\"Making array grapher\")\n\t    series = get_array_series(o) \n\t    graph_ui.convert = array_to_update\n\t} else {\n\t    // assume its a dict\n\t    console.log(\"Making dict grapher\")\n\t    series = get_dict_series(o) \n\t    graph_ui.convert = dict_to_update\n\t}\n    }\n    \n    graph_ui.add_graph({id  :\"main\", series_vector:  series, x_len : 1000})\n    graph_ui.init(container) \n    graph_ui.init_time = util.now()\n    return graph_ui \n}\n\n\nfunction graph_object(x,o,graph_ui) { \n    let updates = graph_ui.convert(o) \n    //console.log(updates)\n    //apply the updates to the graph \n    graph_ui.handle_sensor_buffer((x-graph_ui.init_time)/1000,updates)  // should work???\n}\n\n\nfunction get_object_grapher(opts) { \n    var {container, x_len} = opts \n    var grapher = {}\n    grapher.init = true \n    grapher.graph_ui = null \n    \n    grapher.process_data = function(o) { \n\tif (grapher.init) { \n\t    grapher.graph_ui = make_graph_for_obj({o,container,x_len})\n\t    grapher.init = false \n\t} else { \n\t    var t = util.now()\n\t    //console.log(o)\n\t    graph_object(t,o,grapher.graph_ui)\n\t}\n    }\n    \n    return grapher\n}\n\n\n//PROBLEM  !! when removing time attr from node then NO GREAPH! \n\nfunction get_sim_node(opts) {\n     // - \n    let t0 = util.now() \n    //define a transformer\n    let node = new tf (function(d) { \n\tvar packet =  {val : d , time :  util.now() - t0} \n\t//console.log(packet) \n\treturn packet \n    })\n    \n    // create objects\n    let sim = new wrtsm.mods.simulator(opts) \n    let pm  = new wrtsm.mods.pipe_manager() \n    // wire stuff up \n    pm.connect(sim,node)\n    return {sim, node} \n}\n\nfunction wrap_sim(s) { \n    let pm = new mods.pipe_manager() \n    let t0 = util.now() \n    //define a transformer\n    let t = new tf (function(d) { \n\tvar packet =  {val : d , time :  util.now() - t0} \n\treturn packet \n    })\n    pm.connect(s,t) \n    return { 'start_stream' : (function() { s.start_stream() }).bind(s) , \n\t     'set_data_handler' : (function(f) {t.set_data_handler(f)}).bind(t) } \n}\n\n\n\nfunction dev_0() { \n    var w = document.getElementById(\"wrtsm\") \n    var {sim,node} = get_sim_node({mode : \"rand\"})\n    \n    let grapher = get_object_grapher(w) \n    \n    node.set_data_handler( grapher.handler ) \n    \n    sim.start_stream()\n    return {sim, node, grapher}\n}\n\n\n\nfunction dev_1() { \n    let sim = wrap_sim( new mods.simulator({mode: \"rand\" , offset : 10 , multiplier : 1 }) ) \n    let grapher = get_object_grapher(document.getElementById(\"wrtsm\") )\n    let ln      = new mods.logger_node() \n    let ED      = new mods.event_detector() \n    \n    pm.connect(sim,ED).connect(grapher)\n\n    sim.start_stream() \n    return {sim, grapher, ED}\n}\n\nexport function dev_2() { \n    let sim = new mods.simulator({mode: \"burst\" } ) \n    let grapher = get_object_grapher({container : document.getElementById(\"wrtsm\") , \n\t\t\t\t      x_len     : 1000 } ) \n    let ln      = new mods.logger_node() \n    let ED      = new mods.event_detector({baseline_buffer_size : 5}) \n    \n    pm.connect(sim,ED).connect(grapher)\n    //pm.connect(sim,grapher)\n    //pm.connect(sim,ln)\n    //pm.connect(sim,ED).connect(ln)\n    sim.start_stream() \n    //return {sim, grapher, ED}\n    \n    \n    //an example of how to graph an event -- \n    //wrtsm.mods.ui.multi_line_graph(\"wrtsm\", { ys : [ ED.events[1545375031336].map(e=>e.y) ] } )\n    \n    return {sim,ED}\n}\n\nexport function test_base() { \n    let n1 = new mods.base_node() \n    let n2 = new mods.base_node() \n    n1.connect(n2) \n    return {n1, n2 } \n}\n\n\n\n\n\n\n","//The main program 1\n\n/* - - - - - - - */ \nconsole.log(\":: wrtsm initializing ::\")\n\n\nimport {wrtsm}  from  \"./wrtsm.js\"  //import global wrtsm object \nimport {flow}   from  \"./scripts/rose_gait_workflows.js\" \nimport {util}   from  \"./module_resources/utils.js\"\nimport {beep}   from  \"./module_resources/sounds.js\"\nimport {logger} from  \"./core_modules/logger.js\"\nimport {load_script, load_css} from  \"./module_resources/script_loader.js\"\nimport * as dev from  \"./scripts/dev.js\"\n\n// set debug \nutil.set_debug(false)\n\n//make logger \nlogger.register(\"wrtsm\")\n\n/* additions to global context */ \nwrtsm.flow = flow \nwrtsm.util = util \nwrtsm.beep = beep \nwrtsm.dev  = dev\n\n/* additions to window */ \nwindow.util = util \nwindow.mods = wrtsm.mod\nwindow.dev = dev\n\n// HANDLE BOKEH LOADING (load the content from cdn if Bokeh is not defined in the window) ======================================== > \nif (window.Bokeh) { \n    logger.wrtsm(\"Bokeh was detected already. If you experience any errors, please make sure that the following resources are included in your html for proper functionality:\")\n    console.log(\"<link rel=\\\"stylesheet\\\" href=\\\"https://cdn.pydata.org/bokeh/release/bokeh-0.12.5.min.css\\\" type=\\\"text/css\\\" />\")\n    console.log(\"<script type=\\\"text/javascript\\\" src=\\\"https://cdn.pydata.org/bokeh/release/bokeh-0.12.5.js\\\"></script>\")\n    console.log(\"<script type=\\\"text/javascript\\\" src=\\\"https://cdn.pydata.org/bokeh/release/bokeh-api-0.12.5.min.js\\\"></script>\")\n} else { \n    //will dynamically load the above resources: \n    //define callback \n    function load_api() { \n\tlogger.wrtsm(\"bokeh-0.12.5.js loaded\")\n\twindow.ls = load_script \n\tload_script(\"https://cdn.pydata.org/bokeh/release/bokeh-api-0.12.5.min.js\" , function () { \n\t    console.log(\"[wrtsm]:: bokeh-api-0.12.5.min.js loaded\" )\n\t    //we will bubble an event that says wrtsm is ready ! \n\t    var event = new Event('wrtsm_ready');\n\t    window.dispatchEvent(event);\n\t} ) \n    } \n    logger.wrtsm(\"Loading Bokeh functionality:\") \n    load_script(\"https://cdn.pydata.org/bokeh/release/bokeh-0.12.5.js\" , load_api ) \n    load_css(\"https://cdn.pydata.org/bokeh/release/bokeh-0.12.5.min.css\" , function () { console.log(\"[wrtsm]:: bokeh-0.12.5.min.css loaded\" ) } ) \n} \n// HANDLE BOKEH LOADING (load the content from cdn if Bokeh is not defined in the window) ======================================== > \n\nwrtsm.load_time  = (new Date()).getTime() \n\n\n\n\n//var d = {\"misc\" : [\"dev_b_gyr_z\"] } \n\n//setTimeout( function() { window.d = flow.playback_gui(d) ; window.d[0].start_stream()  } , 1000)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"]}