{"version":3,"sources":["core_modules/logger.js","module_resources/utils.js","core_modules/web_socket.js","core_modules/data_storage.js","core_modules/pipe_manager.js","core_modules/raw_analyzer.js","module_resources/global_params.js","core_modules/ui.js","core_modules/state_machine.js","module_bundle.js","wrtsm.js","module_resources/state_machine_elements.js","scripts/rose_gait_workflows.js","index.js"],"names":["makeLogger","tag","stuff","console","log","join","logger","register","global_debug","util","set_debug","b","bug","i","debug","msg","avg","arr","sum","length","take","coll","num","ret","Array","fill","arr_mult","x","map","y","perf","f","num_times","results","t0","performance","now","t1","range","a","len","first","d","last","zip","xs","ys","dict_2_vec","k","push","number_or_self","val","Number","isNaN","d_map","dict_vals_2_num","diff","r","max","curr_max","min","curr_min","dom","s","document","createElement","set_inner_html","thang","HTMLElement","appendChild","innerHTML","flex_row","id_base","container","className","html","make_div_array","m","n","id","style","fn","new_id_base","row","col","el","id_from_loc","c","test_div_array","toString","app_clear","app","getElementById","firstChild","removeChild","app_render","colors","get_colors","web_socket","url","connection","default_handler","data","data_handler","conn","WebSocket","addEventListener","event","send_json","type","bind","JSON","parse","func","obj","send","stringify","data_storage","name","session_id","Date","toISOString","data_history","part_counter","save_interval_id","loaded_session","stream_index","to_save","localStorage","setItem","rate","setInterval","flush_data","clearInterval","get_session","buffer_size","streaming","zero_time_axis","diffs","start_stream_loop","stop_stream","delay","setTimeout","t_1","csvContent","keys","Object","sort","dev","row_content","key","encodedUri","encodeURI","link","setAttribute","click","get_session_part_names","filter","includes","parts_names","merged","tmp","getItem","concat","apply","pipe_manager","from","to","set_data_handler","process_data","raw_analyzer","data_buffer","report","get_report","e","g_hist","g_line","get_field_average","obj_array","utils","params","global_x_len","plt","Bokeh","Plotting","make_y_series","make_x_series","create_multi_line_graph","opts","x_len","series_array","title","series_len","source","ColumnDataSource","p","figure","tools","sizing_mode","glyph","multi_line","field","line_color","plot","bokeh_multi_stream","ds","xss","yss","shift","setv","silent","trigger","Graph","series_vector","parent","multi_opts","background_fill_color","background_fill_alpha","border_fill_color","border_fill_alpha","multi_line_graph","show","ui","graphs","last_series_buffer","graph","graph_array","n_cols","n_rows","Math","ceil","app_el","index","render_into_element","get_data_source","series_buffer","series","state_machine","gui_mode","debug_mode","sensor_buffer_size","buffer","default_data_obj","sensors","transitioners","transitioner_groups","STATE","sensors_gui_buffer","ui_mapping","state","NaN","add_graph","init","slice","get_sensor_last_N","transitioner","detector","applicator","group","group_status","sensor_id","update_buffer_with_data_object","run_sensor","transitioner_id","run_transitioner","handle_sensor_buffer","time","random_data_obj","random","count","mods","wrtsm","window","sme","dev_a","dev_b","field_diff","l","is_dev_b","is_dev_a","buf","test_turn_on","is_on","test_turn_off","flow","test_storage_persist","ws","pm","connect","start_saving","stop_saving","test_storage_replay","load_session","ra","start_stream","test_state_machine","rg","sm","initialize","add_sensor","add_transitioner","test_state_machine_gui","init_gui","playback_gui","graph_dances","g1","speed","counter","acc_x","sin","acc_y","graph_sm_test","sizes","size","test_cycle","run_debug_cycle","bar_graph","EW"],"mappings":";AAUA,aATO,SAASA,EAAWC,GAChB,OAAA,WAAYC,IAAAA,IAAAA,EAAAA,UAAAA,OAAAA,EAAO,IAAA,MAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IAAPA,EAAO,GAAA,UAAA,GAC7BC,QAAQC,IAAI,IAAMH,EAAM,OAASC,EAAMG,SAOxC,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,WAAA,EAAA,QAAA,YAAA,EAFA,IAAIC,EAAS,GAEb,QAAA,OAAA,EAAAA,EAAOC,SAAW,SAASN,GACvBK,EAAOL,GAAOD,EAAWC;;ACgQ7B,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,UAAA,EAvQA,IAAA,EAAA,QAAA,6BAGIO,GAAe,EAEfC,EAAO,GAkQX,QAAA,KAAA,EAhQAA,EAAKC,UAAY,SAASC,GACtBH,EAAeG,GAGnBF,EAAKG,IAAM,SAASX,GACZO,GAAAA,EAAc,CACrBL,QAAQC,IAAI,MAAQH,EAAM,OACrB,IAAA,IAAIY,EAAI,EAAIA,GAAjB,UAAA,QAAA,EAAA,EAAA,UAAA,OAAA,GAAkCA,IAC9BV,QAAQC,IAAQS,EAAAA,EAAAA,GAAAA,UAAAA,QAAAA,EAAAA,OAAAA,EAAAA,UAAAA,EAAhB,IAEJV,QAAQC,IAAI,MAAQH,EAAM,SAI3BK,EAAOC,OAAAA,SAAS,OAEhBE,EAAKK,MAAQ,SAASC,GACdP,GACAI,EAAAA,OAAAA,IAAIG,IAMZN,EAAKO,IAAM,SAASC,GAEX,IADDC,IAAAA,EAAM,EACDL,EAAI,EAAGA,EAAII,EAAIE,OAAQN,IACnCK,GAAOD,EAAIJ,GAEDK,OAAAA,EAAID,EAAIE,QAGnBV,EAAKW,KAAO,SAASC,EAAKC,GAEjB,IADDC,IAAAA,EAAMC,MAAMF,GAAKG,KAAK,GACjBZ,EAAG,EAAEA,EAAES,EAAKT,IACxBU,EAAIV,GAAKQ,EAAKR,GAEJU,OAAAA,GAGXd,EAAKiB,SAAW,SAAST,EAAIU,GAClBV,OAAAA,EAAIW,IAAK,SAAAC,GAAKA,OAAAA,EAAGF,KAG5BlB,EAAKqB,KAAO,SAASC,GACbC,IACAC,EAAUT,MADE,KACeC,KAAK,GAC/BZ,IAAAA,EAAI,EAAIA,EAFG,IAEaA,IAAM,CAClCqB,IAAAA,EAAKC,YAAYC,MAEjBC,GADSN,IACJI,YAAYC,OACrBH,EAAQpB,GAAKwB,EAAKH,EAERlB,OAAAA,IAAIiB,IAGfxB,EAAK6B,MAAQ,SAASC,EAAE5B,GAGf,IAFD6B,IAAAA,EAAM7B,EAAI4B,EACVhB,EAAMC,MAAMgB,GAAKf,KAAK,GACjBZ,EAAI,EAAIA,EAAG2B,EAAM3B,IAC7BU,EAAIV,GAAK0B,EAAI1B,EAEHU,OAAAA,GAIXd,EAAKgC,MAAQ,SAASC,GACXA,OAAAA,EAAE,IAIbjC,EAAKkC,KAAO,SAASD,GACVA,OAAAA,EAAEA,EAAEvB,OAAS,IAIxBV,EAAKmC,IAAM,SAASC,EAAGC,GACRD,OAAAA,EAAGjB,IAAI,SAASD,EAAEd,GACrB,MAAA,CAACc,EAAGmB,EAAGjC,OAInBJ,EAAKsC,WAAa,SAASL,GACnBnB,IAAAA,EAAM,GACL,IAAA,IAAIyB,KAAKN,EACjBnB,EAAI0B,KAAK,CAAED,EAAGN,EAAEM,KAENzB,OAAAA,GAGXd,EAAKyC,eAAiB,SAASR,GACvBS,IAAAA,EAAMC,OAAOV,GACbW,OAAAA,MAAMF,GACNT,EAEAS,GAIR1C,EAAK6C,MAAQ,SAASZ,EAAEX,GACf,IAAA,IAAIiB,KAAKN,EACjBA,EAAEM,GAAKjB,EAAEW,EAAEM,IAEDN,OAAAA,GAGXjC,EAAK8C,gBAAkB,SAASb,GACrBjC,OAAAA,EAAK6C,MAAMZ,EAAEQ,iBAIxBzC,EAAK+C,KAAO,SAASd,GAEZ,IADDe,IAAAA,EAAMjC,MAAMkB,EAAEvB,OAAS,GAAGM,KAAK,GAC1BZ,EAAI,EAAIA,EAAI6B,EAAEvB,OAASN,IACnC4C,EAAE5C,EAAE,GAAK6B,EAAE7B,GAAK6B,EAAE7B,EAAE,GAEV4C,OAAAA,GAIXhD,EAAKiD,IAAM,SAAShB,GAGX,IAFDiB,IAAAA,EAAWjB,EAAE,GAER7B,EAAE,EAAEA,EAAE6B,EAAEvB,OAAON,IACvB6B,EAAE7B,GAAK8C,IAAYA,EAAWjB,EAAE7B,IAG1B8C,OAAAA,GAIXlD,EAAKmD,IAAM,SAASlB,GAGX,IAFDmB,IAAAA,EAAWnB,EAAE,GAER7B,EAAE,EAAEA,EAAE6B,EAAEvB,OAAON,IACvB6B,EAAE7B,GAAKgD,IAAYA,EAAWnB,EAAE7B,IAG1BgD,OAAAA,GAWXpD,EAAKqD,IAAM,SAASC,GACTC,OAAAA,SAASC,cAAcF,IAGlCtD,EAAKyD,eAAiB,SAASxB,EAAEyB,GACzBA,aAAiBC,YACxB1B,EAAE2B,YAAYF,GAEdzB,EAAE4B,UAAYH,GAKf1D,EAAK8D,SAAW,SAASjD,EAAIkD,EAAQzC,GAC7B0C,IAAAA,EAAW5D,EAKVA,KAHL4D,EAAYhE,EAAKqD,IAAI,QACXY,UAAY,WAEjB7D,EAAG,EAAIA,EAAIS,EAAMT,IAAO,CAC5B6B,IAAAA,EAAIjC,EAAKqD,IAAI,OACba,EAAO5C,EAAElB,EAAE6B,GACXiC,GACAlE,EAAKyD,eAAexB,EAAGiC,GAE3BF,EAAUJ,YAAY3B,GAGZ+B,OAAAA,GASXhE,EAAKmE,eAAiB,SAASC,EAAEC,EAAEN,EAAQzC,GACnC0C,IAAAA,EAAW5D,EASVA,KAPL4D,EAAYhE,EAAKqD,IAAI,QACXY,UAAY,cACtBD,EAAUM,GAAKP,EAEfC,EAAUO,MAAQ,+BAGbnE,EAAG,EAAIA,EAAIgE,EAAIhE,IAAO,CAK1BoE,IAIAC,EAAcV,EAAU,IAAO3D,EAAI,IACnCsE,EAAM1E,EAAK8D,SAASO,EAAEI,EALjB,SAASE,EAAIC,GACXtD,OAAAA,EAAElB,EAAEuE,EAAIC,KAKnBZ,EAAUJ,YAAYc,GAGZV,OAAAA,GAKXhE,EAAK6E,YAAc,SAAST,EAAEC,EAAES,GACrBA,OAAAA,EAAEV,EAAIC,GAGjBrE,EAAK+E,eAAiB,SAASX,EAAEC,GAKtBrE,OAAAA,EAAKmE,eAAeC,EAAEC,EAAE,MAJvB,SAASrB,EAAE8B,EAAEF,GAChB5E,OAAAA,EAAK6E,YAAY7B,EAAE8B,EAAET,GAAIW,cAQlChF,EAAKiF,UAAY,WAENC,IADHA,IAAAA,EAAM3B,SAAS4B,eAAe,OAC3BD,EAAIE,YACdF,EAAIG,YAAYH,EAAIE,aAIrBpF,EAAKsF,WAAa,SAASV,GACvB5E,EAAKiF,YACK1B,SAAS4B,eAAe,OAC9BvB,YAAYgB,IAIpB,IAAIW,EAAS,CAAC,QAAU,OAAS,MAAQ,QAAU,SAAW,UAE9DvF,EAAKwF,WAAa,SAAS3E,GAChBb,OAAAA,EAAKW,KAAK4E,EAAQ1E;;ACvLxB,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EAxEL,IAAA,EAAA,QAAA,eACA,EAAA,EAAA,QAAA,iCAuEK,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAAA,SAAA,EAAA,EAAA,GAAA,KAAA,aAAA,GAAA,MAAA,IAAA,UAAA,qCAAA,SAAA,EAAA,EAAA,GAAA,IAAA,IAAA,EAAA,EAAA,EAAA,EAAA,OAAA,IAAA,CAAA,IAAA,EAAA,EAAA,GAAA,EAAA,WAAA,EAAA,aAAA,EAAA,EAAA,cAAA,EAAA,UAAA,IAAA,EAAA,UAAA,GAAA,OAAA,eAAA,EAAA,EAAA,IAAA,IAAA,SAAA,EAAA,EAAA,EAAA,GAAA,OAAA,GAAA,EAAA,EAAA,UAAA,GAAA,GAAA,EAAA,EAAA,GAAA,EAhEgB4E,IAAAA,EAgEhB,WA9DWC,SAAAA,EAAAA,GAAK,EAAA,KAAA,GACfA,KAAAA,IAAMA,EACNC,KAAAA,WAAa,KACbhG,KAAAA,KAAM,EAAW,EAAA,YAAA,MACjBiG,KAAAA,gBAAkB,SAASC,GACvBlG,KAAAA,IAAI,sCAERmG,KAAAA,aAAe,KAAKF,gBAuDrB,OAAA,EAAA,EAAA,CAAA,CAAA,IAAA,UA/CS,MAAA,WACTG,IAAAA,EAAQ,IAAIC,UAAU,KAAKN,KAE/BK,EAAKE,iBAAiB,OAAS,SAAUC,GAChCvG,KAAAA,IAAI,iBAAmB,KAAK+F,IAAM,gDAClCS,KAAAA,UAAU,CAACC,KAAM,WAAaP,KAAO,WACrCM,KAAAA,UAAU,CAACC,KAAM,UAAaP,KAAO,WAC3CQ,KAAK,OAIRN,EAAKE,iBAAiB,UAAY,SAAUC,GAEnCJ,KAAAA,aAAa9F,EAAK8C,QAAAA,gBAAgBwD,KAAKC,MAAML,EAAML,SACzDQ,KAAK,OAEHV,KAAAA,WAAaI,IA+Bd,CAAA,IAAA,eAzBc,MAAA,WACbI,KAAAA,UAAU,CAACC,KAAO,UAAYP,KAAO,YAwBtC,CAAA,IAAA,cAlBa,MAAA,WACZM,KAAAA,UAAU,CAACC,KAAO,UAAYP,KAAO,WAiBtC,CAAA,IAAA,mBAVgBW,MAAAA,SAAAA,GACfV,KAAAA,aAAeU,IAShB,CAAA,IAAA,YAFSC,MAAAA,SAAAA,GACRd,KAAAA,WAAWe,KAAKJ,KAAKK,UAAUF,QAChC,EAAA,GAAA,QAAA,QAAA;;ACuKJ,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EA/OD,IAAA,EAAA,QAAA,eACA,EAAA,EAAA,QAAA,iCA8OC,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAAA,SAAA,EAAA,EAAA,GAAA,KAAA,aAAA,GAAA,MAAA,IAAA,UAAA,qCAAA,SAAA,EAAA,EAAA,GAAA,IAAA,IAAA,EAAA,EAAA,EAAA,EAAA,OAAA,IAAA,CAAA,IAAA,EAAA,EAAA,GAAA,EAAA,WAAA,EAAA,aAAA,EAAA,EAAA,cAAA,EAAA,UAAA,IAAA,EAAA,UAAA,GAAA,OAAA,eAAA,EAAA,EAAA,IAAA,IAAA,SAAA,EAAA,EAAA,EAAA,GAAA,OAAA,GAAA,EAAA,EAAA,UAAA,GAAA,GAAA,EAAA,EAAA,GAAA,EAvOoBG,IAAAA,EAuOpB,WAjOeC,SAAAA,EAAAA,GAAM,EAAA,KAAA,GAChBC,KAAAA,WAAaD,IAAS,IAAIE,MAAQC,cAClCC,KAAAA,aAAe,GACfC,KAAAA,aAAe,EACfC,KAAAA,iBAAmB,KACnBC,KAAAA,eAAiB,KAEjBzH,KAAAA,KAAM,EAAW,EAAA,YAAA,MACjBiG,KAAAA,gBAAkB,SAASC,GACvBlG,KAAAA,IAAI,sCAERmG,KAAAA,aAAe,KAAKF,gBACpByB,KAAAA,aAAe,EAqNpB,OAAA,EAAA,EAAA,CAAA,CAAA,IAAA,aA/MgB,MAAA,WACZC,IAAAA,EAAUhB,KAAKK,UAAU,KAAKM,cAClCJ,KAAU,KAAKC,WAAa,QAAU,KAAKI,aAAalC,WACnDiC,KAAAA,aAAe,GACpBM,aAAaC,QAAQX,KAAMS,GACtBJ,KAAAA,cAAgB,EAChBvH,KAAAA,IAAI,qBAAuBkH,QAyMhC,CAAA,IAAA,eAlMgBY,MAAAA,SAAAA,GACXN,KAAAA,iBAAmBO,YAAe,WAAgBC,KAAAA,cAAetB,KAAK,MAAa,IAALoB,GAC9E9H,KAAAA,IAAI,+BAAiC,KAAKmH,cAgM/C,CAAA,IAAA,cA1LiB,MAAA,WACjBc,cAAc,KAAKT,kBACdxH,KAAAA,IAAI,+BAAiC,KAAKmH,cAwL/C,CAAA,IAAA,eAjLgBL,MAAAA,SAAAA,GACXQ,KAAAA,aAAazE,KAAKiE,KAgLvB,CAAA,IAAA,eA1KkB,MAAA,WACb9G,KAAAA,IAAI,sBACJyH,KAAAA,eAAiBS,EAAY,KAAKf,YAClCO,KAAAA,aAAe,EACfS,KAAAA,YAAc,KAAKV,eAAe1G,OAClCqH,KAAAA,WAAY,EACZC,KAAAA,iBACAC,KAAAA,MAAQjI,EAAK+C,QAAAA,KAAM,KAAKqE,eAAejG,IAAK,SAAAc,GAAKA,OAAAA,EAAC,QAClDtC,KAAAA,IAAI,mBAAqB,KAAKmH,cAkKnC,CAAA,IAAA,mBA1JoBxF,MAAAA,SAAAA,GACfwE,KAAAA,aAAexE,IAyJpB,CAAA,IAAA,eAnJkB,MAAA,WACb+F,KAAAA,aAAgB,EAChBU,KAAAA,WAAY,EACZG,KAAAA,sBAgJL,CAAA,IAAA,uBA1I0B,MAAA,WACtB,GAAA,KAAKb,aAAe,KAAKS,YAAe,CAEpCpF,IAAAA,EAAM,KAAK0E,eAAe,KAAKC,cAK5B3E,OAHFoD,KAAAA,aAAapD,GAEb2E,KAAAA,cAAgB,EACd3E,EAEFyF,KAAAA,gBAgIT,CAAA,IAAA,oBAtHuB,MAAA,WAEnB,GAAA,KAAKJ,UAAW,CAEZrF,IAAAA,EAAM,KAAK0E,eAAe,KAAKC,cAI/B,GAFCvB,KAAAA,aAAapD,GAEd,KAAK2E,cAAgB,KAAKS,YAAc,EAI1CK,KAAAA,kBAEK,CAGNC,IAAAA,EAAQ,KAAKH,MAAM,KAAKZ,cAEvBA,KAAAA,cAAgB,EAErBgB,WAAa,WAAiBH,KAAAA,qBAAsB7B,KAAK,MAAQ+B,OAiGlE,CAAA,IAAA,iBAtFoB,MAAA,WAEhB,GADCzI,KAAAA,IAAI,sBACJ,KAAKyH,eAAe1G,OACf,KAAA,0BAGF4H,IAAAA,EAAOtI,EAAKgC,QAAAA,MAAM,KAAKoF,gBAAhB,KAENA,KAAAA,eAAejG,IAAK,SAASc,GAE9BA,OADPA,EAAC,KAAWA,EAAC,KAAWqG,EACjBrG,IAECtC,KAAAA,IAAI,UA0Eb,CAAA,IAAA,cAhEiB,MAAA,WACZoI,KAAAA,WAAY,EACZV,KAAAA,aAAgB,EAChB1H,KAAAA,IAAI,sBA6DT,CAAA,IAAA,SArDUkH,MAAAA,SAAAA,GACLlH,KAAAA,IAAI,0BAA4B,KAAKmH,YACtCyB,IAAAA,EAAa,+BAGbC,EAAOC,OAAOD,KAAK,KAAKpB,eAAe,IAAIsB,OAG/CH,GAAgBC,EAAK5I,KAAK,KAAO,KAG5B,IAAA,IAAIQ,EAAG,EAAIA,EAAI,KAAKgH,eAAe1G,OAASN,IAAM,CAC/CyF,IAAAA,EAAO,KAAKuB,eAAehH,GAC3ByF,GAAY,KAAZA,EAAK8C,IAAa,CAGpB,IAFDC,IAAAA,EAAc,GAETrG,EAAI,EAAIA,EAAIiG,EAAK9H,OAAS6B,IAAO,CAClCsG,IAAAA,EAAML,EAAKjG,GACLsD,EAAKgD,GACfD,EAAYpG,KAAKqD,EAAKgD,IAE1BN,GAAeK,EAAYhJ,KAAK,KAAO,MAIpCkJ,IAAAA,EAAaC,UAAUR,GACvBS,EAAOzF,SAASC,cAAc,KAClCwF,EAAKC,aAAa,OAAQH,GAC1BE,EAAKC,aAAa,YAAapC,GAAQ,KAAKC,YAAgB,QAC5DkC,EAAKE,YAwBL,EAAA,GAbD,SAASC,EAAuB7E,GACrBmE,OAAAA,OAAOD,KAAKjB,cAAc6B,OAAQ,SAAA9F,GAAKA,OAAAA,EAAE+F,SAAS/E,KAAMoE,OAGnE,SAASb,EAAYvD,GACbgF,IAAAA,EAAcH,EAAuB7E,GAOlCiF,OALPC,IAAMF,EAAYnI,IAAK,SAAS0F,GAC5BP,OAAAA,KAAKC,MAAMgB,aAAakC,QAAQ5C,MAGvB,GAAG6C,OAAOC,MAAM,GAAIH,KAEpC,QAAA,QAAA;;AChNI,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EA/BL,IAAA,EAAA,QAAA,eA+BK,SAAA,EAAA,EAAA,GAAA,KAAA,aAAA,GAAA,MAAA,IAAA,UAAA,qCAAA,SAAA,EAAA,EAAA,GAAA,IAAA,IAAA,EAAA,EAAA,EAAA,EAAA,OAAA,IAAA,CAAA,IAAA,EAAA,EAAA,GAAA,EAAA,WAAA,EAAA,aAAA,EAAA,EAAA,cAAA,EAAA,UAAA,IAAA,EAAA,UAAA,GAAA,OAAA,eAAA,EAAA,EAAA,IAAA,IAAA,SAAA,EAAA,EAAA,EAAA,GAAA,OAAA,GAAA,EAAA,EAAA,UAAA,GAAA,GAAA,EAAA,EAAA,GAAA,EAzBgBI,IAAAA,EAyBhB,WAvBa,SAAA,IAAA,EAAA,KAAA,GACZjK,KAAAA,KAAM,EAAW,EAAA,YAAA,MAsBlB,OAAA,EAAA,EAAA,CAAA,CAAA,IAAA,UAZOkK,MAAAA,SAAAA,EAAMC,GACjBD,EAAKE,iBAAoB,SAAS9H,GAAI6H,EAAGE,aAAa/H,IAAKoE,KAAKyD,MAW5D,CAAA,IAAA,aAFUD,MAAAA,SAAAA,EAAMC,GACpBD,EAAKE,iBAAiBF,EAAKjE,qBACvB,EAAA,GAAA,QAAA,QAAA;;ACmDJ,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EAlFD,IAAA,EAAA,QAAA,eACA,EAAA,EAAA,QAAA,iCAiFC,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAAA,SAAA,EAAA,EAAA,GAAA,KAAA,aAAA,GAAA,MAAA,IAAA,UAAA,qCAAA,SAAA,EAAA,EAAA,GAAA,IAAA,IAAA,EAAA,EAAA,EAAA,EAAA,OAAA,IAAA,CAAA,IAAA,EAAA,EAAA,GAAA,EAAA,WAAA,EAAA,aAAA,EAAA,EAAA,cAAA,EAAA,UAAA,IAAA,EAAA,UAAA,GAAA,OAAA,eAAA,EAAA,EAAA,IAAA,IAAA,SAAA,EAAA,EAAA,EAAA,GAAA,OAAA,GAAA,EAAA,EAAA,UAAA,GAAA,GAAA,EAAA,EAAA,GAAA,EA1EoBqE,IAAAA,EA0EpB,WApEiB,SAAA,IAAA,EAAA,KAAA,GACZhD,KAAAA,aAAiB,GACjBtH,KAAAA,KAAM,EAAW,EAAA,YAAA,MAkEtB,OAAA,EAAA,EAAA,CAAA,CAAA,IAAA,eA3DgB8G,MAAAA,SAAAA,GACXQ,KAAAA,aAAazE,KAAKiE,GAClB9G,KAAAA,IAAI,oBAyDT,CAAA,IAAA,iBAnDoB,MAAA,WAChBuK,IACAC,EAASC,EADK,KAAKnD,cAIhBkD,OAFFxK,KAAAA,IAAI,qBACJA,KAAAA,IAAI2G,KAAKK,UAAUwD,IACjBA,IA8CP,CAAA,IAAA,aAxCc7I,MAAAA,SAAAA,GAGVuE,IAAAA,EAAO,KAAKoB,aAAa9F,IAAK,SAAAkJ,GAAKA,OAAAA,EAAE/I,KAEzCgJ,OAAOzE,EAAK,qBAAuBvE,KAmCnC,CAAA,IAAA,aA5BcA,MAAAA,SAAAA,GACVuE,IAAAA,EAAO,KAAKoB,aAAa9F,IAAK,SAAAkJ,GAAKA,OAAAA,EAAE/I,KACzCiJ,OAAO1E,EAAK,oBAAsBvE,OA0BlC,EAAA,GAjBD,SAASkJ,EAAkBC,EAAUnJ,GACzBoJ,OAAAA,MAAMnK,IAAIkK,EAAUtJ,IAAK,SAAAsF,GAAOA,OAAAA,EAAInF,MAMhD,SAAS8I,EAAWF,GACT,MAAA,CACQA,IAAAA,EAAYxJ,OACZ8J,UAAAA,EAAkBN,EAAa,SAC/BM,UAAAA,EAAkBN,EAAa,SAC/BM,UAAAA,EAAkBN,EAAa,SAC/BM,UAAAA,EAAkBN,EAAa,SAC/BM,UAAAA,EAAkBN,EAAa,SAC/BM,UAAAA,EAAkBN,EAAa,UAEjD,QAAA,QAAA;;ACjFD,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,YAAA,EAAA,IAAIS,EACA,CACHC,aAAe,KAFhB,QAAA,OAAA;;ACiPK,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EApPL,IAAA,EAAA,QAAA,wCACA,EAAA,QAAA,gCAmPK,SAAA,EAAA,EAAA,GAAA,OAAA,EAAA,IAAA,EAAA,EAAA,IAAA,IAAA,SAAA,IAAA,MAAA,IAAA,UAAA,wDAAA,SAAA,EAAA,EAAA,GAAA,IAAA,EAAA,GAAA,GAAA,EAAA,GAAA,EAAA,OAAA,EAAA,IAAA,IAAA,IAAA,EAAA,EAAA,EAAA,OAAA,cAAA,GAAA,EAAA,EAAA,QAAA,QAAA,EAAA,KAAA,EAAA,QAAA,GAAA,EAAA,SAAA,GAAA,GAAA,IAAA,MAAA,GAAA,GAAA,EAAA,EAAA,EAAA,QAAA,IAAA,GAAA,MAAA,EAAA,QAAA,EAAA,SAAA,QAAA,GAAA,EAAA,MAAA,GAAA,OAAA,EAAA,SAAA,EAAA,GAAA,GAAA,MAAA,QAAA,GAAA,OAAA,EAAA,SAAA,EAAA,EAAA,GAAA,KAAA,aAAA,GAAA,MAAA,IAAA,UAAA,qCAAA,SAAA,EAAA,EAAA,GAAA,IAAA,IAAA,EAAA,EAAA,EAAA,EAAA,OAAA,IAAA,CAAA,IAAA,EAAA,EAAA,GAAA,EAAA,WAAA,EAAA,aAAA,EAAA,EAAA,cAAA,EAAA,UAAA,IAAA,EAAA,UAAA,GAAA,OAAA,eAAA,EAAA,EAAA,IAAA,IAAA,SAAA,EAAA,EAAA,EAAA,GAAA,OAAA,GAAA,EAAA,EAAA,UAAA,GAAA,GAAA,EAAA,EAAA,GAAA,EAhPL,IAAIC,EAAMC,MAAMC,SAGhB,SAASC,EAAcjJ,GACZhB,OAAAA,MAAMgB,GAAKf,KAAK,GAG3B,SAASiK,EAAclJ,GACZ/B,OAAAA,EAAK6B,KAAAA,OAAOE,EAAK,GAAGZ,IAAK,SAAAD,GAAKA,OAAAA,EAAE,MAI3C,SAASgK,EAAwBC,GAOxB,IANCC,IAAAA,EAAgCD,EAAhCC,MAAOC,EAAyBF,EAAzBE,aAAcC,EAAWH,EAAXG,MACvBC,EAAaF,EAAa3K,OAG1B0B,EAAK,GACLC,EAAK,GACAjC,EAAG,EAAGA,EAAImL,EAAanL,IACnCgC,EAAGI,KAAKyI,EAAcG,IACtB/I,EAAGG,KAAKwI,EAAcI,IAIfI,IAAAA,EAAS,IAAIV,MAAMW,iBAAkB,CAC5C5F,KAAO,CAACzD,GAAKA,EAAIC,GAAKA,KASfqJ,EAAIb,EAAIc,OAAO,CAAEL,MAAOA,EAAOM,MALvB,+CAKsCC,YAAc,iBAI5DC,EAAQJ,EAAEK,WAAW,CAAEC,MAAO,MAAQ,CAAEA,MAAO,MAAQ,CAC9DR,OAAQA,EACRS,WAAYjM,EAAKwF,KAAAA,WAAW+F,KAMlB,MAAA,CAAEW,KAAOR,EAAII,MAAQA,EAAQN,OAASA,GAQjD,IAAIW,EAAqB,SAASC,EAAIlL,EAAGmB,GAMjC,IALAwD,IAAAA,EAAOuG,EAAGvG,KACVwG,EAAMxG,EAAKzD,GACXkK,EAAMzG,EAAKxD,GAGPjC,EAAE,EAAEA,EAAEkM,EAAI5L,OAAON,IAMxBiC,EAAGjC,KAEHiM,EAAIjM,GAAGoC,KAAKtB,GACZmL,EAAIjM,GAAGmM,QAGPD,EAAIlM,GAAGoC,KAAKH,EAAGjC,IACfkM,EAAIlM,GAAGmM,SAWDH,OANPvG,EAAKzD,GAAKiK,EACVxG,EAAKxD,GAAKiK,EACVF,EAAGI,KAAK,OAAQ3G,EAAM,CAClB4G,QAAQ,IAGLL,EAAGM,QAAQ,WAShBC,EAkJD,WAjJWxB,SAAAA,EAAAA,GAAM,EAAA,KAAA,GAChByB,IAAAA,EAAyBzB,EAAzByB,cAAetB,EAAUH,EAAVG,MACfuB,KAAAA,OAAS,KACTD,KAAAA,cAAgBA,EAGjBE,IAI2B5B,EAAAA,EAJd,CAAEE,MAAQT,EAAOC,OAAAA,aAC7BU,MAAQA,EACRD,aAAeuB,IAEdV,EAAAA,EAAAA,KAAOJ,EAAAA,EAAAA,MAAQN,EAAAA,EAAAA,OAIrBU,EAAKa,sBAFO,UAGZb,EAAKc,sBAFO,GAIZd,EAAKe,kBALO,UAMZf,EAAKgB,kBALO,GAOPC,KAAAA,iBAAmBjB,EACnBV,KAAAA,OAASA,EACTM,KAAAA,MAASA,EA2HV,OAAA,EAAA,EAAA,CAAA,CAAA,IAAA,kBAvHiB,MAAA,WACd,OAAA,KAAKN,SAsHR,CAAA,IAAA,sBAnHmB5G,MAAAA,SAAAA,GAGvBiG,EAAIuC,KAAK,KAAKD,iBAAkBvI,OAgH5B,EAAA,GA1GgByI,EA0GhB,WApGWR,SAAAA,EAAAA,GAAQ,EAAA,KAAA,GAClBS,KAAAA,OAAS,GACTT,KAAAA,OAASA,EACTU,KAAAA,mBAAqB,GAiGtB,OAAA,EAAA,EAAA,CAAA,CAAA,IAAA,YAzFSjJ,MAAAA,SAAAA,EAAIsI,GACbY,IAAAA,EAAQ,IAAIb,EAAO,CAACC,cAAgBA,EACrCtB,MAAShH,EAAK,KAAOsI,EAAchN,KAAK,QAEtC0N,KAAAA,OAAOhJ,GAAMkJ,IAqFd,CAAA,IAAA,OA7EM,MAAA,WAGNC,IAAAA,EAAczN,EAAKsC,KAAAA,WAAW,KAAKgL,QAClCG,KAAAA,YAAcA,EAGfC,IAAAA,EAAS,EACTC,EAASC,KAAKC,KAAKpF,OAAOD,KAAK,KAAK8E,QAAQ5M,OAAO,GAG7B,GAAtB+M,EAAY/M,SACZgN,EAASC,EAAS,GAGjBxN,EAAAA,KAAAA,IAAI,QAAUwN,GAGfG,IAAAA,EAAS9N,EAAKmE,KAAAA,eAAewJ,EAAOD,EAAO,OAAO,SAAS1K,EAAE8B,EAAEF,GAE3DmJ,IAAAA,EAAQ/N,EAAK6E,KAAAA,YAAY7B,EAAE8B,EAAE4I,GAG7BK,KAAAA,EAAQN,EAAY/M,QAMpB,MAAA,GAJY+M,IAAAA,EAAAA,EAAAA,EAAYM,GAFK,GAAA,EAAA,GAAA,EAAA,GAG9BC,oBAAoBpJ,KAUtBU,EAAAA,KAAAA,WAAWwI,KAyCZ,CAAA,IAAA,kBAhCexJ,MAAAA,SAAAA,EAAKpD,EAAImB,GAC5B8J,EAAmB,KAAKmB,OAAOhJ,GAAI2J,kBAAmB/M,EAAImB,KA+BtD,CAAA,IAAA,uBAxBoBnB,MAAAA,SAAAA,EAAEgN,GAIrB,IAAA,IAAIV,KAAS,KAAKF,OAAS,CACxBa,IAAAA,EAAQ9L,EAAKjC,EAAIsC,EAKhBtC,IAHL+N,EAAS,KAAKb,OAAOE,GAAOZ,cAE5BvK,EAAKtB,MAAMoN,EAAOzN,QAAQM,KAAK,GAC1BZ,EAAI,EAAIA,EAAI+N,EAAOzN,OAASN,IAEpCsC,EAAOwL,EAAeC,EAAO/N,IAG7BiC,EAAGjC,GAAKsC,EAILyJ,EAAmB,KAAKmB,OAAOE,GAAOS,kBAAmB/M,EAAImB,QAK7D,EAAA,GAAA,QAAA,QAAA;;AC8CJ,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,aAAA,EA/RD,IAAA,EAAA,QAAA,eACA,EAAA,EAAA,QAAA,YA8RC,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAAA,SAAA,EAAA,EAAA,GAAA,KAAA,aAAA,GAAA,MAAA,IAAA,UAAA,qCAAA,SAAA,EAAA,EAAA,GAAA,IAAA,IAAA,EAAA,EAAA,EAAA,EAAA,OAAA,IAAA,CAAA,IAAA,EAAA,EAAA,GAAA,EAAA,WAAA,EAAA,aAAA,EAAA,EAAA,cAAA,EAAA,UAAA,IAAA,EAAA,UAAA,GAAA,OAAA,eAAA,EAAA,EAAA,IAAA,IAAA,SAAA,EAAA,EAAA,EAAA,GAAA,OAAA,GAAA,EAAA,EAAA,UAAA,GAAA,GAAA,EAAA,EAAA,GAAA,EAvRoB+L,IAAAA,EAuRpB,WAjRejD,SAAAA,EAAAA,GAAM,EAAA,KAAA,GAChBrD,IAAAA,EAAqCqD,EAArCrD,YAAauG,EAAwBlD,EAAxBkD,SAAUC,EAAcnD,EAAdmD,WACvB3O,KAAAA,KAAM,EAAW,EAAA,YAAA,MACjBmI,KAAAA,YAAcA,EACdyG,KAAAA,mBAAqBzG,EACrB0G,KAAAA,OAASzN,MAAM+G,GAAa9G,KAAKyN,GACjCC,KAAAA,QAAU,GACVC,KAAAA,cAAgB,GAChBC,KAAAA,oBAAsB,GACtBC,KAAAA,MAAS,GACTR,KAAAA,SAAWA,EACXC,KAAAA,WAAaA,IAAc,EAC5BD,IAEKS,KAAAA,mBAAqB,GAErBC,KAAAA,WAAa,KAGb1B,KAAAA,GAAK,IAAIA,EAAJ,QAAO,OA8PrB,OAAA,EAAA,EAAA,CAAA,CAAA,IAAA,aArPc2B,MAAAA,SAAAA,GACTH,KAAAA,MAAQG,IAoPb,CAAA,IAAA,iCA5OkCvI,MAAAA,SAAAA,GAC7B+H,KAAAA,OAAOhM,KAAKiE,GACZ+H,KAAAA,OAAOjC,UA0OZ,CAAA,IAAA,aAnOcpB,MAAAA,SAAAA,GACV7G,IAAAA,EAAGhD,EACPgD,EAAK6G,EAAK7G,GAAKhD,EAAI6J,EAAK7J,EAEnBoN,KAAAA,QAAQpK,GAAM,GAEdoK,KAAAA,QAAQpK,GAAb,SAA+BhD,EAE1BoN,KAAAA,QAAQpK,GAAb,OAA6BvD,MAAM,KAAKwN,oBAAoBvN,KAAKiO,KAC7D,KAAKX,YACA3O,KAAAA,IAAI,iBAAmB2E,KAyNhC,CAAA,IAAA,WA/MYyK,MAAAA,SAAAA,GAGP,IAAA,IAAIvB,KAFJuB,KAAAA,WAAaA,EAEA,KAAKA,WAAc,CAC7BL,IAAAA,EAAU,KAAKK,WAAWvB,GACzBH,KAAAA,GAAG6B,UAAU1B,EAAOkB,GAIxBrB,KAAAA,GAAG8B,SAsMR,CAAA,IAAA,aA5Lc7K,MAAAA,SAAAA,GACVkK,IAAAA,EAAS,KAAKA,OAId9L,GAAMpB,EAFF,KAAKoN,QAAQpK,GAAb,UAEIkK,GAmBL9L,OANHA,IAEKgM,KAAAA,QAAQpK,GAAb,OAA2B9B,KAAKE,GAC3BgM,KAAAA,QAAQpK,GAAb,OAA2BiI,SAGxB7J,IAoKP,CAAA,IAAA,oBA3JqB4B,MAAAA,SAAAA,EAAGzD,GACjB,OAAA,KAAK6N,QAAQpK,GAAb,OAA2B8K,MAAM,KAAKtH,YAAcjH,KA0J3D,CAAA,IAAA,oBAAA,MAAA,SAAA,GAAA,SAAA,EAAA,GAAA,OAAA,EAAA,MAAA,KAAA,WAAA,OAAA,EAAA,SAAA,WAAA,OAAA,EAAA,YAAA,EAAA,CAlJqByD,SAAAA,GACd+K,OAAAA,kBAAkB/K,EAAI,MAiJ7B,CAAA,IAAA,mBAzIoBA,MAAAA,SAAAA,EAAGgL,GAEnB,IAAGA,EAAaC,WAAYD,EAAaE,WACnC,KAAA,qEAILb,KAAAA,cAAcrK,GAAMgL,EAGrBA,EAAaG,QACRb,KAAAA,oBAAoBU,EAAaG,QAAS,GAG/C,KAAKnB,YACA3O,KAAAA,IAAI,uBAAyB2E,KA0HtC,CAAA,IAAA,mBAjHoBA,MAAAA,SAAAA,GAEhBgL,IAAAA,EAAe,KAAKX,cAAcrK,GAGlCmL,EAAQH,EAAaG,MACrBC,EAAe,KAAKd,oBAAoBa,GAGvCC,GAAgB,GAAhBA,EAAwB,CAGrBH,IAAAA,EAAWD,EAAaC,SACxBC,EAAaF,EAAaE,WAK1BD,EAAS,OACZ,KAAKjB,YAAmB3O,KAAAA,IAAI,cAAgB2E,GAChDkL,EAAW,MAEPE,IACKd,KAAAA,oBAAoBa,IAAS,IAGlC,KAAKnB,YAAmB3O,KAAAA,IAAI,aAAe2E,MAuFhD,CAAA,IAAA,eA3EgBmC,MAAAA,SAAAA,GAMX,IAAA,IAAIkJ,KAHJC,KAAAA,+BAA+BnJ,GAGd,KAAKiI,QAAU,CAC7BhM,IAAAA,EAAM,KAAKmN,WAAWF,GACtB,KAAKtB,WACPS,KAAAA,mBAAmBa,GAAajN,GAMjC,IAAA,IAAIoN,KAAmB,KAAKnB,cACxBoB,KAAAA,iBAAiBD,GAKrB,IAAA,IAAIL,KAAS,KAAKb,oBACdA,KAAAA,oBAAoBa,IAAS,EAOlC,KAAKpB,UAGAhB,KAAAA,GAAG2C,qBAAqBvJ,EAAIwJ,KAAK,KAAKnB,sBA2C/C,CAAA,IAAA,kBAlCqB,MAAA,WAChB9E,KAAAA,aAAakG,SAiClB,EAAA,GAAA,QAAA,QAAA,EAzBD,IAAIzB,EAAmB,CACT,MAAA,EACA,MAAA,EACA,MAAA,EACA,MAAA,EACA,MAAA,EACA,MAAA,EACA,OAAA,EACA,KAAA,EACA,IAAA,KAKVrK,EAAIwJ,KAAKuC,OACTC,EAAQ,EACZ,SAASF,IACE,MAAA,CAAW9L,MAAAA,IACPA,MAAAA,IACAA,MAAAA,IACAA,MAAAA,IACAA,MAAAA,IACAA,MAAAA,IACAgM,OAAAA,IACA,IAAA;;ACvRR,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,UAAA,EAPP,IAAA,EAAA,EAAA,QAAA,iCACA,EAAA,EAAA,QAAA,mCACA,EAAA,EAAA,QAAA,mCACA,EAAA,EAAA,QAAA,mCACA,EAAA,EAAA,QAAA,oCACA,EAAA,EAAA,QAAA,yBAEO,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAAA,IAAIC,EAAO,CAAE5K,WAAAA,EAAF,QAAcmB,aAAAA,EAAd,QAA6BgD,aAAAA,EAA7B,QAA4CK,aAAAA,EAA5C,QAA0DmE,cAAAA,EAA1D,QAAyEf,GAAAA,EAAAA,SAApF,QAAA,KAAA;;ACGP,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,WAAA,EAbA,IAAA,EAAA,QAAA,sBAGIiD,EAAQ,GAUZ,QAAA,MAAA,EAPAA,EAAMD,KAAOA,EAAb,KAIAE,OAAOD,MAAQA;;ACsDf,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,SAAA,EA5DA,IAAA,EAAA,QAAA,6BACA,EAAA,EAAA,QAAA,eA2DA,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAzDAzQ,EAAOC,OAAAA,SAAS,OAEhB,IAAI0Q,EAAM,CAAE9B,QAAU,CAAE+B,MAAQ,GAAKC,MAAQ,IACxC/B,cAAgB,IAsDrB,QAAA,IAAA,EAjDA6B,EAAI9B,QAAQ1C,MAAQ,SAASA,GAClB,OAAA,SAAS/J,GACZjC,OAAAA,EAAKkC,QAAAA,KAAKD,GAAG+J,KAKrBwE,EAAI9B,QAAQiC,WAAa,SAAS3E,GACvB,OAAA,SAAS/J,GACf2O,IAAAA,EAAI3O,EAAEvB,OACHuB,OAAAA,EAAE2O,EAAE,GAAG5E,GAAS/J,EAAE2O,EAAE,GAAG5E,KAM/BwE,EAAIK,SAAW,SAAU5O,GACdA,MAAS,KAATA,EAAE0G,KAGb6H,EAAIM,SAAW,SAAU7O,GACdA,MAAS,KAATA,EAAE0G,KAGb6H,EAAI9B,QAAQgC,MAAM1E,MAAQ,SAASA,GAExB,OAAA,SAAS+E,GAEf9O,OADJA,EAAIjC,EAAKkC,QAAAA,KAAK6O,GACD,KAAT9O,EAAE0G,IACK1G,EAAE+J,IAEJ3L,EAAAA,QAAAA,MAAM,gBACJ,KAIZmQ,EAAI7B,cAAcqC,aAAgB,CACjB,SAAA,SAAS5C,GAClB,OAACA,EAAcS,MAAMoC,OAGV,WAAA,SAAS7C,GAC3BA,EAAcS,MAAMoC,OAAQ,EACxB7C,EAAcE,YAAsBkC,EAAAA,OAAAA,IAAI,cAE/B,MAAA,UAIdA,EAAI7B,cAAcuC,cAAiB,CAClB,SAAA,SAAS9C,GAClBA,OAAAA,EAAcS,MAAMoC,OAET,WAAA,SAAS7C,GAC3BA,EAAcS,MAAMoC,OAAQ,EACxB7C,EAAcE,YAAsBkC,EAAAA,OAAAA,IAAI,eAE/B,MAAA;;ACwJd,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,UAAA,EA7NA,IAAA,EAAA,EAAA,QAAA,iCACA,EAAA,QAAA,iDACA,EAAA,QAAA,eACA,EAAA,QAAA,6BA0NA,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAxNA3Q,EAAOC,OAAAA,SAAS,MAEhB,IAAIqR,EAAO,GAsNX,QAAA,KAAA,EApNAA,EAAKC,qBAAuB,SAASvK,GAEjCwK,GAAK,IAAIf,EAAMD,MAAAA,KAAK5K,WAAW,uBAG/B2G,GAAK,IAAIkE,EAAMD,MAAAA,KAAKzJ,aAAaC,GAGjCyK,GAAK,IAAIhB,EAAMD,MAAAA,KAAKzG,aACpB0H,GAAGC,QAAQF,GAAGjF,IAGdA,GAAGoF,aAAa,GAGhBH,GAAGE,UAGHlJ,WAAW,WACdgJ,GAAGlJ,cACHiE,GAAGqF,cACH/R,QAAQC,IAAI,kCACN,OAKPwR,EAAKO,oBAAsB,WAehB,OAbPtF,GAAK,IAAIkE,EAAMD,MAAAA,KAAKzJ,aAAa,mBACjCwF,GAAGuF,eAGHC,GAAK,IAAItB,EAAMD,MAAAA,KAAKpG,aAGpBqH,GAAK,IAAIhB,EAAMD,MAAAA,KAAKzG,aACpB0H,GAAGC,QAAQnF,GAAGwF,IAGdxF,GAAGyF,eAEI,CAACzF,GAAGwF,KAIfT,EAAKW,mBAAqB,SAASzN,GACxB0N,EAAAA,OAAAA,GAAG,qCAAuC1N,GAC7C2N,IAAAA,EAAK,IAAI1B,EAAMD,MAAAA,KAAKjC,cAAc,CAACtG,YAAczD,EAAGgK,UAAW,IAc5D2D,OAbPA,EAAGC,WAAW,CAAW,OAAA,IAElBF,EAAAA,OAAAA,GAAG,kBACVC,EAAGE,WAAW,CAAC5N,GAAG,QAAUhD,EAAEkP,EAAI9B,IAAAA,QAAQ1C,MAAM,SAAUwB,MAAQ,OAClEwE,EAAGE,WAAW,CAAC5N,GAAI,aAAchD,EAAGkP,EAAI9B,IAAAA,QAAQiC,WAAW,SAAUnD,MAAQ,OAEtEuE,EAAAA,OAAAA,GAAG,wBACVC,EAAGG,iBAAiB,eAAgB3B,EAAI7B,IAAAA,cAAcqC,cACtDgB,EAAGG,iBAAiB,gBAAiB3B,EAAI7B,IAAAA,cAAcuC,eAIhDa,EAAAA,OAAAA,GAAG,gBACHC,GAOXb,EAAKiB,uBAAyB,SAASnQ,GAE5B8P,EAAAA,OAAAA,GAAG,yCACNC,IAAAA,EAAK,IAAI1B,EAAMD,MAAAA,KAAKjC,cAAc,CAACtG,YAF/B,IAEgDuG,UAAW,IAiB5D2D,OAhBPA,EAAGC,WAAW,CAAW,OAAA,IAElBF,EAAAA,OAAAA,GAAG,kBACVC,EAAGE,WAAW,CAAC5N,GAAG,QAAUhD,EAAEkP,EAAI9B,IAAAA,QAAQ1C,MAAM,SAAUwB,MAAQ,OAClEwE,EAAGE,WAAW,CAAC5N,GAAI,aAAchD,EAAGkP,EAAI9B,IAAAA,QAAQiC,WAAW,SAAUnD,MAAQ,OAEtEuE,EAAAA,OAAAA,GAAG,wBACVC,EAAGG,iBAAiB,eAAgB3B,EAAI7B,IAAAA,cAAcqC,cACtDgB,EAAGG,iBAAiB,gBAAiB3B,EAAI7B,IAAAA,cAAcuC,eAKvDc,EAAGK,SAASpQ,GAEL8P,EAAAA,OAAAA,GAAG,gBACHC,GAMXb,EAAKmB,aAAe,SAASrQ,GACzBoC,EAAI,IACG0N,EAAAA,OAAAA,GAAG,qCAAuC1N,GAC7C2N,IAAAA,EAAK,IAAI1B,EAAMD,MAAAA,KAAKjC,cAAc,CAACtG,YAAazD,EAAGgK,UAAW,EAAMC,YAAa,IAE9EyD,EAAAA,OAAAA,GAAG,kBACVC,EAAGE,WAAW,CAAC5N,GAAG,cAAgBhD,EAAEkP,EAAI9B,IAAAA,QAAQgC,MAAM1E,MAAM,WAE5DgG,EAAGE,WAAW,CAAC5N,GAAI,QAAShD,EAAGkP,EAAI9B,IAAAA,QAAQ1C,MAAM,WACjDgG,EAAGE,WAAW,CAAC5N,GAAI,QAAShD,EAAGkP,EAAI9B,IAAAA,QAAQ1C,MAAM,WAE1C+F,EAAAA,OAAAA,GAAG,wBACVC,EAAGG,iBAAiB,eAAgB3B,EAAI7B,IAAAA,cAAcqC,cACtDgB,EAAGG,iBAAiB,gBAAiB3B,EAAI7B,IAAAA,cAAcuC,eAIhDa,EAAAA,OAAAA,GAAG,uBACVC,EAAGK,SAASpQ,GAGRmK,IAAAA,EAAK,IAAIkE,EAAMD,MAAAA,KAAKzJ,aAAa,mBAS9B,OARPwF,EAAGuF,eAGHL,GAAK,IAAIhB,EAAMD,MAAAA,KAAKzG,aACpB0H,GAAGC,QAAQnF,EAAG4F,GAIP,CAAC5F,EAAIkF,GAAIU,IAKpBb,EAAKoB,aAAe,WACZtQ,IAEA+P,EAAKb,EAAKiB,uBAFN,CAAEI,GAAK,CAAC,QAAS,WAuBrBC,EAAQ,GACRC,EAAU,EACV5Q,EAAI4F,YAAc,WAVzBsK,EAAG3E,GAAG2C,qBAAqB,IAAIyC,EAAMC,EAAS,CAACC,MAAQ/E,KAAKgF,IAJzC,IAIuDF,GAAWG,OAASjF,KAAKgF,IAH9E,IAG8FF,KAYnHA,KACO,IAKG,MAAA,CAACV,EAAMlQ,EAJH,WACd8F,cAAc9F,MAYfqP,EAAK2B,cAAgB,WAOZ,IALDjS,IAGAkS,EAAQhS,MAHF,KAGaC,KAAK,GACxBQ,EAAUT,MAJJ,KAIeC,KAAK,GACrBZ,EAAI,EAAGA,EALN,IAKgBA,IAAO,CAChC4S,IAAAA,EAJW,EADG,EAKC5S,EACnB2S,EAAM3S,GAAK4S,EAEPhB,IAAAA,EAAKF,mBAAmBkB,GAGxBC,EAAe,WACfjB,EAAGkB,mBACJ7M,KAAK2L,GAGRxQ,EAAQpB,GAAKJ,EAAKqB,QAAAA,KAAK4R,GAIblB,EAAAA,OAAAA,GAAG,wBACVoB,UAAU,OAAS,OAAQ,OAASJ,EAAOvR,GACpCuQ,EAAAA,OAAAA,GAAG,YAcdZ,EAAKiC,GAAK,WAKCnR,OAJPA,EAAI,IAAIqO,EAAMD,MAAAA,KAAKzJ,aAAa,mBAChC3E,EAAE0P,eAGK1P;;ACzNX,aAVA,IAAA,EAAA,QAAA,cACA,EAAA,QAAA,oCAIAqO,EAAMa,MAAAA,KAAOA,EAAb,KAIAzR,QAAQC,IAAK,MAAS,IAAIoH,KAAU,OACpCrH,QAAQC,IAAI","file":"index.map","sourceRoot":"..","sourcesContent":["\nexport function makeLogger(tag) { \n    return function(...stuff) { \n\tconsole.log(\"[\" + tag + \"]:: \" + stuff.join())\n    }\n} \n\n\nvar logger = {} \n\nlogger.register = function(tag) { \n    logger[tag] = makeLogger(tag)\n} \n\n\nexport {logger} \n","//Tue Oct  2 18:06:09 PDT 2018\n//General JS utils file \n//would like to try creating soft?hard? links so that the utils files can be shared \n\nimport {logger} from \"../core_modules/logger.js\"\n\n\nvar global_debug = true \n\nvar util = {} \n\nutil.set_debug = function(b) { \n    global_debug = b \n} \n\nutil.bug = function(tag,...msg) { \n    if (global_debug) { \n\tconsole.log(\"<- \" + tag + \" ->\" )\n\tfor (var i = 0 ; i < msg.length ; i++) { \n\t    console.log(msg[i])\n\t}\n\tconsole.log(\"<- \" + tag + \" ->\" )\n    }\n}\n\nlogger.register(\"bug\") \n\nutil.debug = function(msg) { \n    if (global_debug) {\n\tlogger.bug(msg)\n    }\n}\n\n\n\nutil.avg = function(arr) { \n    var sum = 0;\n    for( var i = 0; i < arr.length; i++ ){\n\tsum += arr[i]\n    }\n    return sum/arr.length \n}\n\nutil.take = function(coll,num) { \n    var ret = Array(num).fill(0) \n    for (var i =0;i<num; i++) { \n\tret[i] = coll[i]\n    }\n    return ret \n} \n\nutil.arr_mult = function(arr,x) { \n    return arr.map( y => y /x ) \n}\n\nutil.perf = function(f) { \n    var num_times = 20000\n    var results = Array(num_times).fill(0) \n    for (i = 0 ; i < num_times ; i++ ) { \n\tvar t0 = performance.now();\n\tvar result = f() \n\tvar t1 = performance.now();\n\tresults[i] = t1 - t0 \n    } \n    return avg(results) \n} \n\nutil.range = function(a,b) { \n    var len = b - a \n    var ret = Array(len).fill(0)  ; \n    for (var i = 0 ; i< len ; i++) {  \n\tret[i] = a + i \n    }\n    return ret \n    \n} \n\nutil.first = function(d) { \n    return d[0]\n} \n\n\nutil.last = function(d) { \n    return d[d.length - 1 ] \n} \n\n\nutil.zip = function(xs,ys) { \n        return xs.map(function(x,i) { \n\t    return [x, ys[i]]\n\t}) \n}\n\nutil.dict_2_vec = function(d) { \n    var ret = [] ; \n    for (var k in d) { \n\tret.push([ k, d[k] ]) \n    } \n    return ret \n}\n\nutil.number_or_self = function(d) { \n    var val = Number(d) \n    if (isNaN(val)) {\n\treturn d \n    } else { \n\treturn val \n    } \n}\n\nutil.d_map = function(d,f) { \n    for (var k in d) {\n\td[k] = f(d[k])\n    }\n    return d \n}\n\nutil.dict_vals_2_num = function(d) { \n    return util.d_map(d,number_or_self) \n}\n    \n\nutil.diff = function(d) { \n    var r =   Array(d.length - 1).fill(0) \n    for (var i = 1 ; i < d.length ; i ++ ) { \n\tr[i-1] = d[i] - d[i-1]\n    }\n    return r \n}\n\n\nutil.max = function(d) { \n    var curr_max = d[0] \n    \n    for (var i=1;i<d.length;i++) { \n\tif (d[i] > curr_max) { curr_max = d[i] }\n    } \n    \n    return curr_max \n} \n\n\nutil.min = function(d) { \n    var curr_min = d[0] \n    \n    for (var i=1;i<d.length;i++) { \n\tif (d[i] < curr_min) { curr_min = d[i] }\n    } \n    \n    return curr_min\n    \n} \n\n\n\n// define ui utilities now ------------> \n\n\n\n\nutil.dom = function(s) { \n    return document.createElement(s) \n} \n\nutil.set_inner_html = function(d,thang) { \n    if (thang instanceof HTMLElement) { \n\td.appendChild(thang) \n    } else { \n\td.innerHTML = thang \n    } \n    \n} \n\nutil.flex_row = function(num,id_base,f) { \n    var container, i \n\n    container = util.dom(\"div\")  \n    container.className = \"flex-row\"  // see styles.css   \n    \n    for (i =0 ; i < num ; i ++ ) { \n\tvar d = util.dom(\"div\") \n\tvar html = f(i,d) \n\tif (html) { \n\t    util.set_inner_html(d, html) \n\t} \n\tcontainer.appendChild(d) \n    } \n\t\n    return container  \n     \n}\n\n\n/* \n * Create a flexbox of divs [m,n] in shape \n * @param {Function} f - accepts row, column, and HTMLelement. Can either mutate the el or return an new el (which will be appended to div at spot r,c) or return String (which will be set to innerHTML) \n */ \nutil.make_div_array = function(m,n,id_base,f) { \n    var container, i \n    \n    container = util.dom(\"div\")  \n    container.className = \"flex-column\"  // see styles.css  \n    container.id = id_base \n    \n    container.style = \"width: 100% ; height : 100% \" \n    \n    // now we will add in the child elements \n    for (i =0 ; i < m ; i ++ ) { \n\t\n\t//f is a function which takes a row and column and element \n\t//build a function that takes just a col with row hard coded \n\t//and returns f(r,col)\n\tvar fn = function(col,el) {\n\t    return f(i,col,el) \n\t}\n\t\n\tvar new_id_base = id_base + \"_\" +  i + \",\" \n\tvar row = util.flex_row(n,new_id_base , fn )\n\tcontainer.appendChild(row) \n    }\n    \n    return container\n    \n\n} \n\nutil.id_from_loc = function(m,n,c) { \n    return c*m + n   // intersing that this function needs arg c, which is (static) number of cols \n}\n\nutil.test_div_array = function(m,n) { \n    var f = function(r,c,el) { \n\treturn (util.id_from_loc(r,c,n)).toString()\n    } \n\n    return util.make_div_array(m,n,\"foo\", f) \n    \n} \n\t\n\nutil.app_clear = function() { \n    var app = document.getElementById(\"app\");\n    while (app.firstChild) {\n\tapp.removeChild(app.firstChild);\n    }   \n}\n\nutil.app_render = function(el) { \n    util.app_clear() \n    var app = document.getElementById(\"app\")  \n    app.appendChild(el) \n}\n\n\nvar colors = [\"black\" , \"blue\" , \"red\" , \"green\" , \"yellow\" , \"orange\"]\n\nutil.get_colors = function(num) { \n    return util.take(colors, num) \n}\n\n\n\n///   extensions \n\n\n// Array.prototype.first = function(arr) { \n//     return arr[0] \n// }\n\n\nexport {util} \n","// Sat Sep 29 18:31:15 PDT 2018\n\nimport {makeLogger} from \"./logger.js\"\nimport util from \"../module_resources/utils.js\"\n\n/**\n * Manages the websocket connection to an incoming data stream.\n *\n * @param {String} url - The websocket url to connect to, e.g. ws://localhost:1234\n */\nexport default class web_socket {\n    \n    constructor(url) { \n\tthis.url = url ;  \n\tthis.connection = null ;  \n\tthis.log = makeLogger(\"WS\")\n\tthis.default_handler = function(data) { \n\t    this.log(\"No data handler has been defined!\") \n\t} \n\tthis.data_handler = this.default_handler \n    } \n    \n    \n    /**\n     * Connect to remote websocket server. Upon success, registers the websocket connection\n     * as \"client\" with the server, enables streaming, and this.logs to console. \n     */ \n    connect() { \n\tvar conn  = new WebSocket(this.url) ; \n\t// Connection opened\n\tconn.addEventListener('open', (function (event) {\n\t    this.log(\"Connection to \" + this.url + \" successful. Registering client with server.\")\n\t    this.send_json({type: \"register\" , data : \"client\" })\n\t    this.send_json({type: \"control\"  , data : \"start\"  }) \n\t}).bind(this)) //bind is necessary for web_socket class vs WebSocket instance! \n\n\t\n\t// Listen for messages\n\tconn.addEventListener('message', (function (event) {\n\t    //this.log(\"Received msg: \" + event.data) \n\t    this.data_handler(util.dict_vals_2_num(JSON.parse(event.data))) //parse json and convert nums\n\t}).bind(this)) //bind is necessary for web_socket class vs WebSocket instance! \n\t\n\tthis.connection = conn ; \n    } \n    \n    /** \n     * Start accepting incoming raw data objects.\n     */ \n    start_stream() { \n\tthis.send_json({type : \"control\" , data : \"start\" } ) \n    }\n\n    /** \n     * Stop accepting incoming raw data objects.\n     */ \n    stop_stream() { \n\tthis.send_json({type : \"control\" , data : \"stop\" } ) \n    }\n\n    /** \n     * Sets the data_handler attribute, which determines what the socket does to incomin data.\n     * @param {Function} func - Function which accepts ONE raw data object {..} and processes it.\n     */ \n    set_data_handler(func) { \n\tthis.data_handler = func ; \n    }\n\n    /** \n     * Sends JSON data through socket. \n     * @param {Object} obj - Data object to send \n     */ \n    send_json(obj) { \n\tthis.connection.send(JSON.stringify(obj))\n    }\n\n    \n    \n}\n\n","//Tue Oct  2 10:12:11 PDT 2018\n\nimport {makeLogger} from \"./logger.js\"\nimport util from \"../module_resources/utils.js\"\n\n/**\n * \n * \n */\n\nexport default class data_storage {\n\n    /**\n     * Manages data persistence and replay/simulation. Uses browser based local storage. \n     * @param {String} name - Session identifier, use null for default time string\n     */ \n    constructor(name) { \n\tthis.session_id = name || (new Date()).toISOString()\n\tthis.data_history = [] \n\tthis.part_counter = 1 \n\tthis.save_interval_id = null \n\tthis.loaded_session = null \n\t\n\tthis.log = makeLogger(\"DS\")\n\tthis.default_handler = function(data) { \n\t    this.log(\"No data handler has been defined!\") \n\t} \n\tthis.data_handler = this.default_handler \n\tthis.stream_index = 0 \n    } \n    \n    /**\n     *  Persists a chunk of data to localStorage. Uses session name + part_number as identifier\n     */ \n    flush_data() { \n\tvar to_save = JSON.stringify(this.data_history)\n\tname    = this.session_id + \"_part\" + this.part_counter.toString() \n\tthis.data_history = [] \n\tlocalStorage.setItem(name, to_save) \n\tthis.part_counter += 1 \n\tthis.log(\"Saved data chunk: \" + name ) \n    } \n    \n    /**\n     * Start saving data to localStorage. Data is saved in chunks called 'parts'. \n     * @param {Number} rate - The rate to flush data to localStorage in SECONDS \n     */ \n    start_saving(rate) { \n\tthis.save_interval_id = setInterval(  (function(){this.flush_data()}).bind(this) , rate*1000)\n\tthis.log(\"Saving started for session: \" + this.session_id) \n    } \n\n    /**\n     * Stop saving data to localStorage\n     */ \n    stop_saving() { \n\tclearInterval(this.save_interval_id) \n\tthis.log(\"Saving stopped for session: \" + this.session_id) \n    } \n    \n    /** \n     * Main data handler. Will append the incoming data to the data_history array \n     * @param {Object} obj - The data obj to add \n     */\n    process_data(obj) { \n\tthis.data_history.push(obj) \n    } \n\n    /** \n     * Loads a data storage session from localStorage. Returns Array. \n     */\n    load_session() { \n\tthis.log(\"Loading session...\")\n\tthis.loaded_session = get_session(this.session_id)  // see definition below \n\tthis.stream_index = 0 \n\tthis.buffer_size = this.loaded_session.length\n\tthis.streaming = false \n\tthis.zero_time_axis() \n\tthis.diffs = util.diff( this.loaded_session.map( d => d[\"time\"] )  )\n\tthis.log(\"Session loaded: \" + this.session_id) \n    } \n\n\n    /** \n     * Set the data_handler for data replay/simulation \n     * @param {Function} f - The data handler function  \n     */\n    set_data_handler(f) { \n\tthis.data_handler = f \n    } \n    \n    /** \n     * Start streaming the session that was previously loaded from localStorage \n     */\n    start_stream() { \n\tthis.stream_index =  0 \n\tthis.streaming = true \n\tthis.start_stream_loop() \n    } \n    \n    /** \n     * Stream single packet\n     */\n    stream_single_packet() { \n\tif (this.stream_index < this.buffer_size  ) { \t\n\t    //get the data\n\t    var val = this.loaded_session[this.stream_index]\n\t    //send the data\n\t    this.data_handler(val) \n\t    //increment the stream index \n\t    this.stream_index += 1 \n\t    return val \n\t} else { \n\t    this.stop_stream() \n\t} \n\t\n\n    } \n    \n    \n    /** \n     * Helper function for start_stream() \n     */\n    start_stream_loop() { \n    \t//when starting, this.index is 0, this.diffs is defined \n\tif (this.streaming) { \n\t    //get the data\n\t    var val = this.loaded_session[this.stream_index]\n\t    //send the data\n\t    this.data_handler(val) \n\t    \n\t    if (this.stream_index == this.buffer_size - 1 ) { \n\t\t//on the last data point  \n\t\t//significant b/c the diff array is finished \n\t\t//so we stop streaming \n\t\tthis.stop_stream() \n\t\t\n\t    } else { \n\t\t//not on the last data point \n\t\t//now acces the next diff \n\t\tvar delay = this.diffs[this.stream_index]\n\t\t//increment the stream_index \n\t\tthis.stream_index += 1 \n\t\t//schedule the loop again \n\t\tsetTimeout( (function() {this.start_stream_loop()}).bind(this) , delay)\n\t    }\n\t    \n\t}\n\t\n    }\n\t\t\n    \n    /** \n     * Zero the time axis of the data session \n     */\n    zero_time_axis() { \n\tthis.log(\"Zeroing time axis\") \n\tif (!this.loaded_session.length) { \n\t    throw(\"Session must be loaded!\")\n\t} else { \n\t    //get first time point \n\t    var t_1  = util.first(this.loaded_session)[\"time\"] \n\t    //now we subtract t_1 from all time points \n\t    this.loaded_session.map( function(d) { \n\t\td[\"time\"] = d[\"time\"] - t_1 \n\t\treturn d \n\t    })\n\t    this.log(\"Done\")\n\t}\n\t\n    } \n\n\n\n    /** \n     * Stop streaming the session that was previously loaded from localStorage \n     */\n    stop_stream() { \n\tthis.streaming = false \n\tthis.stream_index =  0 \n\tthis.log(\"Stream finished.\") \n    } \n\n    \n    \n    /** \n     * Makes csv string from this.loaded_session \n     */\n    to_csv(name) { \n\tthis.log(\"Creating csv file for: \" + this.session_id) \n\tlet csvContent = \"data:text/csv;charset=utf-8,\";\n\t\n\t//figure out the keys in the data objects \n\tlet keys = Object.keys(this.loaded_session[0]).sort()\n\t\n\t//write csv header \n\tcsvContent += ( keys.join(\",\") + \"\\n\" ) \n\t\n\t//then loop through the structure \n\tfor (var i =0 ; i < this.loaded_session.length ; i ++) { \n\t    var data = this.loaded_session[i]\n\t    if (data.dev == \"B\" ) { \n\t\tvar row_content = []\n\t\t//loop through keys to build the row \n\t\tfor (var k = 0 ; k < keys.length ; k ++ ) { \n\t\t    var key = keys[k] \n\t\t    var val = data[key]\n\t\t    row_content.push(data[key]) \n\t\t}\n\t\tcsvContent += (row_content.join(\",\") + \"\\n\" ) \n\t    }\n\t} \n\t\n\tvar encodedUri = encodeURI(csvContent);\n\tvar link = document.createElement(\"a\");\n\tlink.setAttribute(\"href\", encodedUri);\n\tlink.setAttribute(\"download\", (name || this.session_id)   + \".csv\");\n\tlink.click();\n\t\n    } \n\n    \n    \n    \n}\n\n\n// define some helpers \nfunction get_session_part_names(id) { \n    return Object.keys(localStorage).filter( s => s.includes(id) ).sort() \n} \n    \nfunction get_session(id) { \n    var parts_names = get_session_part_names(id) \n    // part names are sorted already \n    tmp = parts_names.map( function(name) { \n\treturn JSON.parse(localStorage.getItem(name))\n    }) \n    \n    var merged = [].concat.apply([], tmp);\n    return merged \n}\n","//Tue Oct  2 10:12:11 PDT 2018\n\nimport {makeLogger} from \"./logger.js\"\n\n/**\n * Manages the flow of streaming data between various modules of RoseGait\n * e.g. pipe_manager.connect(web_socket, data_storage) \n */\nexport default class pipe_manager {\n    \n    constructor() { \n\tthis.log = makeLogger(\"PM\")\n    } \n    \n    \n    /**\n     * Connects a streaming output data source to a streaming input source. \n     * @param {Object} from - data source (emits data). Must implement method `set_data_handler` \n     * and have member default_handler\n     * @param {Object} to -   data sink   (consumes data). Must implement method `process_data` \n     */ \n    connect(from, to) { \n\tfrom.set_data_handler(  (function(d) {to.process_data(d)}).bind(to) ) \n    } \n\n    /**\n     * Disconnects a streaming output data source from a streaming input source. \n     * @param {Object} from - data source (emits data). Must implement method `set_data_handler` \n     * and have member default_handler\n     * @param {Object} to -   data sink   (consumes data). Must implement method `process_data` \n     */ \n    disconnect(from, to) { \n\tfrom.set_data_handler(from.default_handler)\n    } \n\n    \n}\n\n\n\n\n","//Tue Oct  2 10:12:11 PDT 2018\n\nimport {makeLogger} from \"./logger.js\"\nimport util from \"../module_resources/utils.js\"\n\n/**\n * \n * \n */\n\nexport default class raw_analyzer {\n\n    /**\n     * Provides insights and attributes about raw data stream. \n     * e.g. checks for dropped samples \n     */ \n    constructor() { \n\tthis.data_history  =  [] \n\tthis.log = makeLogger(\"RA\")\n    } \n    \n    /**\n     * Processes a data packet \n     * @param {Object} obj - Data object to process \n     */ \n    process_data(obj) { \n\tthis.data_history.push(obj) \n\tthis.log(\"Received data!\") \n    } \n    \n    /**\n     * Produce report (logged to console for now) \n     */ \n    produce_report() { \n\tvar data_buffer = this.data_history \n\tvar report = get_report(data_buffer) \n\tthis.log(\"Printing report: \" ) \n\tthis.log(JSON.stringify(report) ) \n\treturn report \n    } \n    \n    /**\n     * (UNSTABLE ) Show ditribution for field  \n     */ \n    dist_field(f) { \n\t//clear_plot_div() \n\t\n\tvar data = this.data_history.map( e => e[f] ) \n\t\n\tg_hist(data,\"Distribution for: \" + f)     \n\t\n    }\n\n    /**\n     * (UNSTABLE) Show time series for field \n     */ \n    line_field(f) { \n\tvar data = this.data_history.map( e => e[f] ) \n\tg_line(data,\"Time series for: \" + f)     \n\t\n    }\n\n    \n} \n\n\n\nfunction get_field_average(obj_array,f) { \n    return  utils.avg(obj_array.map( obj => obj[f] )) \n} \n\n\n\n\nfunction get_report(data_buffer) { \n    return { \n\t    'len'       : data_buffer.length  , \n\t    'acc_x_avg' : get_field_average(data_buffer, \"acc_x\"), \n\t    'acc_y_avg' : get_field_average(data_buffer, \"acc_y\"), \n\t    'acc_z_avg' : get_field_average(data_buffer, \"acc_z\"), \n\t    'gyr_x_avg' : get_field_average(data_buffer, \"gyr_x\"), \n\t    'gyr_y_avg' : get_field_average(data_buffer, \"gyr_y\"),\n\t    'gyr_z_avg' : get_field_average(data_buffer, \"gyr_z\") \t    \n    }\n} \n\n","\n\n\nvar params = \n    { \n\tglobal_x_len : 200 \n\t\n\t\n\t\n    }\n\n\nexport { params } \n    \n","import {params} from \"../module_resources/global_params.js\" \nimport {util}     from \"../module_resources/utils.js\" \n\n\nvar plt = Bokeh.Plotting;\n\n\nfunction make_y_series(len) { \n    return Array(len).fill(0) \n}\n\nfunction make_x_series(len) { \n    return util.range(-len, 0).map( x => x/100 ) // the /100 is hax for now for streaming\n}\n\n\nfunction create_multi_line_graph(opts) { \n    var { x_len, series_array, title  } = opts \n    var series_len = series_array.length \n    \n    //make xs and ys vector \n    var xs = [] \n    var ys = [] \n    for (var i =0 ;i < series_len ; i++) { \n\txs.push(make_x_series(x_len))\n\tys.push(make_y_series(x_len))\n    } \n    \n    //make data source \n    var source = new Bokeh.ColumnDataSource( {\n\tdata : {xs : xs, ys : ys }\n    })\n    \n    // make the plot and add some tools\n    var tools = \"pan,crosshair,wheel_zoom,box_zoom,reset,save\";\n    \n    // WOW ! -- how lucky to find sizing_mode : stretch_both lmao \n    // https://github.com/bokeh/bokeh/issues/4958\n    \n    var p = plt.figure({ title: title, tools: tools , sizing_mode : 'stretch_both' })\n    \n     \n    //add the multiline \n    var glyph = p.multi_line({ field: \"xs\" }, { field: \"ys\" }, {\n\tsource: source,\n\tline_color: util.get_colors(series_len)\n    }) \n\n    \n    //NEXT STEP -- > NEXT STEP -- > NEXT STEP -- > NEXT STEP -- > NEXT STEP -- > \n    //Need to call plt.show(p , HTMLelement) \n    return { plot : p , glyph : glyph , source : source } \n\t     \n    \n} \n\n\n\n// Figured out this function by looking at bokeh source code \nvar bokeh_multi_stream = function(ds, x, ys) { \n    var data = ds.data \n    var xss = data.xs\n    var yss = data.ys \n    // make modifications \n\n    for(var i=0;i<yss.length;i++) {\n\t\n\t//NOTE* if one of the y values is !FALSE! , then the assumption is that \n\t//the series at that index should NOT BE updated \n\t//Sensors in rosegait return false when they wish NOT to be updated \n\t\n\tif (ys[i]) {\n\t    // -  \n\t    xss[i].push(x)\n\t    xss[i].shift()\n\n\t    // -  \n\t    yss[i].push(ys[i])\n\t    yss[i].shift()\n\t    \n\t} \n    }\n    // re assign the data \n    data.xs = xss \n    data.ys = yss \n    ds.setv('data', data, {\n        silent: true\n    });\n    \n    return ds.trigger('stream');\n}\n\n// < -- START CLASS DEFINITIONS -- START CLASS DEFINITIONS -- START CLASS DEFINITIONS -- > \n\n/* \n * A bokeh real time, multi line graph \n *  \n */\nclass Graph { \n    constructor(opts) { \n\tvar {series_vector, title } = opts \n\tthis.parent = null \n\tthis.series_vector = series_vector \n\n\t\n\tvar multi_opts = { x_len : params.global_x_len , \n\t\t\t   title : title ,\n\t\t\t   series_array : series_vector } \n\t\n\tvar  {plot , glyph , source} = create_multi_line_graph(multi_opts) \n\t\n\tvar color = \"#e5efff\" // \"white\" //\"#003559\" //\"#B9D6F2\"\n\tvar alpha = 0.2 \n\tplot.background_fill_color = color\n\tplot.background_fill_alpha = alpha\n\n\tplot.border_fill_color = color\n\tplot.border_fill_alpha = alpha\n\n\tthis.multi_line_graph = plot \n\tthis.source = source \n\tthis.glyph  = glyph \n\t\n    } \n    \n    get_data_source() { \n\treturn this.source \n    } \n    \n    render_into_element(el) { \n\t//el.innerHTML = 'waiting'\n\t//this.parent = el \n\tplt.show(this.multi_line_graph, el) \n    } \n    \n}\n\n\nexport default class ui { \n    \n    /* \n     * \n     * @param {HTMLElement} parent - The DOM to render the UI into \n     */ \n    constructor(parent) { \n\tthis.graphs = {} \n\tthis.parent = parent \n\tthis.last_series_buffer = {} // holds the previous update sent to graph \n    } \n\n    /* \n     * Add graph to the ui \n     * @param {String} id - graph id \n     * @param {Vector} series_vector - Ids for series which will be graphed on this graph \n     */\n    add_graph(id, series_vector) { \n\tvar graph = new Graph( {series_vector : series_vector, \n\t\t\t\ttitle  : id + \": \" + series_vector.join(\", \")} )   \n\t\t\t       \n\tthis.graphs[id] = graph \n    } \n    \n    /* \n     *\n     * After all graphs have been added, init is called to actually display the graphs \n     *\n     */\n    init() { \n\t// logic for displaying all of the added graphs \n\t// should make a panel view of sorts and initialize with empty values \n\tvar graph_array = util.dict_2_vec(this.graphs) \t\n\tthis.graph_array = graph_array  \n\t\n\t// for now will put two graphs side by side \n\tvar n_cols = 2 \n\tvar n_rows = Math.ceil(Object.keys(this.graphs).length/2) \n\t\n\t// some hax  \n\tif (graph_array.length == 1 ) { \n\t    n_cols = n_rows = 1 \n\t} \n\t\n\tutil.bug(\"n_row\" , n_rows) \n\t\n\t// make a grid of divs \n\tvar app_el = util.make_div_array(n_rows,n_cols,\"rgui\",function(r,c,el) { \n\t    //get the graph index\n\t    var index = util.id_from_loc(r,c,n_cols)\n\t    // debug - console.log( [index, graph_array] )\n\t    \n\t    if (index < graph_array.length ) { \n\t\t//get the graph info using destructuring \n\t\tvar [id , graph] = graph_array[index] \n\t\tgraph.render_into_element(el) \n\t    } else { \n\t\t\n\t\treturn \"\" \n\t\t\n\t    }\n\t    \n\t})\n\t\n\t//render the app \n\tutil.app_render(app_el)\n\n    } \n\n    /* \n     * Streams data to a particular graph defined by graph_id. \n     * @param {Number} x - The x coordinate for new data \n     * @param {Vector} ys - New y points to add. These should correspond to and be in the same order as the series_vector assoiated with the same graph id\n     */\n    stream_to_graph(id , x , ys ) { \n\tbokeh_multi_stream(this.graphs[id].get_data_source(), x , ys ) \n    }\n    \n    /* \n     * Main data handler. \n     * @param {Object} series_buffer - Dictionary with all the series values for updating\n     */\n    handle_sensor_buffer(x,series_buffer) { \n\t\n\t\n\t//1) loop through the available graphs\n\tfor (var graph in this.graphs ) { \n\t    var series, ys , i , val \n\t    //2) get the series_vector for that graph \n\t    series = this.graphs[graph].series_vector \n\t    //3) look up the values for each series in the sensor_gui_buffer\n\t    ys = Array(series.length).fill(0)\n\t    for (i = 0 ; i < series.length ; i++ ) { \n\t\t//get the value of the series \n\t\tval =  series_buffer[ series[i] ]  \n\t\t\n\t\t//if it is false we pass it anyways (graph will handle it) \n\t\tys[i] = val \n\t    }\n\t    //update the graph \n\t    \n\t    bokeh_multi_stream(this.graphs[graph].get_data_source(), x , ys )\n\n\t    \n\t}\n\n    }\n    \n    \n    \n    \n}\n\n\n\n","//Wed Oct  3 09:42:59 PDT 2018\n// I remembered my development mantra - be patient. simplify. Refactor when necessary \n\nimport {makeLogger} from \"./logger.js\"\nimport ui from \"./ui.js\"\n\n/**\n * \n * \n */\n\nexport default class state_machine {\n\n    /**\n     * \n     * \n     */ \n    constructor(opts) { \n\tvar {buffer_size, gui_mode, debug_mode} = opts\n\tthis.log = makeLogger(\"SM\") \n\tthis.buffer_size = buffer_size \n\tthis.sensor_buffer_size = buffer_size \n\tthis.buffer = Array(buffer_size).fill(default_data_obj)\n\tthis.sensors = {} \n\tthis.transitioners = {} \n\tthis.transitioner_groups = {} \n\tthis.STATE  = {} \n\tthis.gui_mode = gui_mode \n\tthis.debug_mode = debug_mode || false \n\tif (gui_mode) { \n\t    //create the sensor_gui buffer \n\t    this.sensors_gui_buffer = {}\n\t    \n\t    this.ui_mapping = null\n\t    \n\t    //also create a ui object  \n\t    this.ui = new ui(null) \n\t} \n    } \n    \n    \n    /** \n     * Initializes the state machine\n     * @param {Object} state - the initial state for the state machine \n     */\n    initialize(state) { \n\tthis.STATE = state \n    } \n\n\n    /** \n     * Updates buffer with a data object. Uses js function `.shift()` to cycle array. \n     * @param {Object} obj - Data object to consume \n     */\n    update_buffer_with_data_object(obj) { \n\tthis.buffer.push(obj) \n\tthis.buffer.shift() \n    } \n\n    /** \n     * Adds a sensor to the state machine. \n     * @param {Object} opts - contains id, f (function) , graph (if gui_mode). Graph should be id of the graph that the sensor should be graphed on \n     */\n    add_sensor(opts) { \n\tvar id,f\n\tid = opts.id ; f = opts.f \n\t//register the sensor \n\tthis.sensors[id] = {} \n  \t//add the function \n\tthis.sensors[id][\"function\"] = f \n\t//and then allocate a buffer for the sensor values \n\tthis.sensors[id][\"buffer\"] = Array(this.sensor_buffer_size).fill(NaN) \n\tif (this.debug_mode) { \n\t    this.log(\"Added sensor: \" + id) \n\t}\n\t\n    } \n    \n    /** \n     * \n     * Init gui \n     * @param {Object} ui_mapping - Dictionary where keys are graph ids and vals are vectors of the sensors which could be graphed on that graph. E.g { graph-1 : [\"acc_x\", \"acc_z\" ] , etc} \n     */\n    init_gui(ui_mapping) { \n\tthis.ui_mapping = ui_mapping \n\t//loop through the graphs \n\tfor (var graph in this.ui_mapping )  { \n\t    var sensors = this.ui_mapping[graph] \n\t    this.ui.add_graph(graph, sensors)  // initializes a graph \n\t} \n\t\n\t//after all the graphs have been added then we call init \n\tthis.ui.init() \n\t\n    } \n\n    \n    /** \n     * Runs the sensor function with the state machine buffer as input \n     * then updates the corresponding sensor's buffer.\n     * @param {String} id - Sensor id to run   \n     */\n    run_sensor(id) { \n\tvar buffer = this.buffer \n\t//get the sensor function\n\tvar f = this.sensors[id][\"function\"]\n\t//run the sensor on the current buffer \n\tvar val = f(buffer) \n\t\n\t/*\n\t  sensors \n\t  only append the value if it exists \n\t  this allows the ability for sensors to act simultaneously as data filters \n\t  by introspecting on the data_packet somehow and deciding to reject it from \n\t  their buffer. \n\t  This however also allows for the possibility that the sensor buffers are no longer\n\t  synced in time.. not sure if this is a potential source of confusion in the future \n\t \n\t*/\n\t\n\tif (val) { \n\t    //append the new value to the sensors buffer \n\t    this.sensors[id][\"buffer\"].push(val)\n\t    this.sensors[id][\"buffer\"].shift() \n\t} \n\t\n\treturn val \n    } \n\n    /** \n     * Utility function for retrieving the last N values of a sensor's buffer\n     * Used to make it easier to write Detectors \n     * @param {String} id - Sensor id \n     * @param {Number} num - The number of values to retrieve from END of buffer \n     */\n    get_sensor_last_N(id,num) { \n\treturn this.sensors[id][\"buffer\"].slice(this.buffer_size - num) \n    }\n\n    /** \n     * Utility function for retrieving the last value of a sensor's buffer\n     * Used to make it easier to write Detectors \n     * @param {String} id - Sensor id \n     */\n    get_sensor_last_N(id) { \n\treturn get_sensor_last_N(id, 1 ) \n    }\n    \n    /** \n     * Adds a transitioner to the state machine. \n     * @param {String} id - Transitioner id for reference \n     * @param {Object} transitioner - Transitioner implementation (Object with keys [detector, applicator]) The detector and applicator both  accept the state_machine object in its entirety in order to allow easy access to all fields. \n     */\n    add_transitioner(id,transitioner) { \n\t//make sure it has what we want \n\tif (! (transitioner.detector && transitioner.applicator ) ) { \n\t    throw \"Transitioner object does not contain both detector and applicator!\" \n\t} \n\t\n \t//register the transitioner\n\tthis.transitioners[id] = transitioner \n\t\n\t//if it is part of a group we register that too , and by default activate it \n\tif (transitioner.group) { \n\t    this.transitioner_groups[transitioner.group] = true \n\t}\n\t\n\tif (this.debug_mode) { \n\t    this.log(\"Added transitioner: \" + id) \n\t}\n\n    }\n    \n    /** \n     * Runs the transitioner \n     * @param {String} id - Transitioner to run \n     */\n    run_transitioner(id) { \n\t//get the transitioner  \n\tvar transitioner = this.transitioners[id] \n\t\n\t//get the group and group status\n\tvar group = transitioner.group\n\tvar group_status = this.transitioner_groups[group]\n\t\n\t//only run if group is NULL or if it exists and is TRUE \n\tif ( group_status != false ) {\n\t    \n\t    //get the detector and applicator \n\t    var detector = transitioner.detector \n\t    var applicator = transitioner.applicator \n\n\t    \n\t    //the detector and applicator both  accept the state_machine object in its entirety in order to allow easy access to all fields \n\t    //apply the applicator IF the detector returns true  \n\t    if (detector(this)) { \n\t\tif (this.debug_mode) { this.log(\":match: => \" + id) }\n\t\tapplicator(this)  // the applciator will actually mutate the this.STATE object  \n\t\t// deactivate this group if it is part of one\n\t\tif (group_status) { \n\t\t    this.transitioner_groups[group] = false \n\t\t} \n\t    } else { \n\t\tif (this.debug_mode) { this.log(\":fail: => \" + id) }\n\t    }\n\t    \n\t}\n\t\n    } \n\n\n    /** \n     * Processes a data object, running one cycle of the state machine. \n     * @param {Object} obj - Data object to process \n     */\n    process_data(obj) { \n\t\n\t//1. update the data buffer  \n\tthis.update_buffer_with_data_object(obj) \n\t\n\t//2. now we need to update all of the sensors \n\tfor (var sensor_id in this.sensors ) { \n\t    var val = this.run_sensor(sensor_id) \n\t    if (this.gui_mode){ \n\t\tthis.sensors_gui_buffer[sensor_id] = val \n\t    } \n\t} \n\t\n\t\n\t//3. now we run all the transitioners (which rely on most up to date Sensor values) \n\tfor (var transitioner_id in this.transitioners ) { \n\t    this.run_transitioner(transitioner_id) \n\t} \n\t\n\t//at this point, this.STATE should be updated , one cycle of the state machine has been completed \n\t//in order to reset, we should return the state of all transition groups \n\tfor (var group in this.transitioner_groups) {\n\t    this.transitioner_groups[group] = true \n\t}\n\t\n\t\n\t// after all this is done we will update the ui \n\t//the sensors_gui_buffer is now full and updated and can be passed to the ui for processing \n\t//pass all the sensor data to the UI for updating \n\tif (this.gui_mode) { \n\t    // also we need to give an X coordinate for the data  \n\t    // for now we will pass the 'time' value of the data obj \n\t    this.ui.handle_sensor_buffer(obj.time,this.sensors_gui_buffer)\n\t}\n\n\t\n    } \n    \n    /** \n     * For debug purposes and profiling. Processes one cycle with a defualt data object\n     */\n    run_debug_cycle() { \n\tthis.process_data(random_data_obj()) \n    } \n    \n\n    \n}\n\n\nvar default_data_obj = { \n    'acc_x' : 0 , \n    'acc_y' : 0 , \n    'acc_z' : 0 , \n    'gyr_x' : 0 , \n    'gyr_y' : 0 , \n    'gyr_z' : 0 , \n    'sample': 0 , \n    'time'  : 0 , \n    'dev'   : \"B\" \n}\n\n\n//for generating random data packets \nvar m = Math.random \nvar count = 0 \nfunction random_data_obj() { \n    return {'acc_x' : m(),\n\t    'acc_y' : m(),\n\t    'acc_z' : m(), \n\t    'gyr_x' : m(), \n\t    'gyr_y' : m(), \n\t    'gyr_z' : m(),\n\t    'sample': count++ , \n\t    'dev'   : \"B\"}\n} \n","// bundles all the modules into one object for easy access \n// Mon Oct 22 22:16:23 PDT 2018\n\nimport web_socket from \"./core_modules/web_socket.js\" \nimport data_storage from \"./core_modules/data_storage.js\" \nimport pipe_manager from \"./core_modules/pipe_manager.js\" \nimport raw_analyzer from \"./core_modules/raw_analyzer.js\" \nimport state_machine from \"./core_modules/state_machine.js\" \nimport ui from \"./core_modules/ui.js\" \n\nexport var mods = { web_socket, data_storage , pipe_manager , raw_analyzer, state_machine, ui }\n\n","import {mods}  from  \"./module_bundle.js\"\n\n// defines object that will be attached to window \nvar wrtsm = {}  \n\n//give it the module bundle \nwrtsm.mods = mods \n\n\n//add it to window \nwindow.wrtsm = wrtsm \n\n\n//export it for use \nexport { wrtsm } \n\n\n\n","//Fri Oct  5 19:31:23 PDT 2018\n\n// filefor collecting definitions of Sensors and transitioners\n\nimport {logger} from \"../core_modules/logger.js\"\nimport util     from \"./utils.js\"\n\nlogger.register(\"sme\") \n\nvar sme = { sensors : { dev_a : {} , dev_b : {} } , \n\t    transitioners : {} }  \n\n\n//extract a specific field from the data objects \n//i.e. [{:acc_x :acc_y... } , ... ] => [ acc_x, acc_x ... ] \nsme.sensors.field = function(field) { \n    return function(d) { \n\treturn util.last(d)[field] \n    }\n} \n\n//field diff will take the  diff of a particular field in the data object \nsme.sensors.field_diff = function(field) { \n    return function(d) { \n\tvar l = d.length \n\treturn d[l-1][field] - d[l-2][field]\n    }\n} \n\n\n\nsme.is_dev_b = function (d) { \n    return d.dev == \"B\" \n} \n\nsme.is_dev_a = function (d) { \n    return d.dev == \"A\" \n} \n\nsme.sensors.dev_b.field = function(field) { \n    //return sme.generic_filter(sme.is_dev_b , d=>d[field] ) \n    return function(buf) {\n\td = util.last(buf) \n\tif (d.dev == \"B\") { \n\t    return d[field]\n\t} else { \n\t    util.debug(\"filter miss\")\n\t    return false }\n    }\n}\n\nsme.transitioners.test_turn_on  = { \n    \"detector\" : function(state_machine) { \n\treturn !state_machine.STATE.is_on \n\t\n    } , \n    \"applicator\" : function(state_machine) { \n\tstate_machine.STATE.is_on = true \n\tif (state_machine.debug_mode ) { logger.sme(\"TURNED ON\") }\n    },\n    \"group\" : \"switch\" \n}\n\n\nsme.transitioners.test_turn_off  = { \n    \"detector\" : function(state_machine) { \n\treturn state_machine.STATE.is_on \n    } , \n    \"applicator\" : function(state_machine) { \n\tstate_machine.STATE.is_on = false  \n\tif (state_machine.debug_mode ) { logger.sme(\"TURNED OFF\") }\n    } , \n    \"group\" : \"switch\" \n}\n\n\n\n\nexport { sme } \n","1//Fri Oct  5 18:28:58 PDT 2018\n// workflows for RoseGait  \n\nimport util     from \"../module_resources/utils.js\"\nimport {sme}      from \"../module_resources/state_machine_elements.js\"\nimport {wrtsm}  from \"../wrtsm.js\"\nimport {logger} from \"../core_modules/logger.js\"\n\nlogger.register(\"rg\") \n\nvar flow = {} \n\nflow.test_storage_persist = function(name) { \n    //1. create web_socket object \n    ws = new wrtsm.mods.web_socket(\"ws://localhost:1234\") \n\n    //2. create data_storage object \n    ds = new wrtsm.mods.data_storage(name) \n\n    //3. create pipe manager object and connect 1 & 2 \n    pm = new wrtsm.mods.pipe_manager() \n    pm.connect(ws,ds) \n\n    //4. Enable saving on the data_storage object every 5s  \n    ds.start_saving(5) \n\n    //5. connect the websocket (which should automatically start receiving data) \n    ws.connect()\n    \n    //6. Stop streaming after 20s \n    setTimeout(function() { \n\tws.stop_stream() \n\tds.stop_saving() \n\tconsole.log(\"Streaming and saving stopped.\") \n    }, 21*1000)\n    \n} \n\n\nflow.test_storage_replay = function() { \n    //1. create data_storage object & load session \n    ds = new wrtsm.mods.data_storage(\"eugene_walk_rev\") \n    ds.load_session() \n    \n    //2. create raw_analyzer object \n    ra = new wrtsm.mods.raw_analyzer() \n\n    //3. create pipe manager object and connect 1 & 2 \n    pm = new wrtsm.mods.pipe_manager() \n    pm.connect(ds,ra) \n\n    //4. start the stream ! \n    ds.start_stream() \n    \n    return [ds,ra ] \n\n} \n\nflow.test_state_machine = function(n) {\n    logger.rg(\"Creating state machine with size: \" + n) \n    var sm = new wrtsm.mods.state_machine({buffer_size : n, gui_mode:  false } ) \n    sm.initialize({\"is_on\" : false }) \n    \n    logger.rg(\"Adding sensors\") \n    sm.add_sensor({id:\"acc_x\" , f:sme.sensors.field(\"acc_x\"), graph : \"g1\"})\n    sm.add_sensor({id: \"acc_x_diff\" ,f: sme.sensors.field_diff(\"acc_x\"), graph : \"g1\"})\n    \n    logger.rg(\"Adding transitioners\") \n    sm.add_transitioner(\"test_turn_on\", sme.transitioners.test_turn_on ) \n    sm.add_transitioner(\"test_turn_off\", sme.transitioners.test_turn_off ) \n    \n    // ok so at this point everything should be initialized and we should be able \n    // to start profiling and inspecing the state machine \n    logger.rg(\"Returning sm\") \n    return sm \n    \n    \n    \n} \n\n\nflow.test_state_machine_gui = function(d) {\n    var n = 200 \n    logger.rg(\"Creating state machine with size: \" + n) \n    var sm = new wrtsm.mods.state_machine({buffer_size : n, gui_mode:  true } ) \n    sm.initialize({\"is_on\" : false }) \n    \n    logger.rg(\"Adding sensors\") \n    sm.add_sensor({id:\"acc_x\" , f:sme.sensors.field(\"acc_x\"), graph : \"g1\"})\n    sm.add_sensor({id: \"acc_x_diff\" ,f: sme.sensors.field_diff(\"acc_x\"), graph : \"g1\"})\n    \n    logger.rg(\"Adding transitioners\") \n    sm.add_transitioner(\"test_turn_on\", sme.transitioners.test_turn_on ) \n    sm.add_transitioner(\"test_turn_off\", sme.transitioners.test_turn_off ) \n    \n    // ok so at this point everything should be initialized and we should be able \n    // to start profiling and inspecing the state machine \n\n    sm.init_gui(d) \n\n    logger.rg(\"Returning sm\") \n    return sm \n    \n    \n    \n} \n\nflow.playback_gui = function(d) {\n    n = 200 \n    logger.rg(\"Creating state machine with size: \" + n) \n    var sm = new wrtsm.mods.state_machine({buffer_size :n, gui_mode:  true, debug_mode : false }) \n    \n    logger.rg(\"Adding sensors\") \n    sm.add_sensor({id:\"dev_b_gyr_z\" , f:sme.sensors.dev_b.field(\"gyr_z\") })\n    //sm.add_sensor({id: \"acc_x_diff\" ,f: sme.sensors.field_diff(\"acc_x\")})\n    sm.add_sensor({id: \"acc_y\" ,f: sme.sensors.field(\"acc_y\")})\n    sm.add_sensor({id: \"gyr_z\" ,f: sme.sensors.field(\"gyr_z\")})\n\n    logger.rg(\"Adding transitioners\") \n    sm.add_transitioner(\"test_turn_on\", sme.transitioners.test_turn_on )\n    sm.add_transitioner(\"test_turn_off\", sme.transitioners.test_turn_off )\n\n\n    // ok so at this point state machine should be initialized \n    logger.rg(\"Calling sm.init_gui\") \n    sm.init_gui(d) \n    \n    //will load the file from storage \n    var ds = new wrtsm.mods.data_storage(\"eugene_walk_rev\") \n    ds.load_session() \n    \n    //and then create a pipe manager to connect the stored data file to the state machine \n    pm = new wrtsm.mods.pipe_manager() \n    pm.connect(ds,sm) \n    \n    //return them and can call ds.start_stream() for continuous simulation \n    //OR ds.stream_single_packet() to step one sample\n    return [ds, pm, sm ] \n\n} \n\n\nflow.graph_dances = function() { \n    var d = { g1 : [\"acc_x\", \"acc_y\"] } //, \"gyr_z\"] }  \n    //[sm,d] = test_state_machine_gui({ g1 : [\"acc_x\"] , g2 : [ \"acc_y\"] }) \n    var sm = flow.test_state_machine_gui(d) \n    //[sm,d] = test_state_machine_gui({ g1 : [\"acc_x\",  \"acc_y\"] , g2 : [  \"gyr_z\"] })\n    //util.app_render(test_div_array(1,2)) \n\n\n    var line_dance = function() { \n\tsm.ui.handle_sensor_buffer(200+speed*counter, {acc_x : 0.5*counter , acc_y : -0.5*counter})\n    }\n\n    var sine_rate = 2/100\n    var sine_rate_2 = 5/100\n    var sine_rate_3 = 7/100\n    var sine_dance_0 = function() { \n\tsm.ui.handle_sensor_buffer(200+speed*counter, {acc_x : Math.sin(sine_rate*counter) , acc_y : -Math.sin(sine_rate_2*counter)})\n    }\n\n    var sine_dance_1 = function() { \n\tsm.ui.handle_sensor_buffer(200+speed*counter, {acc_x : Math.sin(sine_rate*counter) , acc_y : -Math.sin(sine_rate_2*counter) , gyr_z : Math.sin(sine_rate_3*counter)})\n    }\n\n\n    var speed = 20\n    var counter = 0 \n    var a = setInterval( (function() { \n\tsine_dance_0()\n\tcounter++ \n    }), 50 ) \n    var stop = function() { \n\tclearInterval(a) \n    }\n\n    return [sm  , a,  stop ] \n\n}\n    \n\n\n// [0,1,2,3,4] \n//  [1,1,1,1] \n\nflow.graph_sm_test = function() { \n    //now we will loop and do the perf \n    var num = 200\n    var interval = 1\n    var start = 2\n    var sizes = Array(num).fill(0) \n    var results = Array(num).fill(0) \n    for (var i = 0; i < num ; i ++ ) { \n\tvar size = start + i * interval \n\tsizes[i] = size \n\t//create the sm \n\tvar sm = test_state_machine(size) \n\t\n\t//define the perf function \n\tvar test_cycle = ( function() { \n\t    sm.run_debug_cycle() \n\t}).bind(sm)\n\t\n\t//now we perf it \n\tresults[i] = util.perf(test_cycle)\n    } \n    \n    //at this point results should be full . \n    logger.rg(\"Graphing results... \") \n    bar_graph(\"Perf\" , \"size\", \"time\" , sizes, results ) \n    logger.rg(\"hmm.. ?\")\n}\n    \n    \n// want to be able to play back data \n/* \nA brief historical aside: \nat first I recorded the data withuot converting the Strings inside the objects to numbers \nTo solve, I loaded the recorded file, then mapped the conversion accross the loaded buffer \nThen I made a new wrtsm.mods.data storage object with _rev extension, and connecnted d1 to d2. \nThen I started d2.save and d1.stream \nvoila \n */ \n\nflow.EW = function() { \n    d = new wrtsm.mods.data_storage(\"eugene_walk_rev\") \n    d.load_session() \n    \n    //at this pt data is accesible in d.loaded_sesssion \n    return d \n} \n    \n\n\n\nexport {flow} \n\n","//The main program \n\nimport {wrtsm} from  \"./wrtsm.js\"  //import global wrtsm object \nimport {flow}  from  \"./scripts/rose_gait_workflows.js\" \n\n\n/* additions to global context */ \nwrtsm.flow = flow \n\n\n/* - - - - - - - */ \nconsole.log( \":: \" + (new Date()) + \" ::\") \nconsole.log(\":: wrtsm initialized ::\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"]}